"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.gettor=gettor,exports.settor=settor,exports.getPathArray=getPathArray,exports.default=_default;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),React=_interopRequireWildcard(require("react")),_bind=_interopRequireDefault(require("./bind"));function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){(0,_defineProperty2.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var valueAttr="value",defaultBindProps="value",CntName="_lugiax_event_cnt",DefaultEvent="onChange";function gettor(e,t){return function(){return e.getIn(getPathArray(t))}}function settor(e,t){return function(r){return e.setIn(getPathArray(t),r)}}function getPathArray(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("."),t=[];return e.forEach(function(e){var r=e.indexOf("[");if(~r){var n=e.substr(0,r);t.push(n);var a=e.substr(r);t.push(a.substr(1,a.length-2))}else t.push(e)}),t}function _default(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=getFieldProps(t),u=getFieldNames(a),o=generateAutoMutations(e,u),i={};Object.keys(Object.assign((0,_defineProperty2.default)({},DefaultEvent,!0),r)).forEach(function(e){i[e]=function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];u.filter(function(t){return e!==DefaultEvent||defaultOnChangeEvent(r,u)(t)}).forEach(triggerMutations.apply(void 0,[t,o,r,e].concat(a)))}});var f=autoCreateAreStateEqual(u);return function(t){return(0,_bind.default)(e,generateMode2Props(u,a),i,_objectSpread({areStateEqual:f},n))(t)}}function autoCreateAreStateEqual(e){return function(t,r){return!e.every(function(e){return gettor(t,e)()==gettor(r,e)()})}}function defaultOnChangeEvent(e,t){var r=getField2Event(e,t);return function(e){var t=r[e];return!t||0===t[CntName]||t[DefaultEvent]}}function triggerMutations(e,t,r,n){for(var a=arguments.length,u=new Array(a>4?a-4:0),o=4;o<a;o++)u[o-4]=arguments[o];return function(a){var o=t[a],i=getValueMethod(r,n,a);e[o]((0,_defineProperty2.default)({},valueAttr,i.apply(void 0,u)))}}function getField2Event(e,t){var r={};return e?(Object.keys(e).forEach(function(n){var a=e[n];t.forEach(function(e){var t=r[e];t||(t=r[e]=(0,_defineProperty2.default)({},CntName,0));var u=a[e];u&&(t[CntName]++,t[n]=u)})}),r):r}var getOnChangeValue=function(e){return e.target.value};function getValueMethod(e,t,r){if(!e||!e[t]||!e[t][r])return getOnChangeValue;var n=e[t];if(!n)return getOnChangeValue;var a=n[r];return a||getOnChangeValue}function getFieldNames(e){return e?Object.keys(e):[]}function getFieldProps(e){return"string"==typeof e?(0,_defineProperty2.default)({},e,defaultBindProps):e}function generateMode2Props(e,t){return function(r){var n={};return e.forEach(function(e){var a=gettor(r,e),u=t[e];Array.isArray(u)?u.forEach(function(e){n[e]=a()}):n[u]=a()}),n}}function generateAutoMutations(e,t){var r={},n=e.addMutation,a=e.mutations,u=e.addDataMutation;return n=u||n,t.forEach(function(e){var t="_alugiax_change".concat(e);r[e]=t,a[t]||n(t,function(t,r){var n=r[valueAttr],a=r.__cb2Data__;return a&&a({path:e,newValue:n}),settor(t,e)(n)})}),r}