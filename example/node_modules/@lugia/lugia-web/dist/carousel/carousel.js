"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isHasStart=exports.getInitStart=void 0;var _createClass=function(){function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_react=require("react"),React=_interopRequireWildcard(_react),_NumberUtils=require("../common/NumberUtils"),_themeHoc=require("@lugia/theme-hoc"),_objectUtils=require("@lugia/object-utils"),_carousel=require("../css/carousel"),_stateColor=require("../css/stateColor"),_stateColor2=_interopRequireDefault(_stateColor),_Math=require("../common/Math"),_icon=require("../icon"),_icon2=_interopRequireDefault(_icon);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _colorsFunc=(0,_stateColor2.default)(),lightGreyColor=_colorsFunc.lightGreyColor,defaultDelay=4e3,defaultAnimationTime=500,getInitStart=exports.getInitStart=function(t,e){var r=t.children;if(!r||0===r.length)return 0;var i=r.length;return e=i<(e=(0,_NumberUtils.toNumber)(e,0))?0:e,(0,_Math.limit)(e,[0,i])},isHasStart=exports.isHasStart=function(t){return"start"in t},Carousel=function(){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t));return _initialiseProps.call(e),e.clickDisabled=!1,e.preStart=(0,_NumberUtils.toNumber)(t.start,0),e.animationTime=e.getAnimationTime(t)/1e3,e.initWidthAndHeight(),e.initSwitchButtonFontSize(),e}return _inherits(r,React.Component),_createClass(r,[{key:"initWidthAndHeight",value:function(){var t=this.props.getPartOfThemeConfig("CarouselWrap").normal,e=void 0===t?{}:t,r=e.width,i=void 0===r?_carousel.defaultWidth:r,n=e.height,o=void 0===n?_carousel.defaultHeight:n;this.width=(0,_NumberUtils.toNumber)(i,_carousel.defaultWidth),this.height=(0,_NumberUtils.toNumber)(o,_carousel.defaultHeight)}},{key:"initSwitchButtonFontSize",value:function(){var t=this.props.getPartOfThemeConfig,e=t("PreButton").normal,r=void 0===e?{}:e,i=t("NextButton").normal,n=void 0===i?{}:i,o=r.font,a=(void 0===o?{}:o).size,s=void 0===a?_carousel.defaultButtonFontSize:a,l=n.font,c=(void 0===l?{}:l).size,u=void 0===c?_carousel.defaultButtonFontSize:c;this.preButtonFontSize=(0,_NumberUtils.toNumber)(s,_carousel.defaultButtonFontSize),this.nextButtonFontSize=(0,_NumberUtils.toNumber)(u,_carousel.defaultButtonFontSize)}},{key:"addPropsConfig",value:function(t,e){return this.props.getPartOfThemeProps(t,{props:e})}},{key:"render",value:function(){this.initPropsConfig();var t=this.props.createEventChannel(["hover"]),e=this.props,r=e.getPartOfThemeProps,i=e.indicatorType,n=e.indicator,o=e.switchButton,a=r("CarouselWrap",{props:{indicatorType:i,preButtonFontSize:this.preButtonFontSize,nextButtonFontSize:this.nextButtonFontSize}});return React.createElement(_carousel.Wrap,Object.assign({themeProps:a},(0,_themeHoc.addMouseEvent)(this)),React.createElement(_carousel.CarouselContainer,{themeProps:a,lugiaConsumers:t.consumer},o?this.getSwitchButton():null,this.getItems(t)),this.getIndicatros(i,n))}},{key:"getIndicatros",value:function(t,e){var r=this.createIndicators();return e?r:null}},{key:"getAnimationTime",value:function(t){var e=t.animationTime,r=void 0===e?defaultAnimationTime:e;return(0,_Math.limit)((0,_NumberUtils.toNumber)(r,defaultAnimationTime),[200,1e5])}},{key:"handleMouseEnterIndicator",value:function(t){"hover"===this.props.action&&this.changeIndicatorState(t)}},{key:"handleClickIndicator",value:function(t){"hover"!==this.props.action&&this.changeIndicatorState(t)}},{key:"getPreStart",value:function(t,e,r){if("pre"===t){var i=0===e?r:e;return{preStart:i,newStart:i-1}}var n=e===r?0:e;return{preStart:n,newStart:n+1}}},{key:"setStart",value:function(t){var e=this.props.onChange;e&&e({newValue:t,oldValue:this.state.start}),isHasStart(this.props)||this.setState({start:t})}},{key:"getItemWrap",value:function(t){var e=t.switchType,r=t.start,i=t.index,n=t.item,o=r===i,a=this.addPropsConfig("CarouselWrap",{checked:o,switchType:e,width:this.width,height:this.height,animationTime:this.animationTime});return React.createElement(_carousel.ItemWrap,{themeProps:a},n)}},{key:"componentDidMount",value:function(){this.handleAutoPlay(this.props)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"resetHandleAutoPlay",value:function(t){clearInterval(this.interval),this.handleAutoPlay(t)}}],[{key:"getDerivedStateFromProps",value:function(t,e){var r=t.start,i=void 0===r?0:r,n=t.defaultStart;return isHasStart(t)?{start:getInitStart(t,i)}:e?void 0:{start:n}}}]),r}();Carousel.defaultProps={getTheme:function(){},defaultStart:0,autoPlay:!0,delay:3e3,action:"hover",indicator:!0,switchButton:!0,indicatorType:"horizontal",switchType:"horizontal",animationTime:defaultAnimationTime};var _initialiseProps=function(){var h=this;this.initPropsConfig=function(){var t=h.state,e=h.props,r=t.start,i=e.children,n=e.themeProps,o=e.indicatorType,a=e.switchType,s=e.start,l=i?i.length:0,c=h.animationTime,u=h.preStart;n.propsConfig={indicatorType:o,animationTime:c,switchType:a,initStart:s,preStart:u,nextStart:r,len:l}},this.getSwitchTheme=function(t){var e=(0,h.props.getPartOfThemeHocProps)(t),r=e.viewClass,i=e.theme,n=i[r],o=n.normal,a=void 0===o?{}:o,s=n.hover,l=void 0===s?{}:s;return a.margin={},a.padding={},l.margin={},{viewClass:r,theme:(0,_objectUtils.deepMerge)(_defineProperty({},r,{normal:{font:{size:_carousel.defaultButtonFontSize},color:lightGreyColor}}),i)}},this.getSwitchButton=function(){var t=h.props,e=t.indicatorType,r=t.children,i=t.getPartOfThemeProps;if(!r||0===r.length||"vertical"===e)return null;var n=i("PreButton"),o=React.createElement(_carousel.PreButton,{onClick:h.preClick,themeProps:n},React.createElement(_icon2.default,Object.assign({},h.getSwitchTheme("PreButton"),{singleTheme:!0,iconClass:"lugia-icon-direction_left_circle"}))),a=i("NextButton");return[o,React.createElement(_carousel.NextButton,{onClick:h.nextClick,themeProps:a},React.createElement(_icon2.default,Object.assign({singleTheme:!0},h.getSwitchTheme("NextButton"),{iconClass:"lugia-icon-direction_right_circle"})))]},this.createIndicators=function(){var t=[],e=h.props,n=e.indicatorType,r=e.children;if(r){var o=h.state.start,a=r.length;t=r.map(function(t,e){var r=o===e||0===e&&o===a,i=h.addPropsConfig("Indicator",{indicatorType:n,checked:r,animationTime:h.animationTime});return React.createElement(_carousel.IndicatorContainer,{themeProps:i,onMouseEnter:h.handleMouseEnterIndicator.bind(h,e),onClick:h.handleClickIndicator.bind(h,e)},React.createElement(_carousel.Indicator,{themeProps:i,key:e,checked:r}))})}var i=h.addPropsConfig("Indicator",{indicatorType:n,width:h.width,height:h.height});return React.createElement(_carousel.IndicatorWrap,{themeProps:i},t)},this.preClick=function(){h.clickSwitchButton("pre")},this.nextClick=function(){h.clickSwitchButton("next")},this.changeIndicatorState=function(t){h.resetHandleAutoPlay(h.props);var e=h.state,r=h.props,i=e.start,n=r.children.length;t===i||i===n&&0===t||(h.preStart=i===n?0:i,h.setStart(t))},this.clickSwitchButton=function(t){if(!h.clickDisabled){h.clickDisabled=!0,h.resetHandleAutoPlay(h.props);var e=h.state,r=h.props.children,i=void 0===r?[]:r,n=e.start,o=void 0===n?0:n,a=i.length,s=h.getPreStart(t,o,a),l=s.newStart,c=s.preStart;h.preStart=c,h.setStart(l),setTimeout(function(){h.clickDisabled=!1},h.animationTime)}},this.getItems=function(t){var e=h.props,r=e.children,i=(0,e.getPartOfThemeProps)("CarouselWrap");if(!r||0===r.length)return React.createElement(_carousel.Empty,{themeProps:i},"暂无切换框");var n=h.state.start,o=h.props,a=o.start,s=o.switchType,l=r.length,c=h.addPropsConfig("CarouselWrap",{len:l,switchType:s,initStart:a,nextStart:n,width:h.width,height:h.height,preStart:h.preStart,animationTime:h.animationTime});return React.createElement(_carousel.AllItemsContainer,Object.assign({},t.provider,{themeProps:c,initStart:a}),h.getChildren(r))},this.getChildren=function(t){var e=h.props,r=h.state,i=e.switchType,n=r.start,o=void 0===n?0:n;if(!t||0===t.length)return[];var a=t.map(function(t,e){return h.getItemWrap({switchType:i,start:o,index:e,item:t})});return a.push(h.getItemWrap({switchType:i,start:o,index:t.length,item:t[0]})),a},this.handleAutoPlay=function(t){if(t.autoPlay){var e=t.delay,r=(0,_NumberUtils.toNumber)(e,defaultDelay);h.interval=setInterval(function(){h.nextClick()},r)}}};exports.default=Carousel;