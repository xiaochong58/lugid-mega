"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp,_createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_menu=require("../menu"),_menu2=_interopRequireDefault(_menu),_input=require("../input"),_input2=_interopRequireDefault(_input),_objectUtils=require("@lugia/object-utils"),_trigger=require("../trigger"),_trigger2=_interopRequireDefault(_trigger),_ShortKeyBoard=require("../common/ShortKeyBoard"),_ShortKeyBoard2=_interopRequireDefault(_ShortKeyBoard),_KeyBoard=require("../consts/KeyBoard"),_KeyBoard2=_interopRequireDefault(_KeyBoard),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_props2=require("../consts/props"),_autocomplete=require("../css/autocomplete"),_menu3=require("../css/menu"),_themeHoc=require("@lugia/theme-hoc"),_themeHoc2=_interopRequireDefault(_themeHoc),_theme=require("../theme"),_theme2=_interopRequireDefault(_theme),_reactDom=require("react-dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ScrollerStep=30;exports.default=(0,_ShortKeyBoard2.default)((0,_themeHoc2.default)((_temp=_class=function(){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.getMenuData=function(){return a.state.value?a.getData():[]},a.menuItemClickHandler=function(e,t){var r=a.props.onSelect,n=t.selectedKeys;r&&r(n),a.changeClickingOldValue(!0),a.changeOldValueAnFocus(n[0])},a.handleClickOldValueItem=function(){a.changeClickingOldValue(!0);var e=a.state.preSelectValue;a.changeOldValueAnFocus(e)},a.clearInputValue=function(){a.changeOldValueAnFocus("")},a.onFocus=function(e){a.clickingOldValue||(a.currentSelectValue=a.state.value);var t=a.props.onFocus;a.enterValue=a.state.value,t&&t(e)},a.onBlur=function(e){var t=a.props.onBlur;t&&t(e);setTimeout(function(){a.clickingOldValue?a.changeClickingOldValue(!1):function(){var e=a.state.value;e!==a.enterValue&&a.changeOldValue(e)}()},0)},a.changeInputValue=function(e){var t=e.newValue;a.onChangeHandle(t),a.setValue(t,{})},a.getContainerWidth=function(){return a.state.menuWidth},a.mergeTheme=function(e,t){var r=a.props.getPartOfThemeHocProps(e),n=r.viewClass,u=r.theme;return{viewClass:n,theme:(0,_objectUtils.deepMerge)(_defineProperty({},n,Object.assign({},t)),u)}},a.getMenuTheme=function(){var e={Container:{normal:{width:a.getContainerWidth()}}};return a.mergeTheme("Menu",e)},a.getInputRef=function(e){var t=e.ref;a.inputRef=t},a.currentSelectValue="",a.inputEl=React.createRef(),a.triggerEl=React.createRef(),a}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props,t=this.state.value,r=e.disabled,n=e.placeholder,u=e.prefix,a=e.suffix,l=(e.getPartOfThemeHocProps,this.getMenuData()),o=l.length,i=0==Math.min(5,o)*_menu3.MenuItemHeight?React.createElement(_autocomplete.EmptyBox,null):[this.getOldValueItem(),React.createElement(_menu2.default,Object.assign({data:l},this.getMenuTheme(),{mutliple:!1,selectedKeys:t,onClick:this.menuItemClickHandler,step:ScrollerStep,valueField:_props2.ValueField,displayField:_props2.DisplayField}))];return React.createElement(_theme2.default,{config:this.getInputTheme()},React.createElement(_trigger2.default,{createPortal:this.props.createPortal,themePass:!0,align:"bottomLeft",action:r?[]:["focus"],hideAction:["focus"],popup:i,offsetY:4,ref:this.triggerEl},React.createElement(_input2.default,{value:t,disabled:r,ref:this.inputEl,getInputRef:this.getInputRef,onChange:this.changeInputValue,onClear:this.clearInputValue,onFocus:this.onFocus,onBlur:this.onBlur,placeholder:n,prefix:u,suffix:a})))}},{key:"getInputTheme",value:function(){var e=this.props.getPartOfThemeConfig;return _defineProperty({},_index2.default.Input,{Container:e("Container"),InputSuffix:e("TagWrap"),InputPrefix:e("TagIcon"),InputClearButton:e("SwitchIcon")})}},{key:"setPopupVisible",value:function(){var e;this.triggerEl.current&&(e=this.triggerEl.current).setPopupVisible.apply(e,arguments)}},{key:"getOldValueItem",value:function(){var e=this.state.preSelectValue,t=void 0===e?"":e;if(""===t)return null;var r=this.props,n=r.showOldValue,u=(0,r.getPartOfThemeProps)("OldItem");return n?React.createElement(_autocomplete.OldValueItem,{onClick:this.handleClickOldValueItem,themeProps:u},React.createElement(_autocomplete.TimeIcon,{themeProps:u,iconClass:"lugia-icon-reminder_clock_circle_o"}),React.createElement(_autocomplete.OldValueTitle,{themeProps:u},t)):null}},{key:"getData",value:function(){return this.props.data.map(function(e){var t;return"number"==typeof e&&(e+=""),_defineProperty(t={},_props2.ValueField,e),_defineProperty(t,_props2.DisplayField,e),t})}},{key:"changeOldValueAnFocus",value:function(e){this.changeOldValue(e),this.focusInput()}},{key:"changeOldValue",value:function(e){var t=this.currentSelectValue;this.currentSelectValue=e,this.setValue(e,{preSelectValue:t})}},{key:"focusInput",value:function(){this.getInputDom().focus()}},{key:"getInputDom",value:function(){return(0,_reactDom.findDOMNode)(this.inputEl.current.getThemeTarget()).querySelector("input")}},{key:"changeClickingOldValue",value:function(e){this.clickingOldValue=e}},{key:"setValue",value:function(e,t){this.setState(Object.assign({value:e},t)),this.onChangeHandle(e)}},{key:"onChangeHandle",value:function(e){var t=this.props.onChange;t&&t(e)}},{key:"componentDidMount",value:function(){var e=this.inputRef.current.offsetWidth;this.setState({menuWidth:e})}},{key:"onUp",value:function(){}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r="value"in e?e.value:t?t.value:e.defaultValue;return t?{value:r}:{menuData:[],preSelectValue:"",value:r}}}]),t}(),_class.defaultProps={getTheme:function(){return{}},data:[],showOldValue:!1,createPortal:!0},_class.displayName="AutoComplete",_temp),_index2.default.AutoComplete,{hover:!0}),[{shiftKey:!0,keyCode:_KeyBoard2.default.UP,method:["onUp"]}]);