"use strict";var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react);require("jest-styled-components");var _enzyme=require("enzyme"),_enzyme2=_interopRequireDefault(_enzyme),_enzymeAdapterReact=require("enzyme-adapter-react-16"),_enzymeAdapterReact2=_interopRequireDefault(_enzymeAdapterReact),_index=require("../../consts/index"),_index2=_interopRequireDefault(_index),_=require("../"),_2=_interopRequireDefault(_),_reactTestUtils=require("@lugia/react-test-utils"),_chai=require("chai"),_chai2=_interopRequireDefault(_chai);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var o=e.apply(this,arguments);return new Promise(function(u,c){return function t(e,a){try{var n=o[e](a),r=n.value}catch(e){return void c(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});u(r)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_enzyme2.default.configure({adapter:new _enzymeAdapterReact2.default});var exp=_chai2.default.expect,data=["Nikcy Romero","Armin van Buuren","Hardwell","Zedd","Kazze","Vicetone","Martin Garrix","David Guetta","The Chainsmokers","Kygo","Axwell ^ Ingrosso","Dimitri Vegas & Like Mike","Calvin Harris","Avicci","Fedde Le Grand","Tiesto","Snoop Dogg","Bassjackers","Sebastian Ingrosso","Swedish House Mafia","Alesso","Afrojack","Knife Party","Dannic","R3hab"];describe("autocomplete",function(){it("非受限：input框输入值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,null));i(e,"szfeng"),expect(s(e)).toBe("szfeng")}),it("受限：input框输入值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{value:""}));i(e,"szfeng"),expect(s(e)).toBe("")}),it("defaultValue: input框输入值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{defaultValue:"hades"}));expect(s(e)).toBe("hades"),i(e,"szfeng"),expect(s(e)).toBe("szfeng")}),it("data is { value: Number[]}",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{data:[1,2,3]}));x(e),i(e,"1"),expect(s(e)).toBe("1"),expect(p(e)).toEqual([{value:"1",text:"1"},{value:"2",text:"2"},{value:"3",text:"3"}])});var a=(_inherits(n,_react2.default.Component),_createClass(n,[{key:"render",value:function(){var e=this.state.menuData;return _react2.default.createElement(_2.default,{data:e,onChange:this.onChange,showOldValue:!0})}},{key:"search",value:function(e){for(var t=void 0,a=[],n=data.length,r=0;r<n;r++){var u=data[r];if(this.searchValue(e,u)&&a.push(u),e===u){a=[];break}}t=a.length===n?data:a,this.setState({menuData:t})}}]),n);function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.onChange=function(e){t.search(e)},t.searchValue=function(e,t){return-1!==t.indexOf(e)},t.state={menuData:data},t}a.defaultProps={data:data},it("非受限：input框输入后，menu显示过滤后的值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(a,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Axwell ^ Ingrosso",text:"Axwell ^ Ingrosso"},{value:"Avicci",text:"Avicci"},{value:"Alesso",text:"Alesso"},{value:"Afrojack",text:"Afrojack"}]),i(e,""),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),i(e,""),expect(s(e)).toBe(""),expect(l(e).length).toBe(1)}),it("非受限：输入》查询》点击MenuItem =》显示选中项",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(a,{data:data}));x(e),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(e,0),expect(s(e)).toBe("Armin van Buuren")}),it("非受限：输入》查询》点击MenuItem》查询》点击MenuItem》显示旧值",_asyncToGenerator(_regenerator2.default.mark(function e(){var t;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:x(t=(0,_enzyme.mount)(_react2.default.createElement(a,{data:data}))),i(t,"B"),expect(s(t)).toBe("B"),expect(p(t)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(t,0),expect(s(t)).toBe("Armin van Buuren"),i(t,"B"),expect(s(t)).toBe("B"),expect(p(t)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(t,1),expect(s(t)).toBe("Bassjackers"),i(t,"C"),expect(s(t)).toBe("C"),expect(d(t)).toBe("Armin van Buuren");case 15:case"end":return e.stop()}},e,void 0)}))),it("非受限：输入》查询》点击MenuItem》点击清除按钮》显示旧值为上一次值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(a,{data:data}));x(e),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(e,0),expect(s(e)).toBe("Armin van Buuren"),_(e),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"C"),expect(s(e)).toBe("C"),expect(d(e)).toBe("Armin van Buuren")}),it("非受限：点击旧值 》Input显示旧值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(a,{data:data}));x(e),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(e,0),expect(s(e)).toBe("Armin van Buuren"),_(e),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"C"),expect(s(e)).toBe("C"),expect(d(e)).toBe("Armin van Buuren"),A(e),expect(s(e)).toBe("Armin van Buuren"),expect(l(e).length).toBe(1)}),it("first select no oldValue",_asyncToGenerator(_regenerator2.default.mark(function e(){var t;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(t=(0,_enzyme.mount)(_react2.default.createElement(a,{data:data}))),i(t,"B"),expect(s(t)).toBe("B"),expect(p(t)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),B(t),e.next=8,(0,_reactTestUtils.delay)(100);case 8:x(t),v(t,0),i(t,"C"),expect(s(t)).toBe("C"),expect(d(t)).toBe("B");case 13:case"end":return e.stop()}},e,void 0)}))),it("input value on blur save old value",_asyncToGenerator(_regenerator2.default.mark(function e(){var t;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(t=(0,_enzyme.mount)(_react2.default.createElement(a,{data:data}))),i(t,"A"),expect(s(t)).toBe("A"),B(t),e.next=7,(0,_reactTestUtils.delay)(100);case 7:return x(t),i(t,"B"),expect(s(t)).toBe("B"),B(t),e.next=13,(0,_reactTestUtils.delay)(100);case 13:return x(t),expect(d(t)).toBe("A"),i(t,"C"),B(t),e.next=19,(0,_reactTestUtils.delay)(100);case 19:x(t),i(t,"C"),expect(s(t)).toBe("C"),expect(d(t)).toBe("B");case 23:case"end":return e.stop()}},e,void 0)}))),it("input value on blur save old value , value is In AutoCompleteBounded.state.value",_asyncToGenerator(_regenerator2.default.mark(function e(){var t;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(t=(0,_enzyme.mount)(_react2.default.createElement(r,{data:data}))),i(t,"A"),expect(s(t)).toBe("A"),B(t),e.next=7,(0,_reactTestUtils.delay)(100);case 7:return x(t),i(t,"B"),expect(s(t)).toBe("B"),B(t),t.update(),e.next=14,(0,_reactTestUtils.delay)(100);case 14:return x(t),i(t,"C"),expect(d(t)).toBe("A"),B(t),e.next=20,(0,_reactTestUtils.delay)(100);case 20:x(t),i(t,"D"),expect(d(t)).toBe("B");case 23:case"end":return e.stop()}},e,void 0)}))),it("input value on blur save old value is limit",_asyncToGenerator(_regenerator2.default.mark(function e(){var t;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(t=(0,_enzyme.mount)(_react2.default.createElement(r,{data:data,value:"A"}))),i(t,"A"),x(t),expect(s(t)).toBe("A"),B(t),e.next=8,(0,_reactTestUtils.delay)(100);case 8:return x(t),i(t,"B"),expect(s(t)).toBe("A"),B(t),e.next=14,(0,_reactTestUtils.delay)(100);case 14:return x(t),expect(f(t).length).toBe(0),i(t,"C"),B(t),e.next=20,(0,_reactTestUtils.delay)(100);case 20:x(t),i(t,"D"),expect(f(t).length).toBe(0);case 23:case"end":return e.stop()}},e,void 0)}))),it("on blur switch twice value",_asyncToGenerator(_regenerator2.default.mark(function e(){var t;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(t=(0,_enzyme.mount)(_react2.default.createElement(a,{data:data}))),i(t,"A"),expect(s(t)).toBe("A"),B(t),e.next=7,(0,_reactTestUtils.delay)(100);case 7:return expect(s(t)).toBe("A"),x(t),i(t,"B"),expect(s(t)).toBe("B"),B(t),e.next=14,(0,_reactTestUtils.delay)(100);case 14:return expect(s(t)).toBe("B"),e.next=17,(0,_reactTestUtils.delay)(100);case 17:return x(t),i(t,"C"),expect(d(t)).toBe("A"),B(t),e.next=23,(0,_reactTestUtils.delay)(100);case 23:x(t),expect(d(t)).toBe("B"),expect(p(t)).toEqual([{value:"The Chainsmokers",text:"The Chainsmokers"},{value:"Calvin Harris",text:"Calvin Harris"}]),v(t,0),expect(s(t)).toBe("The Chainsmokers"),x(t),i(t,"B"),expect(s(t)).toBe("B"),expect(d(t)).toBe("C"),expect(p(t)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(t,0),expect(s(t)).toBe("Armin van Buuren"),x(t),i(t,"D"),expect(d(t)).toBe("The Chainsmokers");case 38:case"end":return e.stop()}},e,void 0)})));var r=(_inherits(u,_react2.default.Component),_createClass(u,[{key:"render",value:function(){var e=this.state,t=e.menuData,a=e.value;return _react2.default.createElement(_2.default,{showOldValue:!0,value:a,data:t,onChange:this.onChange})}},{key:"search",value:function(e){for(var t=void 0,a=[],n=data.length,r=0;r<n;r++){var u=data[r];if(this.searchValue(e,u)&&a.push(u),e===u){a=[];break}}t=a.length===n?data:a,this.setState({menuData:t})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a="value"in e?e.value:t?t.value:e.defaultValue;return{value:a}}}]),u);function u(e){_classCallCheck(this,u);var t=_possibleConstructorReturn(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.onChange=function(e){t.search(e),t.setState({value:e})},t.searchValue=function(e,t){return-1!==t.indexOf(e)},t.state={menuData:data},t}it("受限：输入》查询》点击MenuItem =》显示选中项",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(r,{data:data}));x(e),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(e,0),expect(s(e)).toBe("Armin van Buuren")}),it("受限：输入》查询》点击MenuItem》查询》点击MenuItem》显示旧值",_asyncToGenerator(_regenerator2.default.mark(function e(){var t;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(t=(0,_enzyme.mount)(_react2.default.createElement(r,{data:data}))),i(t,"B"),expect(s(t)).toBe("B"),expect(p(t)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(t,0),expect(s(t)).toBe("Armin van Buuren"),B(t),e.next=10,(0,_reactTestUtils.delay)(100);case 10:return x(t),i(t,"B"),expect(s(t)).toBe("B"),expect(p(t)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(t,1),expect(s(t)).toBe("Bassjackers"),B(t),e.next=19,(0,_reactTestUtils.delay)(100);case 19:x(t),i(t,"C"),expect(d(t)).toBe("Armin van Buuren");case 22:case"end":return e.stop()}},e,void 0)}))),it("受限：输入》查询》点击MenuItem》点击清除按钮》显示旧值为上一次值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(r,{data:data}));x(e),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(e,0),expect(s(e)).toBe("Armin van Buuren"),_(e),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"B"),expect(d(e)).toBe("Armin van Buuren")}),it("受限：点击旧值 》Input显示旧值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(r,{data:data}));x(e),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"Armin van Buuren",text:"Armin van Buuren"},{value:"Bassjackers",text:"Bassjackers"}]),v(e,0),expect(s(e)).toBe("Armin van Buuren"),_(e),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"B"),expect(d(e)).toBe("Armin van Buuren"),A(e),expect(s(e)).toBe("Armin van Buuren"),expect(l(e).length).toBe(1)});var c=["@gmail.com","@sina.com","@163.com","@qq.com"],t=(_inherits(o,_react2.default.Component),_createClass(o,[{key:"render",value:function(){var e=this.state.menuData;return _react2.default.createElement(_2.default,{showOldValue:!0,data:e,onChange:this.onChange})}}]),o);function o(e){_classCallCheck(this,o);var n=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return n.onChange=function(e){n.getMenuData(e)},n.getMenuData=function(t){var a=[];c.forEach(function(e){-1===t.indexOf("@")&&(e=""+t+e,a.push(e))}),n.setState({menuData:a})},n.state={menuData:[]},n}function l(e){return e.find("emptyBox")}function i(e,t){return m(e).simulate("change",{target:{value:t}})}function s(e){return m(e).props().value}function m(e){return e.find(_index2.default.Input).find("input").at(0)}function B(e){return m(e).simulate("blur",{})}function x(e){return m(e).simulate("focus",{})}function p(e){return function(e){return e.find(_index2.default.Menu)}(e).props().data}function v(e,t){return e.find(_index2.default.MenuItem).at(t).simulate("click",{})}function f(e){return e.find("oldValueTitleSpan")}function d(e){return f(e).at(0).text()}function _(e){return e.find("ClearButton").at(0).simulate("click",{})}function A(e){return function(e){return e.find("oldValueItem").at(0)}(e).simulate("click",{})}it("Email自动补全@后缀：输入a，显示所有的后缀",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(t,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"A@gmail.com",text:"A@gmail.com"},{value:"A@sina.com",text:"A@sina.com"},{value:"A@163.com",text:"A@163.com"},{value:"A@qq.com",text:"A@qq.com"}]),i(e,""),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"B@gmail.com",text:"B@gmail.com"},{value:"B@sina.com",text:"B@sina.com"},{value:"B@163.com",text:"B@163.com"},{value:"B@qq.com",text:"B@qq.com"}]),i(e,""),expect(s(e)).toBe(""),expect(l(e).length).toBe(1)}),it("Email自动补全@后缀：输入@，不显示任何选项",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(t,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"A@gmail.com",text:"A@gmail.com"},{value:"A@sina.com",text:"A@sina.com"},{value:"A@163.com",text:"A@163.com"},{value:"A@qq.com",text:"A@qq.com"}]),i(e,"A@"),expect(s(e)).toBe("A@"),expect(l(e).length).toBe(1),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"B@gmail.com",text:"B@gmail.com"},{value:"B@sina.com",text:"B@sina.com"},{value:"B@163.com",text:"B@163.com"},{value:"B@qq.com",text:"B@qq.com"}]),i(e,""),expect(s(e)).toBe(""),expect(l(e).length).toBe(1)}),it("Email自动补全@后缀：输入A，点击menuItem，选中该项",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(t,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"A@gmail.com",text:"A@gmail.com"},{value:"A@sina.com",text:"A@sina.com"},{value:"A@163.com",text:"A@163.com"},{value:"A@qq.com",text:"A@qq.com"}]),v(e,0),expect(s(e)).toBe("A@gmail.com")}),it("Email自动补全@后缀：输入》选中》再输入》选中，显示旧值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(t,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"A@gmail.com",text:"A@gmail.com"},{value:"A@sina.com",text:"A@sina.com"},{value:"A@163.com",text:"A@163.com"},{value:"A@qq.com",text:"A@qq.com"}]),v(e,0),expect(s(e)).toBe("A@gmail.com"),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"B@gmail.com",text:"B@gmail.com"},{value:"B@sina.com",text:"B@sina.com"},{value:"B@163.com",text:"B@163.com"},{value:"B@qq.com",text:"B@qq.com"}]),v(e,1),expect(s(e)).toBe("B@sina.com"),i(e,"B"),expect(d(e)).toBe("A@gmail.com")}),it("Email自动补全@后缀：输入》查询》点击MenuItem》点击清除按钮》显示旧值为上一次值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(t,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"A@gmail.com",text:"A@gmail.com"},{value:"A@sina.com",text:"A@sina.com"},{value:"A@163.com",text:"A@163.com"},{value:"A@qq.com",text:"A@qq.com"}]),v(e,0),expect(s(e)).toBe("A@gmail.com"),_(e),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"B"),expect(d(e)).toBe("A@gmail.com")}),it("Email自动补全@后缀：选中旧值，input显示旧值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(t,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"A@gmail.com",text:"A@gmail.com"},{value:"A@sina.com",text:"A@sina.com"},{value:"A@163.com",text:"A@163.com"},{value:"A@qq.com",text:"A@qq.com"}]),v(e,0),expect(s(e)).toBe("A@gmail.com"),i(e,"B"),expect(s(e)).toBe("B"),expect(p(e)).toEqual([{value:"B@gmail.com",text:"B@gmail.com"},{value:"B@sina.com",text:"B@sina.com"},{value:"B@163.com",text:"B@163.com"},{value:"B@qq.com",text:"B@qq.com"}]),v(e,1),expect(s(e)).toBe("B@sina.com"),i(e,"B"),expect(d(e)).toBe("A@gmail.com")}),it("Email自动补全@后缀：点击旧值 》Input显示旧值",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(t,null));x(e),i(e,"A"),expect(s(e)).toBe("A"),expect(p(e)).toEqual([{value:"A@gmail.com",text:"A@gmail.com"},{value:"A@sina.com",text:"A@sina.com"},{value:"A@163.com",text:"A@163.com"},{value:"A@qq.com",text:"A@qq.com"}]),v(e,0),expect(s(e)).toBe("A@gmail.com"),_(e),expect(s(e)).toBe(""),expect(l(e).length).toBe(1),i(e,"A"),expect(d(e)).toBe("A@gmail.com"),A(e),expect(s(e)).toBe("A@gmail.com"),expect(l(e).length).toBe(1)})});