"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_chai=require("chai"),_chai2=_interopRequireDefault(_chai),_reactTestRenderer=require("react-test-renderer"),_reactTestRenderer2=_interopRequireDefault(_reactTestRenderer),_demo=require("../demo"),_demo2=_interopRequireDefault(_demo);require("jest-styled-components");var _enzyme=require("enzyme"),_enzyme2=_interopRequireDefault(_enzyme),_enzymeAdapterReact=require("enzyme-adapter-react-16"),_enzymeAdapterReact2=_interopRequireDefault(_enzymeAdapterReact),_index=require("../index.js"),_index2=_interopRequireDefault(_index),_InputTestUtils=require("../../input/__tests__/InputTestUtils"),_amountUtils=require("../amountUtils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _require=require("@lugia/jverify"),mockFunction=_require.mockFunction,VerifyOrder=_require.VerifyOrder,VerifyOrderConfig=_require.VerifyOrderConfig,exp=_chai2.default.expect;_enzyme2.default.configure({adapter:new _enzymeAdapterReact2.default});var LimitAmountInput=function(){function o(){var e,t,n;_classCallCheck(this,o);for(var r=arguments.length,a=Array(r),u=0;u<r;u++)a[u]=arguments[u];return(t=n=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(a)))).onChange=function(e){var t=e.newValue;n.setState({value:t})},_possibleConstructorReturn(n,t)}return _inherits(o,_react2.default.Component),_createClass(o,[{key:"render",value:function(){return _react2.default.createElement(_index2.default,{value:this.state.value,onChange:this.onChange})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t?{}:{value:e.value}}}]),o}();describe("AmountInputDemo",function(){var r=void 0;beforeEach(function(){r=VerifyOrder.create(),mockFunction.create(VerifyOrderConfig.create("onChange",r))});var a=1234,t="4321",u="5678",o="1,234",n="¥1,234",i="4,321",l="5,678",s="壹仟贰佰叁拾肆元整",c="伍仟陆佰柒拾捌元整";function e(e,a,u,o,i,l){it("props: onchange "+e+" ",function(){var e=VerifyOrder.create(),t=mockFunction.create(VerifyOrderConfig.create("onChange",e)).getFunction(),n=(0,_enzyme.mount)(_react2.default.createElement(_index2.default,Object.assign({},a,{onChange:t}))),r=Object.assign({},a);"disabled"in r&&(r.disabled||(u&&u.forEach(function(e,t){n.find("input").simulate("change",{target:{value:e}}),(0,_InputTestUtils.assertInputValue)(n,function(e){return(""+e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}(o[t])),expect(l[t]).toBe(function(e,t){return e&&t?t(e):""}(e,_amountUtils.convertCurrency))}),e.verify(function(e){var r=e.onChange;i&&i.forEach(function(e,t){var n=a.value;r({newValue:e,oldValue:i[t-1]?i[t-1]:n||"",event:VerifyOrder.Any})})})))})}function p(n){it("props: placeholder ",function(){global.svtest=!0;var e=_react2.default.createElement(_index2.default,{placeholder:n}),t=(0,_enzyme.mount)(e);expect(_reactTestRenderer2.default.create(e).toJSON()).toMatchSnapshot(),exp(t.props().placeholder).to.be.equal(n),global.svtest=!1})}function d(e){return e.children().children().instance()}it("Component JSON",function(){global.svtest=!0;var e=_reactTestRenderer2.default.create(_react2.default.createElement(_demo2.default,null));expect(e.toJSON()).toMatchSnapshot(),global.svtest=!1}),p("请填写内容"),p(""),it("props: keyboard event is null but fire keyup event",function(){(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyUp",{keyCode:49,Target:_index2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyDown",{keyCode:49,Target:_index2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyPress",{keyCode:49,Target:_index2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onFocus",{keyCode:49,Target:_index2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onBlur",{keyCode:49,Target:_index2.default})}),it("props: onKeyUp",function(){(0,_InputTestUtils.testKeyBoardEvent)(r,"onKeyUp",{keyCode:49,Target:_index2.default})}),it("props: onKeyPress",function(){(0,_InputTestUtils.testKeyBoardEvent)(r,"onKeyPress",{keyCode:49,Target:_index2.default})}),it("props: onKeyDown",function(){(0,_InputTestUtils.testKeyBoardEvent)(r,"onKeyDown",{keyCode:49,Target:_index2.default})}),it("props: onFocus",function(){(0,_InputTestUtils.testKeyBoardEvent)(r,"onFocus",{keyCode:49,Target:_index2.default})}),it("props: onBlur",function(){(0,_InputTestUtils.testKeyBoardEvent)(r,"onBlur",{keyCode:49,Target:_index2.default})}),it("props: onEnter Fired",function(){var e=mockFunction.create(VerifyOrderConfig.create("onEnter",r)),t={keyCode:13};e.mock(function(e){var t=e.keyCode;exp(t).to.be.equal(t)});var n={onEnter:e.getFunction()};(0,_enzyme.mount)(_react2.default.createElement(_index2.default,n)).find("input").simulate("keyDown",t),r.verify(function(e){e.onEnter(VerifyOrder.Object)})}),it("props: onEnter Not Fired",function(){var e={keyCode:44},t={onEnter:mockFunction.create(VerifyOrderConfig.create("onEnter",r)).getFunction()};(0,_enzyme.mount)(_react2.default.createElement(_index2.default,t)).find("input").simulate("onKeyDown".substr(2).toLowerCase(),e),r.verify(function(e){})}),it("props: null  Fired Enter",function(){var e={keyCode:13};(0,_enzyme.mount)(_react2.default.createElement(_index2.default,null)).find("input").simulate("onKeyDown".substr(2).toLowerCase(),e)}),it("props: value",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_index2.default,{value:t}));(0,_InputTestUtils.assertInputValue)(e,i)}),it("props: defaultValue & value",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_index2.default,{defaultValue:a,value:t}));(0,_InputTestUtils.assertInputValue)(e,i)}),it("props: value onChange LimitAmountInput changed",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(LimitAmountInput,{value:t}));(0,_InputTestUtils.assertInputValue)(e,i),e.find("input").simulate("change",{target:{value:u}}),(0,_InputTestUtils.assertInputValue)(e,l)}),it("props: value onChange LimitAmountInput no changed",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(LimitAmountInput,{value:t}));(0,_InputTestUtils.assertInputValue)(e,i),e.setProps({value:u}),(0,_InputTestUtils.assertInputValue)(e,i)}),it("props: value 壹仟贰佰叁拾肆元整 onChange LimitAmountInput changed",function(){function e(){return t.children().find("lugia_widget_Tooltip").props().title.props.children}var t=(0,_enzyme.mount)(_react2.default.createElement(LimitAmountInput,{value:s}));(0,_InputTestUtils.assertInputValue)(t,s),expect(e()).toBe(n),t.find("lugia_widget_AmountInput").at(0).simulate("focus"),t.find("toolTip_title").at(0).simulate("click"),(0,_InputTestUtils.assertInputValue)(t,o),expect(e()).toBe(s),t.find("input").simulate("change",{target:{value:u}}),(0,_InputTestUtils.assertInputValue)(t,l),expect(e()).toBe(c)}),it("props: DefaultValueLimitAmountInput defaultValue",function(){var e=(_inherits(t,_react2.default.Component),_createClass(t,[{key:"render",value:function(){return _react2.default.createElement(_index2.default,{defaultValue:this.props.defaultValue})}}]),t);function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}var n=(0,_enzyme.mount)(_react2.default.createElement(e,{defaultValue:a}));(0,_InputTestUtils.assertInputValue)(n,o),n.find("input").simulate("change",{target:{value:u}}),(0,_InputTestUtils.assertInputValue)(n,l)}),e("props: null keyPressValue : 1234  onChange ",{},["1234567890","0.000","1.234","9999999999999","1234567890.123"],["1,234,567,890","0.000","1.234","9,999,999,999,999","1,234,567,890.123"],["1234567890","0.000","1.234",9999999999999,1234567890.123],["壹拾贰亿叁仟肆佰伍拾陆万柒仟捌佰玖拾元整","零元整","壹元贰角叁分肆厘","玖兆玖仟玖佰玖拾玖亿玖仟玖佰玖拾玖万玖仟玖佰玖拾玖元整","壹拾贰亿叁仟肆佰伍拾陆万柒仟捌佰玖拾元壹角贰分叁厘"]),e("props: disabled is true  onChange ",{disabled:!0,value:"111"},["1234","5678"],["111","111"],[1234,5678],["壹仟贰佰叁拾肆元整",c]),it("onTransform defaultValue: 1234",function(){function e(){return t.children().find("lugia_widget_Tooltip").props().title.props.children}var t=(0,_enzyme.mount)(_react2.default.createElement(_index2.default,{defaultValue:a}));t.find("lugia_widget_AmountInput").at(0).simulate("focus"),expect(e()).toBe(s),t.find("toolTip_title").at(0).simulate("click"),expect(d(t).state.value).toBe(a+""),(0,_InputTestUtils.assertInputValue)(t,s),expect(e()).toBe(n),t.find("toolTip_title").at(0).simulate("click"),expect(d(t).state.value).toBe(a+""),(0,_InputTestUtils.assertInputValue)(t,o),expect(e()).toBe(s)}),it("props.value 2 state.value",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_index2.default,{defaultValue:a}));expect(d(e).state.value).toBe(a+""),e.setProps({value:"壹佰元整"}),expect(d(e).state.value).toBe("100");e.setProps({value:"100000"}),expect(d(e).state.value).toBe("100000")})});