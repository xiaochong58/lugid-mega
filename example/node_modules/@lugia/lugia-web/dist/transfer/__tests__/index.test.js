"use strict";var _react=require("react"),_react2=_interopRequireDefault(_react),_chai=require("chai"),_chai2=_interopRequireDefault(_chai),_jsdom=require("jsdom"),_jsdom2=_interopRequireDefault(_jsdom);require("jest-styled-components");var _enzyme=require("enzyme"),_enzyme2=_interopRequireDefault(_enzyme),_enzymeAdapterReact=require("enzyme-adapter-react-16"),_enzymeAdapterReact2=_interopRequireDefault(_enzymeAdapterReact),_demo=require("../demo"),_demo2=_interopRequireDefault(_demo),_reactTestRenderer=require("react-test-renderer"),_reactTestRenderer2=_interopRequireDefault(_reactTestRenderer),_group=require("../group"),_group2=_interopRequireDefault(_group),_transfer=require("../transfer"),_transfer2=_interopRequireDefault(_transfer),_model=require("../model"),_model2=_interopRequireDefault(_model),_transferButton=require("../transfer-button"),_transferButton2=_interopRequireDefault(_transferButton);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var exp=_chai2.default.expect,JSDOM=_jsdom2.default.JSDOM;_enzyme2.default.configure({adapter:new _enzymeAdapterReact2.default}),describe("Transfer",function(){it("css",function(){var e=_react2.default.createElement(_demo2.default,null);global.window=new JSDOM('<!doctype html><html><body><div id="root"></div></body></html>').window,global.document=global.window.document,expect(_reactTestRenderer2.default.create(e).toJSON()).toMatchSnapshot()});function _(e,t,a){return e.find(t).at(a).instance()}var m=[{text:"选项1",value:"选项1",disabled:!1},{text:"选项2",value:"选项2",disabled:!1},{text:"选项3",value:"选项3",disabled:!1},{text:"选项4",value:"选项4",disabled:!1},{text:"选项5",value:"选项5",disabled:!0},{text:"选项6",value:"选项6",disabled:!1}],u={"选项1":{text:"选项1",value:"选项1",disabled:!1},"选项2":{text:"选项2",value:"选项2",disabled:!1},"选项3":{text:"选项3",value:"选项3",disabled:!1},"选项4":{text:"选项4",value:"选项4",disabled:!1},"选项5":{text:"选项5",value:"选项5",disabled:!0},"选项6":{text:"选项6",value:"选项6",disabled:!1}};it("Transfer: Source/Target-panel state",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,sourceSelectedKeys:[]})),t=_(e,"TransferPanel",0).state,a=t.inputValue,l=t.selectedKeys,r=t.typeList,n=t.cancelItem;expect(a).toBe(""),expect(l).toEqual([]),expect(r).toEqual({blackList:[]}),expect(n).toEqual([]);var c=_(e,"TransferPanel",1).state,o=c.inputValue,u=c.selectedKeys,d=c.typeList,s=c.cancelItem;expect(o).toBe(""),expect(u).toEqual([]),expect(d).toEqual({whiteList:[]}),expect(s).toEqual([]);var i=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,sourceSelectedKeys:[],value:["选项1","选项2","A"],displayValue:["1","2","a"]})),f=_(i,"TransferPanel",0);expect(f.state.typeList).toEqual({blackList:["选项1","选项2","A"]}),expect(f.state.cancelItem).toEqual([{text:"a",value:"A"}]);var p=_(i,"TransferPanel",1);expect(p.state.typeList).toEqual({whiteList:["选项1","选项2","A"]}),i.setProps({value:["选项1","选项2","选项3"]});var g=_(i,"TransferPanel",0).state,y=_(i,"TransferPanel",1).state;expect(g.typeList).toEqual({blackList:["选项1","选项2","选项3"]}),expect(y.typeList).toEqual({whiteList:["选项1","选项2","选项3"]}),i.setProps({displayValue:["1","2","a","b"],value:["选项1","选项2","选项3","B"]}),expect(_(i,"TransferPanel",1).state.cancelItem).toEqual([{text:"b",value:"B"}])}),it("Transfer: getTargetSelectedKeys/getSourceSelectedKeys/getTargetKeys/getDisplayValue",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m})),t=_(e,"Transfer",0),a=t.getTargetSelectedKeys({targetSelectedKeys:["1","2"]}),l=t.getSourceSelectedKeys({sourceSelectedKeys:["1","2"]}),r=t.getDisplayValue({displayValue:["1","2"]}),n=t.getTargetKeys({value:["1","2"]});expect(a).toEqual(["1","2"]),expect(l).toEqual(["1","2"]),expect(r).toEqual(["1","2"]),expect(n).toEqual(["1","2"]);var c=t.getTargetSelectedKeys({defaultTargetSelectedKeys:["1"]}),o=t.getSourceSelectedKeys({defaultSourceSelectedKeys:["1"]}),u=t.getDisplayValue({defaultDisplayValue:["1"]}),d=t.getTargetKeys({defaultValue:["1"]});expect(c).toEqual(["1"]),expect(o).toEqual(["1"]),expect(u).toEqual(["1"]),expect(d).toEqual(["1"]);var s=t.getTargetSelectedKeys({}),i=t.getSourceSelectedKeys({}),f=t.getDisplayValue({}),p=t.getTargetKeys({});expect(s).toEqual([]),expect(i).toEqual([]),expect(f).toEqual([]),expect(p).toEqual([])}),it("Transfer: handleSourceSelect -> props: onSelectChange , sourcePanelState: selectedKeys",function(){function e(e){t=e}var t=void 0;expect(t).toBeUndefined();var a=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,onSelectChange:e}));_(a,"Transfer",0).handleSourceSelect(["1","2"]),expect(t).toEqual(["1","2"]);var l=_(a,"TransferPanel",0).state.selectedKeys;expect(l).toEqual(["1","2"]);var r=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,sourceSelectedKeys:["1"],onSelectChange:e}));_(r,"Transfer",0).handleSourceSelect(["1","2","3"]),expect(t).toEqual(["1","2","3"]);var n=_(r,"TransferPanel",0).state.selectedKeys;expect(n).toEqual(["1"]),r.setProps({sourceSelectedKeys:["2"]}),expect(_(r,"TransferPanel",0).state.selectedKeys).toEqual(["2"])}),it("Transfer: handleTargetSelect -> props: onSelectChange , targetPanelState: selectedKeys",function(){function e(e,t){l=t,a=e}var a=void 0,l=void 0;expect(a).toBeUndefined(),expect(l).toBeUndefined();var t=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,onSelectChange:e}));_(t,"Transfer",0).handleTargetSelect(["1","2"]),expect(l).toEqual(["1","2"]),expect(a).toEqual([]);var r=_(t,"TransferPanel",1).state.selectedKeys;expect(r).toEqual(["1","2"]);var n=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,targetSelectedKeys:["1"],onSelectChange:e}));_(n,"Transfer",0).handleTargetSelect(["1","2","3"]),expect(l).toEqual(["1","2","3"]),expect(a).toEqual([]);var c=_(n,"TransferPanel",1).state.selectedKeys;expect(c).toEqual(["1"]),n.setProps({targetSelectedKeys:["2"]}),expect(_(n,"TransferPanel",1).state.selectedKeys).toEqual(["2"])}),it("Transfer: handleToRight",function(){function e(e,t,a){l=e,r=t,n=a}var l=void 0,r=void 0,n=void 0,t=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,value:["选项4"],onDirectionClick:e})),a=_(t,"Transfer",0);a.sourceModel.getMoveAfterKeysForSource=function(){return{moveKey:["选项2","选项3"],disabledKeys:["选项5"],nextTargetKeys:["选项2","选项3","选项4"]}},a.handleToRight(),expect(l).toEqual(["选项2","选项3","选项4"]),expect(r).toBe("right"),expect(n).toEqual(["选项2","选项3"]);var c=_(t,"TransferPanel",0);expect(c.state.selectedKeys).toEqual([]);var o=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,defaultValue:["选项4"],onDirectionClick:e})),u=_(o,"Transfer",0);u.sourceModel.getMoveAfterKeysForSource=function(){return{moveKey:["选项1","选项2"],disabledKeys:["选项5"],nextTargetKeys:["选项1","选项2","选项4"]}},u.handleToRight(),expect(l).toEqual(["选项1","选项2","选项4"]),expect(r).toBe("right"),expect(n).toEqual(["选项1","选项2"]);var d=_(o,"TransferPanel",0);expect(d.state.selectedKeys).toEqual(["选项5"]),expect(u.sourceModel.getList()).toEqual(["选项1","选项2","选项4"]),expect(u.targetModel.getList()).toEqual(["选项1","选项2","选项4"])}),it("Transfer: handleToLeft",function(){function e(e,t,a){l=e,r=t,n=a}var l=void 0,r=void 0,n=void 0,t=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,value:["选项2","选项3","选项4","选项5"],onDirectionClick:e})),a=_(t,"Transfer",0);a.targetModel.getMoveAfterKeysForTarget=function(){return{moveKey:["选项2","选项3"],disabledKeys:["选项5"],nextTargetKeys:["选项4","选项5"]}},a.handleToLeft(),expect(l).toEqual(["选项4","选项5"]),expect(r).toBe("left"),expect(n).toEqual(["选项2","选项3"]);var c=_(t,"TransferPanel",1);expect(c.state.selectedKeys).toEqual([]);var o=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,defaultValue:["选项2","选项3","选项4","选项5"],onDirectionClick:e})),u=_(o,"Transfer",0);u.targetModel.getMoveAfterKeysForTarget=function(){return{moveKey:["选项2","选项3"],disabledKeys:["选项5"],nextTargetKeys:["选项4","选项5"]}},u.handleToLeft(),expect(l).toEqual(["选项4","选项5"]),expect(r).toBe("left"),expect(n).toEqual(["选项2","选项3"]);var d=_(o,"TransferPanel",1);expect(d.state.selectedKeys).toEqual(["选项5"]),expect(u.targetModel.getList()).toEqual(["选项4","选项5"]),expect(u.sourceModel.getList()).toEqual(["选项4","选项5"])}),it("Transfer: getTreeCanCheckKeys",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,value:["选项2","选项3","选项4","选项5"]})),t=_(e,"Transfer",0),a=t.getTreeCanCheckKeys(u,["选项4","选项5","选项6"]),l=a.sourceEnableKeys,r=a.targetEnableKeys;expect(l).toEqual(["选项1","选项2","选项3"]),expect(r).toEqual(["选项4","选项5","选项6"]);var n=t.getTreeCanCheckKeys(u,[]),c=n.sourceEnableKeys,o=n.targetEnableKeys;expect(c).toEqual(["选项1","选项2","选项3","选项4","选项5","选项6"]),expect(o).toEqual([])}),it("Transfer: checkAllForLeft",function(){function e(e,t){a=e,l=t}var a=void 0,l=void 0,t=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,onSelectChange:e,value:["选项2","选项3","选项4","选项5"],targetSelectedKeys:["选项2","选项3"]})),r=_(t,"Transfer",0);r.sourceModel.getCheckAllKeys=function(){return["选项1","选项6"]},r.checkAllForLeft(),expect(a).toEqual(["选项1","选项6"]),expect(l).toEqual(["选项2","选项3"]),expect(r.sourceModel.getSelectedkeys()).toEqual(["选项1","选项6"]);var n=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,onSelectChange:e,value:["选项2","选项3","选项4","选项5"],sourceSelectedKeys:["选项2","选项3"]})),c=_(n,"Transfer",0);c.sourceModel.getCheckAllKeys=function(){return["选项1","选项6"]},c.checkAllForLeft(),expect(c.sourceModel.getSelectedkeys()).toEqual(["选项2","选项3"])}),it("Transfer: checkAllForRight",function(){function e(e,t){a=e,l=t}var a=void 0,l=void 0,t=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,onSelectChange:e,value:["选项2","选项3","选项4","选项5"],targetSelectedKeys:["选项2","选项3"]})),r=_(t,"Transfer",0);r.targetModel.getCheckAllKeys=function(){return["选项1","选项6"]},r.checkAllForRight(),expect(a).toEqual([]),expect(l).toEqual(["选项1","选项6"]),expect(r.targetModel.getSelectedkeys()).toEqual(["选项2","选项3"]);var n=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,onSelectChange:e,value:["选项2","选项3","选项4","选项5"],sourceSelectedKeys:["选项2","选项3"]})),c=_(n,"Transfer",0);c.targetModel.getCheckAllKeys=function(){return["选项1","选项6"]},c.checkAllForRight(),expect(c.targetModel.getSelectedkeys()).toEqual(["选项1","选项6"])}),it("Transfer: handleCancelItemClick",function(){function e(e,t){a=e,l=t}var a=void 0,l=void 0,t=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,value:["选项2","选项3","a"],displayValue:["选项2","选项3","A"],onCancelItemClick:e})),r=_(t,"Transfer",0);r.handleCancelItemClick("a"),expect(a).toEqual(["选项2","选项3"]),expect(l).toEqual(["选项2","选项3"]),expect(r.targetModel.getCancelItem()).toEqual([{text:"A",value:"a"}]);var n=(0,_enzyme.mount)(_react2.default.createElement(_group2.default,{data:m,value:["选项2","选项3","a"],defaultDisplayValue:["选项2","选项3","A"],onCancelItemClick:e})),c=_(n,"Transfer",0);c.handleCancelItemClick("a"),expect(a).toEqual(["选项2","选项3"]),expect(l).toEqual(["选项2","选项3"]),expect(c.targetModel.getCancelItem()).toEqual([])}),it("TransferPanel: getTreeData",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_transfer2.default,{data:m,model:new _model2.default({type:"Target",selectedKeys:[],list:[]})})),t=_(e,"TransferPanel",0);expect(t.state.treeDataLength).toBe(0),t.getTreeData([{},{}]),expect(t.state.treeDataLength).toBe(2),t.getTreeData([1,2]),expect(t.state.treeDataLength).toBe(2)}),it("TransferPanel: getDataLength",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_transfer2.default,{data:m,model:new _model2.default({type:"Target",selectedKeys:[],list:["选项4","选项5","选项6"]})})),t=_(e,"TransferPanel",0);t.props.model.cancelItem=[{},{}];var a=t.getDataLength();expect(a).toBe(1);var l=(0,_enzyme.mount)(_react2.default.createElement(_transfer2.default,{data:m,model:new _model2.default({type:"Source",selectedKeys:[],list:["选项4","选项5","选项6"]})})),r=_(l,"TransferPanel",0);r.props.model.cancelItem=[{},{}];var n=r.getDataLength();expect(n).toBe(5)}),it("TransferButton: state disabled can not onClick run",function(){var e=0,t=0,a=(0,_enzyme.mount)(_react2.default.createElement(_transferButton2.default,{onLeftClick:function(){e+=1},onRightClick:function(){t++},leftModel:{getSelectedkeys:function(){return["1","2"]},on:function(){}},rightModel:{getSelectedkeys:function(){return["1","2","3"]},on:function(){}}})),l=_(a,"TransferButton",0);l.handleClick("left")(),l.handleClick("right")(),expect(e).toBe(1),expect(t).toBe(1),l.setState({leftDisabled:!0,rightDisabled:!0}),l.handleClick("left"),l.handleClick("right"),expect(e).toBe(1),expect(t).toBe(1)})});