"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp,_initialiseProps,_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_themeUtils=require("@lugia/theme-utils"),_objectUtils=require("@lugia/object-utils"),_themeProvider=require("../theme-provider"),_themeProvider2=_interopRequireDefault(_themeProvider),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_transferMenu=require("./transfer-menu"),_transferMenu2=_interopRequireDefault(_transferMenu),_tree=require("../tree"),_tree2=_interopRequireDefault(_tree),_menu=require("../menu"),_menu2=_interopRequireDefault(_menu),_input=require("../input"),_input2=_interopRequireDefault(_input),_checkbox=require("../checkbox"),_checkbox2=_interopRequireDefault(_checkbox),_SearchIcon=require("../icon/SearchIcon"),_SearchIcon2=_interopRequireDefault(_SearchIcon),_transfer=require("../css/transfer"),_utils=require("./utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var MenuItem=_menu2.default.MenuItem,cancelBoxHeight=70;exports.default=(0,_themeProvider2.default)((_temp=_class=function(){function l(e){_classCallCheck(this,l);var n=_possibleConstructorReturn(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e));_initialiseProps.call(n);var t=n.props,r=t.model,a=t.direction,i=(0,_utils.filterEnableKeysFromSelectKeys)(r.getList(),r.getSelectedkeys(),a);return n.state={inputValue:"",selectedKeys:i,typeList:r.getTypeList(),cancelItem:r.getCancelItem(),treeData:r.getTreeData(),treeDataLength:0},r.on("onSelectedKeyChange",function(e){var t=e.data;n.setState({selectedKeys:t})}),r.on("onListChange",function(e){var t=e.data;n.setState({typeList:t})}),r.on("onCancelItemChange",function(e){var t=e.data;n.setState({cancelItem:t})}),n}return _inherits(l,React.Component),_createClass(l,[{key:"render",value:function(){var e=this,t=this.state,n=t.selectedKeys,r=void 0===n?[]:n,a=t.treeDataLength,i=t.cancelItem,l=this.props,o=l.needCancelBox,c=void 0!==o&&o,s=l.type,u=l.title,h=this.props,p=h.theme,f=void 0===p?{}:p,m=h.checkboxTheme,d=h.headerTextTheme,_=h.headerTheme,g=h.cancelBoxTheme,v=c&&i&&i.length?React.createElement(_transfer.CancelBox,{themeProps:g},React.createElement(_menu2.default,this.getCancelMenuTheme(),this.createCancelCheckBox())):null,C="panel"===s?this.getDataLength():a,y=r&&r.length||0,b=0!==y&&("panel"===s?y>=this.getDataLength():a<=y);return React.createElement(_transfer.TransFer,{themeProps:f},React.createElement(_transfer.Check,{themeProps:_},React.createElement(_checkbox2.default,Object.assign({onChange:function(){return e.props.onCheckAll(!b)},checked:b,indeterminate:0<r.length},m),u),React.createElement(_transfer.CheckText,{themeProps:d},r.length,"/",C)),this.getSearchBox(),this.getTransferPanel(),v)}},{key:"getSearchBox",value:function(){var e=this.state.inputValue,t=this.props.showSearch,n={};return e||(n.suffix=React.createElement(_SearchIcon2.default,null)),t?React.createElement(_input2.default,Object.assign({onChange:this.handleInputChange,placeholder:"搜索你想知道的内容"},n,this.getInputThemeConfig())):null}},{key:"getTransferPanel",value:function(){var e=this.state,t=e.selectedKeys,n=void 0===t?[]:t,r=e.typeList,a=e.treeData,i=e.inputValue,l=this.props,o=l.type,c=l.direction,s=l.displayField,u=l.valueField,h=this.getPanelThemeConfig(c),p=h.menuTheme,f=h.treeTheme,m=h.wrapHeight;return"panel"===o?React.createElement("div",null,React.createElement(_transferMenu2.default,Object.assign({},this.props,{query:i},r,{selectedKeys:n,height:m,menuThemeObj:p}))):React.createElement(_transfer.TreeWrap,{height:m},React.createElement(_tree2.default,Object.assign({displayField:s,valueField:u,data:a,value:n,expandAll:!0,mutliple:!0,onChange:this.handleTreeChange,query:i},r,{getTreeData:this.getTreeData},f)))}},{key:"getInputThemeConfig",value:function(){var e=this.props.inputTheme,t=void 0===e?{}:e,n=t.viewClass,r=t.theme,a=_defineProperty({},n,{Container:{normal:{width:184,margin:{top:8,right:8,bottom:16,left:8}}},Input:{normal:{border:(0,_themeUtils.getBorder)({width:1,style:"solid",color:"#e8e8e8"})}},InputSuffix:{normal:{color:"#999999",fontSize:12}}});return{viewClass:n,theme:(0,_objectUtils.deepMerge)(a,r)}}},{key:"componentWillUnmount",value:function(){this.props.model.removeAllListeners()}}]),l}(),_class.displayName="TransferPanel",_initialiseProps=function(){var m=this;this.createCancelCheckBox=function(){var e=m.props,n=e.displayField,r=e.valueField,t=e.cancelCheckboxTheme,a=void 0===t?{}:t,i=m.state.cancelItem,l=void 0===i?[]:i;return l&&0<l.length?l.map(function(e,t){return React.createElement(MenuItem,{key:e[r]},React.createElement(_transfer.CancelBoxItem,null,React.createElement(_checkbox2.default,Object.assign({key:t,value:e[r],cancel:!0,handleCancelItemClick:m.cancelItemClick},a),e[n])))}):null},this.getCancelMenuTheme=function(){var e=m.props,t=e.cancelBoxMenuTheme,n=void 0===t?{}:t,r=e.needCancelBox;if(!(void 0!==r&&r))return{};var a=n.viewClass,i=n.theme,l=_defineProperty({},a,{Container:{normal:{height:cancelBoxHeight,width:200}}});return{viewClass:a,theme:(0,_objectUtils.deepMerge)(l,i)}},this.getCancelBoxHeight=function(){var e=(0,m.props.getPartOfThemeProps)("TransferCancelBox").themeConfig.normal,t=(void 0===e?{}:e).height;return void 0===t?cancelBoxHeight+6:t},this.getPanelThemeConfig=function(e){var t=m.state.cancelItem,n=m.props,r=n.menuTheme,a=n.treeTheme,i=r.viewClass,l=r.theme,o=a.viewClass,c=a.theme,s={width:200,height:206};if("Source"!==e&&t&&t.length){var u=m.getCancelBoxHeight();s.height=206-u}var h=s.height,p=_defineProperty({},i,{Container:{normal:Object.assign({},s,{boxShadow:(0,_themeUtils.getBoxShadow)("0 0")})}}),f=_defineProperty({},o,{Container:{normal:s}});return{menuTheme:{viewClass:i,theme:(0,_objectUtils.deepMerge)(p,l)},treeTheme:{viewClass:o,theme:(0,_objectUtils.deepMerge)(f,c)},wrapHeight:h}},this.getTreeData=function(e){var t=m.props,n=t.valueField,r=void 0===n?"value":n,a=t.model,i=m.treeData&&m.treeData.length;e.length!==i&&(a.setCanCheckKeys(e.map(function(e){return e[r]})),m.setState({treeDataLength:e.length})),m.treeData=e},this.getDataLength=function(){var e=m.props,t=e.model,n=e.data,r=void 0===n?[]:n;return t.getDataLength(r)},this.cancelItemClick=function(e){var t=m.props.onCancelItemClick;t&&t(e)},this.handleInputChange=function(e){var t=e.newValue;m.setState({inputValue:t})},this.onClick=function(e,t,n){var r=m.props,a=r.onSelect,i=r.valueField;a&&a([n[i]])},this.handleTreeChange=function(e){var t=m.props.onSelect;t&&t(e)}},_temp),_index2.default.Transfer);