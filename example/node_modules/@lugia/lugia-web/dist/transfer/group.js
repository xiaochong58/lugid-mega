"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp,_initialiseProps,_createClass=function(){function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_themeProvider=require("../theme-provider"),_themeProvider2=_interopRequireDefault(_themeProvider),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_transfer=require("./transfer"),_transfer2=_interopRequireDefault(_transfer),_transferButton=require("./transfer-button"),_transferButton2=_interopRequireDefault(_transferButton),_transferGroup=require("../css/transfer-group"),_props4=require("../consts/props"),_utils=require("./utils"),_menuUtils=require("./menu-utils"),_model=require("./model"),_model2=_interopRequireDefault(_model);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.default=(0,_themeProvider2.default)((_temp=_class=function(){function d(e){_classCallCheck(this,d);var t=_possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,e));_initialiseProps.call(t);var r=t.getSourceSelectedKeys(e),a=t.getTargetSelectedKeys(e),l=t.getTargetKeys(e),s=t.getDisplayValue(e);t.targetModel=new _model2.default({type:"Target",selectedKeys:a,list:l}),t.sourceModel=new _model2.default({type:"Source",selectedKeys:r,list:l});var n=e.valueField,i=void 0===n?"value":n,o=e.displayField,c=void 0===o?"text":o;t.initModel(e,l),t.targetModel.setDisplayValue(s);var u=(0,_utils.getCancelItem)(l,t.sourceModel.getMapData(),{valueField:i,displayField:c},s);return t.targetModel.setCancelItem(u),t.sourceModel.setCancelItem(u),t}return _inherits(d,React.Component),_createClass(d,[{key:"initModel",value:function(e,t){var r=e.data,a=e.valueField,l=void 0===a?"value":a,s=e.type,n=void 0===s?"panel":s,i=e.displayField,o=void 0===i?"text":i,c=void 0;if("panel"===n){c=(0,_menuUtils.getMapData)(r,l);var u=(0,_utils.getPanelSourceDataAndTargetData)(r,t,l),d=u.targetCheckKeys,h=u.sourceCheckKeys;this.targetModel.setCanCheckKeys(d),this.sourceModel.setCanCheckKeys(h)}else{var g=(0,_utils.getTreeData)(r,{displayField:o,valueField:l}),p=g.mapData,y=g.target;c=p,this.targetModel.setTreeData(y),this.sourceModel.setTreeData(y);var f=this.getTreeCanCheckKeys(p,t),v=f.sourceEnableKeys,_=f.targetEnableKeys;this.targetModel.setCanCheckKeys(_),this.sourceModel.setCanCheckKeys(v)}this.targetModel.setMapData(c),this.sourceModel.setMapData(c)}},{key:"getTargetSelectedKeys",value:function(e){return(0,_utils.getTruthValue)("targetSelectedKeys",e,void 0,"defaultTargetSelectedKeys")}},{key:"getSourceSelectedKeys",value:function(e){return(0,_utils.getTruthValue)("sourceSelectedKeys",e,void 0,"defaultSourceSelectedKeys")}},{key:"getTargetKeys",value:function(e){return(0,_utils.getTruthValue)("value",e,void 0,"defaultValue")}},{key:"getDisplayValue",value:function(e){return(0,_utils.getTruthValue)("displayValue",e,void 0,"defaultDisplayValue")}},{key:"shouldComponentUpdate",value:function(e,t){var r=e.valueField,a=void 0===r?"value":r,l=e.displayField,s=void 0===l?"text":l,n=this.props.data,i=void 0===n?[]:n,o=e.data;if((void 0===o?[]:o).length!==i.length||e.data!==this.props.data){var c=this.getTargetKeys(e);this.initModel(e,c)}if(this.isInProps("targetSelectedKeys")&&this.targetModel.changeSelectedKeys(this.getTargetSelectedKeys(e)),this.isInProps("sourceSelectedKeys")&&this.sourceModel.changeSelectedKeys(this.getSourceSelectedKeys(e)),this.isInProps("value")){var u=this.getTargetKeys(e);this.updateChangeList(u)}if(this.isInProps("displayValue")){var d=this.targetModel.getList(),h=this.targetModel.getMapData(),g=this.getDisplayValue(e),p=(0,_utils.getCancelItem)(d,h,{valueField:a,displayField:s},g);this.targetModel.changeCancelItem(p),this.sourceModel.setCancelItem(p),this.targetModel.setDisplayValue(g)}return!0}},{key:"render",value:function(){var e=this.props,t=e.type,r=void 0===t?"panel":t,a=e.valueField,l=void 0===a?_props4.ValueField:a,s=e.displayField,n=void 0===s?_props4.DisplayField:s,i=e.getPartOfThemeProps,o=e.getPartOfThemeHocProps,c=i("TransferWrap"),u=i("TransferPanel"),d=o("TransferPanelHeaderCheckbox"),h=i("TransferHeaderText"),g=i("TransferHeaderWrap"),p=o("TransferSearchInput"),y=i("TransferCancelBox"),f=o("TransferCancelCheckbox"),v=o("TransferCancelBoxMenu"),_=o("TransferPanelMenu"),C=o("TransferPanelTree"),m=o("TransferButton");return React.createElement(_transferGroup.TransFerWrap,{themeProps:c},React.createElement(_transfer2.default,Object.assign({key:"1",direction:"Source",onSelect:this.handleSourceSelect,model:this.sourceModel,onCheckAll:this.checkAllForLeft,title:"列表A"},this.props,{displayField:n,valueField:l,type:r,theme:u,checkboxTheme:d,headerTextTheme:h,headerTheme:g,menuTheme:_,treeTheme:C,inputTheme:p})),React.createElement(_transferButton2.default,{leftModel:this.sourceModel,rightModel:this.targetModel,onLeftClick:this.handleToRight,onRightClick:this.handleToLeft,theme:m}),React.createElement(_transfer2.default,Object.assign({key:"2",model:this.targetModel,direction:"Target",onSelect:this.handleTargetSelect,onCheckAll:this.checkAllForRight,needCancelBox:!0,onCancelItemClick:this.handleCancelItemClick,title:"列表B"},this.props,{displayField:n,valueField:l,type:r,theme:u,checkboxTheme:d,headerTextTheme:h,headerTheme:g,cancelBoxTheme:y,cancelCheckboxTheme:f,cancelBoxMenuTheme:v,menuTheme:_,treeTheme:C,inputTheme:p})))}},{key:"onSelectChange",value:function(e,t){var r=this.props.onSelectChange;r&&r(e,t)}},{key:"changeSelectedKeys",value:function(e,t){this.isInProps(e)||("targetSelectedKeys"===e?this.targetModel:this.sourceModel).changeSelectedKeys(t)}},{key:"updateChangeList",value:function(e){var t=this.props.type,r=void 0===t?"panel":t;this.targetModel.changeList(e),this.sourceModel.changeList(e);var a=this.getEnableKeys(r,e),l=a.sourceEnableKeys,s=a.targetEnableKeys;this.targetModel.setCanCheckKeys(s),this.sourceModel.setCanCheckKeys(l)}},{key:"getTreeCanCheckKeys",value:function(e,t){var r=Object.assign({},e);if(!t||!t.length)return{sourceEnableKeys:Object.keys(r),targetEnableKeys:[]};var a=t.filter(function(e){var t=r[e];return t&&delete r[e],t});return{sourceEnableKeys:Object.keys(r),targetEnableKeys:a}}},{key:"isInProps",value:function(e){return e in this.props}}]),d}(),_class.displayName="Transfer",_initialiseProps=function(){var y=this;this.handleSourceSelect=function(e){var t=y.targetModel.getSelectedkeys();y.onSelectChange(e,t),y.changeSelectedKeys("sourceSelectedKeys",e)},this.handleTargetSelect=function(e){var t=y.sourceModel.getSelectedkeys();y.onSelectChange(t,e),y.changeSelectedKeys("targetSelectedKeys",e)},this.handleToLeft=function(){y.handleTransfer("left")},this.handleToRight=function(){y.handleTransfer("right")},this.handleTransfer=function(e){var t="right"===e?y.sourceModel:y.targetModel,r=("right"===e?y.sourceModel.getMoveAfterKeysForSource:y.targetModel.getMoveAfterKeysForTarget)(),a=r.moveKey,l=r.disabledKeys,s=r.nextTargetKeys,n=y.props.onDirectionClick;n&&n(s,e,a),y.isInProps("value")||(t.changeSelectedKeys(l),y.updateChangeList(s))},this.getEnableKeys=function(e,t){var r=y.props,a=r.data,l=r.valueField,s=void 0===l?"value":l;if("panel"===e){var n=(0,_utils.getPanelSourceDataAndTargetData)(a,t,s),i=n.targetCheckKeys;return{sourceEnableKeys:n.sourceCheckKeys,targetEnableKeys:i}}var o=y.sourceModel.getMapData(),c=y.getTreeCanCheckKeys(o,t);return{sourceEnableKeys:c.sourceEnableKeys,targetEnableKeys:c.targetEnableKeys}},this.checkAllForLeft=function(e){var t=y.sourceModel.getCheckAllKeys(e),r=y.targetModel.getSelectedkeys();y.onSelectChange(t,r),y.changeSelectedKeys("sourceSelectedKeys",t)},this.checkAllForRight=function(e){var t=y.targetModel.getCheckAllKeys(e),r=y.sourceModel.getSelectedkeys();y.onSelectChange(r,t),y.changeSelectedKeys("targetSelectedKeys",t)},this.handleCancelItemClick=function(e){var t=y.targetModel.getDisplayValue(),r=y.targetModel.getList(),a=[].concat(_toConsumableArray(t)),l=[].concat(_toConsumableArray(r)),s=r.indexOf(e);a.splice(s,1),l.splice(s,1);var n=y.props.onCancelItemClick,i=y.isInProps("displayValue");if(n&&n(l,a),!i){var o=y.targetModel.getMapData(),c=y.props,u=c.displayField,d=void 0===u?"text":u,h=c.valueField,g=void 0===h?"value":h,p=(0,_utils.getCancelItem)(l,o,{valueField:g,displayField:d},a);y.targetModel.changeCancelItem(p),y.targetModel.setDisplayValue(a),y.targetModel.changeList(l),y.sourceModel.setCancelItem(p),y.sourceModel.changeList(l)}}},_temp),_index2.default.Transfer);