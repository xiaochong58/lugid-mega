"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_trigger2=require("../trigger"),_trigger3=_interopRequireDefault(_trigger2),_theme=require("../theme"),_theme2=_interopRequireDefault(_theme),_themeProvider=require("../theme-provider"),_themeProvider2=_interopRequireDefault(_themeProvider),_objectUtils=require("@lugia/object-utils"),_index=require("../consts/index"),_index2=_interopRequireDefault(_index);require("../common/shirm");var _menu=require("../menu"),_menu2=_interopRequireDefault(_menu),_dropmenuButton=require("./dropmenuButton"),_dropmenuButton2=_interopRequireDefault(_dropmenuButton);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var alignType="topLeft | top | topRight | bottomLeft | bottom | bottomRight",defaultData=[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}],DropMenu=function(){function t(e){_classCallCheck(this,t);var u=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u.ejectOnClick=function(r){var e={};return r.props.onClick?e.onClick=function(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.props.onClick).call.apply(e,[r].concat(n)),u.onMenuClick.apply(u,n)}:e.onClick=u.onMenuClick,e},u.onMenuClick=function(e,t,n){var i=u.props.onMenuClick,r=n.children;r&&0!==r.length?u.isLeaf=!1:(u.isLeaf=!0,u.onPopupVisibleChange(!1));var o=t.selectedKeys[0];i&&i({e:e,key:o,item:n})},u.getOffSetY=function(e){return"topLeft"===e||"topRight"===e||"top"===e?-4:4},u.onQuery=function(e){var t=u.props.onQuery;t&&t(e)},u.onPopupVisibleChange=function(e){var t=u.props.onPopupVisibleChange;u.isLeaf&&(setTimeout(function(){u.setState({popupVisible:e})},200),t&&t(e))},u.mergeTheme=function(e,t){var n=u.props.getPartOfThemeHocProps(e),i=n.viewClass,r=n.theme;return(0,_objectUtils.deepMerge)(_defineProperty({},i,Object.assign({},t)),r)[i]},u.getContainerWidth=function(){var e=u.getDropMenuButtonTheme().Container;return(void 0===e?{}:e).normal.width},u.getMenuTheme=function(){var e=u.props.getPartOfThemeConfig("Container").normal,t=(e=void 0===e?{}:e).width,n=void 0===t?92:t,i={width:n,height:110};"number"!=typeof n&&(i={width:92,height:110});var r={Container:{normal:i},MenuItem:{MenuItemWrap:{normal:{font:{weight:500}}}}};return u.mergeTheme("Menu",r)},u.getDropMenuButtonTheme=function(){var e=u.props.getPartOfThemeConfig;return{Container:e("Container"),PrefixIcon:e("PrefixIcon"),SuffixIcon:e("SuffixIcon"),SwitchIcon:e("SwitchIcon"),Divided:e("Divided"),TextContainer:e("TextContainer"),SwitchIconContainer:e("SwitchIconContainer")}},u.state={filter:"",popupVisible:void 0!==e.popupVisible&&e.popupVisible},u.isLeaf=!0,u}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e,t=this,n=this.props,i=n.menus,r=n.action,o=n.hideAction,u=n.align,a=n.createPortal,l=(_defineProperty(e={},_index2.default.DropMenuButton,this.getDropMenuButtonTheme()),_defineProperty(e,_index2.default.Menu,this.getMenuTheme()),e),p=void 0;if(i){var c=React.Children.only(i);p=React.createElement("div",null,React.cloneElement(c,this.ejectOnClick(c)))}else{var s=this.props,f=s.data,d=void 0===f?defaultData:f,h=s.autoHeight,m=s.defualtHeight;p=React.createElement(_menu2.default,{data:d,autoHeight:h,defualtHeight:m,onClick:this.onMenuClick})}var _=this.getOffSetY(u);return React.createElement(_theme2.default,{config:Object.assign({},l)},React.createElement(_trigger3.default,{themePass:!0,ref:function(e){return t.trigger=e},align:u,action:r,offsetY:_,lazy:!1,createPortal:a,hideAction:o,onPopupVisibleChange:this.onPopupVisibleChange,popupVisible:this.state.popupVisible,popup:p},this.getChildrenItem()))}},{key:"getChildrenItem",value:function(){var e=this.props.children;if(e)return e;var t=this.props,n=t.text,i=t.divided,r=t.type,o=t._onClick,u=t.onClick,a=t.onMouseEnter,l=t.onMouseLeave,p=t.disabled,c=t.switchIconClass,s=t.showSwitch,f=t.icons;return React.createElement(_dropmenuButton2.default,{text:n,divided:i,type:r,_onClick:o,onClick:u,onMouseEnter:a,onMouseLeave:l,disabled:p,switchIconClass:c,showSwitch:s,icons:f})}},{key:"setPopupVisible",value:function(){var e;this.trigger&&(e=this.trigger).setPopupVisible.apply(e,arguments)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t?{popupVisible:void 0!==e.popupVisible?e.popupVisible:t.popupVisible}:{}}}]),t}();DropMenu.defaultProps={action:"click",hideAction:"click",align:"bottom",text:"下拉菜单",divided:!0,type:"customs",disabled:!1,showSwitch:!0,autoHeight:!1,icons:{},createPortal:!0},DropMenu.displayName=_index2.default.DropMenu;var Result=(0,_themeProvider2.default)(DropMenu,_index2.default.DropMenu);Result.Button=_dropmenuButton2.default,exports.default=Result;