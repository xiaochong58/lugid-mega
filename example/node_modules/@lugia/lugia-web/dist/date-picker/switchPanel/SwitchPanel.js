"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_Date=require("../panel/Date"),_Date2=_interopRequireDefault(_Date),_Month=require("../panel/Month"),_Month2=_interopRequireDefault(_Month),_Year=require("../panel/Year"),_Year2=_interopRequireDefault(_Year),_Weeks=require("../panel/Weeks"),_Weeks2=_interopRequireDefault(_Weeks),_Time=require("../panel/Time"),_Time2=_interopRequireDefault(_Time),_getDerived=require("../utils/getDerived"),_booleanUtils=require("../utils/booleanUtils"),_differUtils=require("../utils/differUtils"),_moment=require("moment"),_moment2=_interopRequireDefault(_moment);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var SwitchPanel=function(){function a(e){_classCallCheck(this,a);var _=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));_.getMode=function(e){var t=e.mode,a=e.from;_.setState({mode:t,from:a})},_.setTriggerVisible=function(e){var t=_.props.setTriggerVisible;t&&t(e)},_.changeHead=function(e){_.setStateFunc({value:e})},_.changeYear=function(e){var t=e.year,a=e.mode,n=e.event,r=_.state,o=r.format,i=r.value,s=(0,_booleanUtils.modeStyle)(_.props.mode),u=s.isYear,l=s.isWeeks,c=l?"YYYY-MM-DD":o,m=(0,_moment2.default)(i,c).set({year:t}).format(c);u&&_.publicOnchange({newValue:m,event:n,openTriger:!1,action:"click"}),l&&(m=(0,_moment2.default)(m,c).set({date:9}).format(c)),_.setStateFunc({value:m,year:t,mode:a})},_.changeMonth=function(e){var t=e.year,a=e.month,n=e.mode,r=e.event,o=_.state,i=o.format,s=o.value,u=(0,_booleanUtils.modeStyle)(_.props.mode),l=u.isMonth,c=u.isWeeks,m=c?"YYYY-MM-DD":i,f=(0,_moment2.default)(s).date(),h=(0,_moment2.default)().set({month:a}).daysInMonth(),d=h<f?h:f,p=(0,_moment2.default)(s,m).set({date:d,year:t,month:a}).format(m);l&&_.publicOnchange({newValue:p,openTriger:!1,event:r}),c&&(p=(0,_moment2.default)(p,m).set({date:9}).format(m)),_.setStateFunc({month:a,year:t,mode:n,value:p})},_.monthChangeYear=function(e){var t=e.mode,a=e.from;_.setStateFunc({mode:t,from:a})},_.changeWeek=function(e){var t=e.year,a=e.weeks,n=e.mode,r=e.event,o=_.state.format,i=(0,_booleanUtils.modeStyle)(_.props.mode),s=i.isWeek,u=i.isWeeks,l=u||s?o:"YYYY-WW",c=(0,_differUtils.getweekFormatValue)(t,a,l),m=(0,_differUtils.getValueFromWeekToDate)(c,l);(s||u)&&_.publicOnchange({newValue:c,openTriger:!1,event:r,action:"click"}),_.setStateFunc({year:t,mode:n,from:"week",value:m})},_.weekChangeYear=function(e){var t=e.mode,a=e.from;_.setStateFunc({mode:t,from:a})},_.onChange=function(e){var t=e.newValue,a=(0,_booleanUtils.modeStyle)(_.props.mode),n=a.isRange,r=t;if(a.isWeeks){var o=_.state.format,i=(0,_differUtils.getWeeksRangeInDates)((0,_moment2.default)(t,"YYYY-MM-DD")),s=i.year,u=i.weeks;r=(0,_differUtils.getweekFormatValue)(s,u,o)}n||_.setStateFunc({value:t}),_.publicOnchange(Object.assign({},e,{newValue:r,openTriger:!1}))},_.publicOnchange=function(e){var t=_.props.onChange;t&&t(e)},_.changeTime=function(e){var t=_.props.timeIndex,a=e.value,n=_.props,r=n.timeChange,o=n.onChange;r&&r(Object.assign({},e,{timeIndex:t})),o&&o(e),_.setStateFunc({value:a})},_.setStateFunc=function(e){var i=_.props.status;_.setState(Object.assign({},e),function(){var e=_.props,t=e.getCurrentYandM,a=e.index,n=_.state,r=n.year,o=n.month;"showTime"!==i&&t&&t({year:r,month:o,index:a})})};var t=e.model;return t&&t.on("inputOnChange",function(e){var t=e.value;_.setState({value:t})}),_}return _inherits(a,_react.Component),_createClass(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.getCurrentYandM,a=e.index,n=this.state,r=n.year,o=n.month;t&&t({year:r,month:o,index:a})}},{key:"render",value:function(){var e=this.state,t=e.mode,a=e.from,n=e.format,r=e.panelStates,o=e.choseDayIndex,i=this.props,s=i.status,u=i.themeProps;"showTime"===s&&(t="time");var l=(0,_booleanUtils.modeStyle)(t),c=l.isWeek,m=l.isMonth,f=l.isYear,h=l.isTime,d=l.isTimes,p=this.state,_=p.value,g=p.month,v=p.timeValue,y=this.state,b=y.year,Y=y.weeks,k=Object.assign({},this.props,{format:n,from:a,panelStates:r,value:_,themeProps:u});if(c){var D=(0,_differUtils.getWeeksRangeInDates)((0,_moment2.default)(_,"YYYY-MM-DD"));b=D.year,Y=D.weeks}return f?_react2.default.createElement(_Year2.default,Object.assign({},k,{year:b,onChange:this.changeYear})):m?_react2.default.createElement(_Month2.default,Object.assign({},k,{year:b,month:g,onChange:this.changeMonth,onChangeYear:this.monthChangeYear})):c?_react2.default.createElement(_Weeks2.default,Object.assign({},k,{year:b,weeks:Y,onChange:this.changeWeek,onChangeYear:this.weekChangeYear})):h||d?_react2.default.createElement(_Time2.default,Object.assign({},k,{onChange:this.changeTime,value:v})):_react2.default.createElement(_Date2.default,Object.assign({},k,{onChange:this.onChange,changeHead:this.changeHead,getMode:this.getMode,setTriggerVisible:this.setTriggerVisible,value:_,choseDayIndex:"range"===this.props.mode?this.props.choseDayIndex:o}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=(0,_getDerived.getDerived)(e,t),n=a.format,r=a.value,o=a.year,i=a.month,s=a.weeks,u=a.choseDayIndex,l=e.timeValue,c=t?t.mode:e.mode,m=t?t.from:c;return{value:r,timeValue:t?t.value:l,year:o,weeks:s,month:i,format:n,panelStates:a,mode:c,from:m,choseDayIndex:u}}}]),a}();SwitchPanel.displayName="SwitchPanel",exports.default=SwitchPanel;