"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function r(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_moment=require("moment"),_moment2=_interopRequireDefault(_moment),_index=require("../../trigger/index"),_index2=_interopRequireDefault(_index),_input=require("../../input"),_input2=_interopRequireDefault(_input),_PageFooter=require("../panel/PageFooter"),_PageFooter2=_interopRequireDefault(_PageFooter),_getDerived=require("../utils/getDerived"),_SwitchPanel=require("../switchPanel/SwitchPanel"),_SwitchPanel2=_interopRequireDefault(_SwitchPanel),_differUtils=require("../utils/differUtils"),_utils=require("../utils/utils"),_booleanUtils=require("../utils/booleanUtils"),_styled=require("../styled/styled"),_theme=require("../../theme"),_theme2=_interopRequireDefault(_theme),_index3=require("../../consts/index"),_index4=_interopRequireDefault(_index3),_mode=require("../mode"),_mode2=_interopRequireDefault(_mode),_themeConfig=require("../themeConfig/themeConfig"),_themeConfig2=_interopRequireDefault(_themeConfig),_themeHoc=require("@lugia/theme-hoc"),_InputIcon=require("../panel/InputIcon"),_InputIcon2=_interopRequireDefault(_InputIcon);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var DateInput=function(){function e(){_classCallCheck(this,e);var b=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return b.onChange=function(e){var t=!0;b.isClear&&(t=!1);var a=e.newValue,r=e.action,o=e.event,n=b.normalStyleValueObj,i=b.state.format,l=b.props.mode,u=(0,_booleanUtils.modeStyle)(l),s=u.isWeeks,f=u.isWeek,c=u.isYear,p=u.isMonth,h=u.isTime,d="click"===r||(0,_booleanUtils.formatValueIsValid)(n,a,i),m=b.props.onChange;if(d){t=!1;var _=b.props,g=_.showTime,v=_.onOk;!g&&!v||f||c||p||(t=!0),b.setModeState(a,i,s||f)}m&&m({event:o,newValue:a,oldValue:b.oldValue}),b.setState({value:a,isValid:d}),h||b.setPopupVisible(t)},b.setModeState=function(e,t,a){var r=a?"YYYY-MM-DD":t,o=b.getWeekStart(e,t,a),n=o.newVal,i=o.isStartOfWeek,l=(0,_moment2.default)(n,r),u=l.toObject(),s={year:u.years,month:u.months,weeks:l.weeks(),value:n,isScroll:!1};b.setState({isStartOfWeek:i}),b.targetMode.onChange(s),b.getWeekStart(e,t,a)},b.getWeekStart=function(e,t,a){var r=a?"YYYY-MM-DD":t,o=e,n=!0;if(a){o=(0,_differUtils.getValueFromWeekToDate)(e,t);var i=(0,_moment2.default)(e).year();(0,_moment2.default)(o,r).year()<i&&(n=!1,o=(0,_differUtils.getValueFromWeekToDate)(e,t,"endOf"))}return{newVal:o,isStartOfWeek:n}},b.onFocus=function(){b.isClear=!1;var e=b.state,t=e.value,a=e.valueIsValid,r=e.normalValue,o=e.format,n=e.status;b.oldValue=t;var i=b.props.mode,l=(0,_booleanUtils.modeStyle)(i),u=l.isWeeks,s=l.isWeek;b.setState({value:t,status:"showDate"});var f=a?t:r;b.setModeState(f,o,u||s),"showTime"===n&&b.pageFooterChange.onFocus({status:"showTime"});var c=b.props.onFocus;c&&c()},b.onBlur=function(){var e=b.state,t=e.isValid,a=e.value;a&&!t&&b.setState({value:b.oldValue}),a||(b.oldValue="");var r=b.props.onBlur;r&&r()},b.onClear=function(e){b.isClear=!0;var t=b.state.value;b.onChange({newValue:"",oldValue:t,event:e})},b.footerChange=function(e){var t=!0,a=void 0;if("onOk"===e){t=!1;var r=b.props.onOk,o="function"==typeof r?r:r&&r.Function?r.Function:"";o&&o(),a={status:"showDate",visible:!1}}if("onOk"!==e){t=!0;var n=b.state,i=n.value,l=n.panelValue;"showTime"===e&&b.targetMode.onChange({value:i}),"showDate"===e&&b.targetMode.onChange({value:l}),a={status:e}}b.setPopupVisible(t),b.setState(a)},b.timeChange=function(e){var t=e.value;b.setState({value:t})},b.trigger=_react2.default.createRef(),b.targetMode=new _mode2.default,b.pageFooterChange=new _mode2.default,b}return _inherits(e,_react.Component),_createClass(e,[{key:"componentDidMount",value:function(){var e=this.state.format,t=(0,_moment2.default)().format(e);this.normalStyleValueObj=(0,_utils.getformatSymbol)(t)}},{key:"render",value:function(){var e=this.props,t=e.disabled,a=e.readOnly,r=e.getPartOfThemeProps,o=this.state,n=o.value,i=o.status,l=o.format,u=o.panelValue,s=o.isScroll,f=o.valueIsValid,c=o.placeholder,p=o.isStartOfWeek,h=!!n,d=!!f,m=!!this.oldValue,_=(0,_utils.getNewProps)(this.props),g=this.props.mode,v=(0,_booleanUtils.modeStyle)(g).isTime,b=(0,_themeConfig.getFacePanelContain)({mode:g,getPartOfThemeProps:r},"FacePanelContain").themeProps,C=(0,_themeConfig2.default)({mode:g,getPartOfThemeProps:r},"Container"),P=(0,_themeConfig.getIconTheme)(this.props),y=P.inputPrefixProps,V=P.inputSuffixProps,O=P.clearButtonProps,S=C.themeConfig,w=y.themeConfig,k=(0,_InputIcon2.default)(Object.assign({},this.props,{value:this.state.value,onClear:this.onClear,clearButtonTheme:O})),D=k.suffixIcon,q=k.prefixIcon;return _react2.default.createElement(_theme2.default,{config:_defineProperty({},_index4.default.Input,{Container:Object.assign({},S),Input:Object.assign({},S),InputPrefix:Object.assign({},w),InputSuffix:Object.assign({},V.themeConfig)})},_react2.default.createElement(_index2.default,{themePass:!0,createPortal:this.props.createPortal,popup:_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_styled.PanelWrap,Object.assign({themeProps:b},(0,_themeHoc.addMouseEvent)(this)),_react2.default.createElement(_SwitchPanel2.default,Object.assign({},_,{hasStateValue:h,onChange:this.onChange,status:i,value:u,timeValue:n,format:l,timeChange:this.timeChange,model:this.targetMode,isScroll:s,valueIsValid:f,index:0,hasOldValue:m,isStartOfWeek:p,themeProps:b})),v?"":_react2.default.createElement(_PageFooter2.default,Object.assign({},this.props,{format:l,onChange:this.onChange,footerChange:this.footerChange,setPopupVisible:this.setPopupVisible,showTimeBtnIsDisabled:d,model:this.pageFooterChange})))),align:"bottomLeft",key:"trigger",ref:this.trigger,action:t||a||this.isClear?[]:["click"],hideAction:["click"]},_react2.default.createElement(_input2.default,Object.assign({},q,D,{value:n,onChange:this.onChange,placeholder:c,onFocus:this.onFocus,onBlur:this.onBlur,disabled:t,readOnly:a}))))}},{key:"setPopupVisible",value:function(){var e;this.trigger.current&&(e=this.trigger.current).setPopupVisible.apply(e,arguments)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=(0,_getDerived.getDerivedForInput)(e,t),r=a.value,o=a.format,n=a.panelValue,i=a.normalValue,l=a.valueIsValid,u=a.placeholder;return{value:r&&r[0],panelValue:n&&n[0],normalValue:i&&i[0],format:o,valueIsValid:l,placeholder:u&&u[0],status:t?t.status:"showDate",isStartOfWeek:!t||t.isStartOfWeek}}}]),e}();DateInput.displayName="DateInput",exports.default=DateInput;