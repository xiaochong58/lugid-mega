"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_styledFooter=require("../styled/styledFooter"),_booleanUtils=require("../utils/booleanUtils"),_moment=require("moment"),_moment2=_interopRequireDefault(_moment);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var normalShowTimeMessage={showTime:"选择时间",showDate:"选择日期"};function getShowTimeMessage(e){var t={};for(var o in normalShowTimeMessage)t[o]=e[o],e[o]||(t[o]=normalShowTimeMessage[o]);return t}var PageFooter=function(){function o(e){_classCallCheck(this,o);var l=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));l.handleClick=function(u){return function(e){var t=l.props,o=t.onChange,r=t.mode,s=(0,_booleanUtils.modeStyle)(r),n=s.isDate,a=s.isRange,i=u;n&&"string"!=typeof u&&(i=""),a&&(!Array.isArray(u)||Array.isArray(u)&&u.length<2)&&(i=["",""]),o&&o({newValue:i,event:e})}},l.onOkClick=function(e){return function(){l.publicOnChange("onOk"),l.setState({status:"showTime"})}},l.statusClick=function(e){return function(){"showTime"===e&&l.setState({status:"showDate"}),"showDate"===e&&l.setState({status:"showTime"}),l.publicOnChange(e)}},l.publicOnChange=function(e){var t=l.props.footerChange;t&&t(e)};var t=e.model;return t&&t.on("inputOnFocus",function(e){var t=e.status;l.setState({status:t})}),l}return _inherits(o,_react.Component),_createClass(o,[{key:"render",value:function(){var n=this,e=this.props,t=e.extraFooter,o=e.buttonOptions,r=e.theme,a=e.themeProps,s=void 0;if(o&&o.options){var i=[],u=o.options;for(var l in u)i.push(l);s=i.map(function(e,t){var o=u[e];if(Array.isArray(u[e])){for(var r=[],s=0;s<u[e].length;s++)r.push(u[e][s]);o=r}return _react2.default.createElement(_styledFooter.FooterBtn,{themeProps:a,buttonOptions:!0,onClick:n.handleClick(o)},e)})}var c=this.state,m=c.onOkMessage,h=c.showTodayMessage,f=c.showExtraFooter,p=c.showFooter,y=c.isOnOk,d=c.isShowTime,_=c.isShowToday,g=this.state,w=g.showTimeMessage,b=g.status,F=this.props,T=F.format,O=F.mode,v=(0,_moment2.default)().set({hour:0,minute:0,second:0}).format(T),k=(0,_moment2.default)().set({hour:23,minute:59,second:59}).format(T),C=(0,_booleanUtils.modeStyle)(O),S=C.isRange,P=C.isDate,M=v;S&&(M=[v,k]);var E=this.props.showTimeBtnIsDisabled,D=(P||S)&&o?s:"";return _react2.default.createElement(_styledFooter.FooterWrap,Object.assign({},r,{showFooter:p,themeProps:a}),p?_react2.default.createElement(_styledFooter.Footer,this.props,f?_react2.default.createElement(_styledFooter.ExtraFooter,{themeProps:a,extraFooter:!0},t&&t.message):"",D,_?_react2.default.createElement(_styledFooter.FooterBtn,{themeProps:a,showToday:!0,onClick:this.handleClick(M)},h):"",y?_react2.default.createElement(_styledFooter.FooterBtn,{themeProps:a,onOk:!0,background:!0,border:!0,onClick:this.onOkClick("onOk")},m):"",d?_react2.default.createElement(_styledFooter.FooterBtn,{themeProps:a,showTime:!0,showTimeButton:E,onClick:this.statusClick(E?b:"")},w&&"date"===b?w.showTime:w[b]):""):"")}}],[{key:"getDerivedStateFromProps",value:function(e,t){var o=e.onOk,r=e.extraFooter,s=e.showTime,n=e.buttonOptions,a=e.showToday,i=e.mode,u=(0,_booleanUtils.modeStyle)(i),l=u.isDate,c=u.isRange,m=r&&r.message,h=l||c,f=o&&h,p=s&&h,y=a&&h,d=n&&n.options&&h,_=f||p||m||d||y,g=p,w=f||g,b=y,F=t&&t.status?t.status:"showTime",T=o?o.message?o.message:"确定":g?"确定":"",O=s&&"object"===_typeof(s.message)&&!Array.isArray(s),v=s?O?getShowTimeMessage(s.message):normalShowTimeMessage:"",k=a?a.message?a.message:"今天":"";return{showExtraFooter:m,showFooter:_,isOnOk:w,isShowTime:g,isShowToday:b,onOkMessage:T,status:F,showTimeMessage:t&&t.showTimeMessage?t.showTimeMessage:v,showTodayMessage:k}}}]),o}();PageFooter.displayName="PageFooter",exports.default=PageFooter;