"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBoundaryValue=exports.getCoversTimes=exports.getShowTime=exports.getTimes=exports.getWeeksRangeInDates=exports.getValueFromWeekToDate=exports.getweekFormatValue=exports.getWeeksIndexRange=exports.getDays=exports.getDates=exports.getFirstDayIndex=exports.getChoseValue=exports.getChoseDayIndex=exports.getYandM=void 0,exports.getIndexInRange=getIndexInRange,exports.differMonthAndYear=differMonthAndYear,exports.getCurrentPageDates=getCurrentPageDates,exports.getRangeIndexfromWeeks=getRangeIndexfromWeeks,exports.getWeeksRange=getWeeksRange,exports.haveWhichOneItemInTime=haveWhichOneItemInTime;var _moment=require("moment"),_moment2=_interopRequireDefault(_moment),_booleanUtils=require("./booleanUtils"),_Math=require("../../common/Math");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function getWeekIndex(e){return{weekIndex:e.clone().date(1).weekday()}}function getIndexInValue(e,t,n){return(0,_moment2.default)(e,n).date()+t}function getMinAndMaxInMonth(e,t){var n=e[0],a=e[1],r=_moment2.default.min((0,_moment2.default)(n,t),(0,_moment2.default)(a,t)).format(t);return{max:_moment2.default.max((0,_moment2.default)(n,t),(0,_moment2.default)(a,t)).format(t),min:r}}function getDatesInRangeValue(e,n,s,u){var t=getMinAndMaxInMonth(e,u),d=t.min,m=t.max,f=[],g=[];return n.forEach(function(e,t){n[t].forEach(function(e){var t=(0,_booleanUtils.getValueIsInRange)(m,d,e,u),n=f.indexOf(e)<0,a=g.indexOf(e)<0,r=(0,_booleanUtils.getIsSame)([e,s[0]],u).isSameYandM,o=(0,_booleanUtils.getIsSame)([e,s[1]],u).isSameYandM;t&&r&&n&&f.push(e),t&&o&&a&&g.push(e)})}),[f,g]}function getRangeIndex(e,n,o){var s=[];return e.forEach(function(e,t){var a=getWeekIndex((0,_moment2.default)(n[t],o)).weekIndex,r=[];e.forEach(function(e,t){var n=getIndexInValue(e,a,o);r.push(n)}),s.push(r)}),s}function getRangeChoseDayIndex(t,n,s){var u=[];return n.forEach(function(a,e){var r=getWeekIndex((0,_moment2.default)(n[e],s)).weekIndex,o=[];t.forEach(function(e,t){if((0,_booleanUtils.getIsSame)([a,e],s).isSameYandM){var n=getIndexInValue(e,r,s);o.push(n)}}),u.push(o)}),u}function getIndexInRange(e,t,n,a){return{rangeIndex:getRangeIndex(getDatesInRangeValue(e,n,t,a),t,a),choseDayIndex:getRangeChoseDayIndex(e,t,a)}}function differMonthAndYear(e){var t=(0,_moment2.default)(e[0],"YYYY-MM"),n=(0,_moment2.default)(e[1],"YYYY-MM"),a=n.diff(t,"month");return{differAmonth:1===a||0===a||1<=t.diff(n,"month"),differAyear:a<=12}}function getCurrentPageDates(e,m){var f=[];return e.forEach(function(e,t){var n=(0,_moment2.default)(e),a=getDays(n),r=n.year(),o=n.month(),s=getWeekIndex(n).weekIndex,u=n.daysInMonth(),d=getDates(a,"range",e,{weekIndex:s,format:m,year:r,month:o,maxDay:u}).dates;f.push(d)}),f}var getYandM=exports.getYandM=function(e){var t=e.index,n=e.child,a=e.value,r=e.mode,o=e.firstDayIndex,s=e.props,u=n,d=s.weekIndex,m=s.format,f=s.year,g=s.month,i=(0,_booleanUtils.modeStyle)(r),x=i.isRange,h=i.isWeeks?"YYYY-MM-DD":m,l=x?(0,_moment2.default)().set({month:g,year:f}).format(m):a,I=getChoseDayIndex("getNode",u,d,o,t,l,r,s),c=I.choseDayIndex,p=I.choseValue,v=(0,_moment2.default)(p,h),y=v.year(),D=v.month();return{choseValue:v.format(h),year:y,month:D,choseDate:u,choseDayIndex:c}},getChoseDayIndex=exports.getChoseDayIndex=function(e,t,n,a,r,o,s,u){var d=u.format;(0,_booleanUtils.modeStyle)(s).isWeeks&&(d="YYYY-MM-DD");var m=u.maxDay,f=a&&a[0],g=a&&a[1],i=(0,_moment2.default)(o,d);"changeHead"===e&&m<t&&(t=m);var x=t+n,h=getChoseValue(i,"add",0,t,d);return r<f&&(x=r+1,h=getChoseValue(i,"subtract",1,t,d)),g<=r&&(x=n+t,h=getChoseValue(i,"add",1,t,d)),{choseDayIndex:x,choseValue:h}},getChoseValue=exports.getChoseValue=function(e,t,n,a,r){var o=(0,_moment2.default)(e);return o[t](n,"month").set("date",a),o.format(r)},getFirstDayIndex=exports.getFirstDayIndex=function(e){var n=[];return e.forEach(function(e,t){1===e&&n.push(t)}),{firstDayIndex:n}},getDates=exports.getDates=function(e,a,r,o){var s=[],u=getFirstDayIndex(e).firstDayIndex;return e.forEach(function(e,t){var n=getYandM({index:t,child:e,value:r,mode:a,firstDayIndex:u,props:o}).choseValue;s.push(n)}),{dates:s}},getDays=exports.getDays=function(e){var t=[],n=(0,_moment2.default)(e.date(1)),a=getWeekIndex(e).weekIndex,r=n.subtract(a,"day");t.push(r.date());for(var o=1;o<42;o++){var s=(0,_moment2.default)(r);t.push(s.add(o,"day").date())}return t},getWeeksIndexRange=exports.getWeeksIndexRange=function(e){var t=Math.floor(e/7);return{startIndex:7*t+1,endIndex:7*(t+1)}};function getRangeIndexfromWeeks(e,t,n){var a="startOf",r=6;n||(a="endOf",r=-6);var o=e[a]("week").date()+t,s=[o,o+r].sort(_Math.sortable);return{startInWeeks:s[0],endInWeeks:s[1]}}var getweekFormatValue=exports.getweekFormatValue=function(e,t,n){return(0,_moment2.default)().set({year:e,weeks:t}).format(n)},getValueFromWeekToDate=exports.getValueFromWeekToDate=function(e,t,n){var a=2<arguments.length&&void 0!==n?n:"startOf",r=(0,_moment2.default)(e,t).format("w"),o=(0,_moment2.default)(e,"YYYY").year();return(0,_moment2.default)().set({year:o,weeks:r})[a]("week").format("YYYY-MM-DD")};function getWeeksRange(e,t,n){for(var a=[],r=0,o=Math.ceil(t/n),s=0;s<o;s++){var u=n*s+1,d=s===o-1?t:n*s+n,m=u+"-"+d+"å‘¨";u<=e&&e<=d&&(r=s),a.push({text:m,start:u,end:d,index:s,value:s})}return{weeksDate:a,rangeIndex:r}}var getWeeksRangeInDates=exports.getWeeksRangeInDates=function(e){var t=e.month(),n=e.weeks(),a=e.year();return 11===t&&1===n&&(a+=1),0===t&&40<n&&(a-=1),{year:a,weeks:n,month:t}},getTimes=exports.getTimes=function(e){for(var t=[],n=0;n<e;n++){var a=n;n<10&&(a="0"+n),t.push({text:a,value:n})}return t},getShowTime=exports.getShowTime=function(e,t){var n=["","",""];if(e){var a=(0,_moment2.default)(e,t);n[0]=a.hour(),n[1]=a.minute(),n[2]=a.second()}else n=[0,0,0];return n};function haveWhichOneItemInTime(e){for(var t=!1,n=!1,a=!1,r=0;r<e.length;r++){var o=e[r].toUpperCase();"H"===o&&(t=!0),"M"===o&&(n=!0),"S"===o&&(a=!0)}for(var s=[t,n,a],u=3,d=0,m=0;m<s.length;m++)s[m]&&(d+=1);return d<u&&(u=d),{hasHour:t,hasMinutes:n,hasSeconds:a,hasItemNumber:u}}var getCoversTimes=exports.getCoversTimes=function(e,t,n){for(var a=[].concat(_toConsumableArray(e)),r=0;r<t-1;r++)a.push(n);return a},getBoundaryValue=exports.getBoundaryValue=function(e,t,n){var a=n;return n<e&&(a=e),t<n&&(a=t),a};