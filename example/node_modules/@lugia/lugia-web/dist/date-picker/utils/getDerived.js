"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDerived=exports.getNormalFormat=void 0,exports.getDerivedForInput=getDerivedForInput,exports.getValueWhetherValid=getValueWhetherValid;var _moment=require("moment"),_moment2=_interopRequireDefault(_moment),_utils=require("./utils"),_booleanUtils=require("./booleanUtils"),_differUtils=require("./differUtils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var getNormalFormat=exports.getNormalFormat=function(e){var t=(0,_booleanUtils.modeStyle)(e),a=t.isWeeks,o=t.isWeek,r=t.isMonth,l=t.isYear,n=t.isTime,i=t.isTimes;return r?"YYYY-MM":l?"YYYY":o||a?"YYYY-WW":n||i?"HH:mm:ss":"YYYY-MM-DD"},getDerived=exports.getDerived=function(e,t){var a=e.value,o=e.format,r=e.mode,l=e.valueIsValid,n=e.hasOldValue,i=e.isStartOfWeek,s=(0,_booleanUtils.modeStyle)(r).isWeeks,u=t?t.value:a,m=s?"YYYY-MM-DD":o,d=(0,_moment2.default)(u,m).clone(),f=d.toObject(),g=f.years,_=f.months,v=f.date,y=d.weeks(),h=(0,_moment2.default)(u,m).date(1).weekday(),V=h,c=l||n?v+V:"",Y=V+d.daysInMonth()-1,I=(0,_differUtils.getDays)(d),p=d.daysInMonth(),D=(0,_moment2.default)().date(),W=!1;p<D&&(D=p,W=!0);var b=void 0,k=void 0;if(s){var U=(0,_differUtils.getRangeIndexfromWeeks)((0,_moment2.default)(u,m),V,i);b=U.startInWeeks,k=U.endInWeeks}return{value:u,days:I,noToday:W,today:D,todayDate:(0,_moment2.default)().format(o),format:o,mode:t?t.mode:r,weekDay:h,year:g,weeks:y,month:_,weekIndex:V,lastDayIndexInMonth:Y,choseDate:v,choseDayIndex:c,startInWeeks:b,endInWeeks:k,maxDay:p}};function getDerivedForInput(e,t){var a=e.mode,o=(0,_booleanUtils.modeStyle)(a),r=o.isRange,l=o.isWeeks,n=o.isWeek,i=getNormalFormat(a),s=e.format,u=void 0===s?i:s,m=getPlaceholder(e),d=getValueFromValue(e,t),f=getValueWhetherValid(d,u),g=(r&&(0,_booleanUtils.getIsSame)(d,u)).isSameYandM,_=(r?f&&!g:f)?d:getInValidValue(d,u),v=_;return(l||n)&&_&&(_=[(0,_differUtils.getValueFromWeekToDate)(_[0],u)]),{value:d,format:u,placeholder:m,valueIsValid:f,panelValue:_,normalValue:v}}function getValueFromValue(e,t){var a=e.defaultValue,o=e.value,r=e.mode,l=(0,_booleanUtils.modeStyle)(r).isRange,n="defaultValue"in e&&null!=a,i="value"in e&&null!=o?o:t?t.value:n?a:l?["",""]:"";if(l&&Array.isArray(i)){var s=[].concat(_toConsumableArray(i)),u=s.length;1===u&&s.push(""),2<u&&s.slice(0,2),i=s}return"string"==typeof i&&(i=[i]),i}function getPlaceholder(e){var t=e.mode,a=e.placeholder,o=a&&"placeholder"in e,r=(0,_booleanUtils.modeStyle)(t),l=r.isRange,n=r.isTime,i=r.isTimes,s=o?a:l?["开始日期","结束日期"]:n||i?"请选择时间":"请选择日期";return"string"==typeof s&&(s=[s]),s}function getValueWhetherValid(e,a){var t=(0,_moment2.default)().format(a),o=(0,_utils.getformatSymbol)(t),r=!0;return e&&e.forEach(function(e,t){(0,_booleanUtils.formatValueIsValid)(o,e,a)||(r=!1)}),r}function getInValidValue(e,o){var t=(0,_moment2.default)().format(o),r=(0,_utils.getformatSymbol)(t),l=[],n=(0,_moment2.default)().format(o);e&&e.forEach(function(e,t){var a=e;(0,_booleanUtils.formatValueIsValid)(r,a,o)&&""!==a||(a=n),l.push(a)}),2!==l.length||(0,_booleanUtils.getIsSame)(l,o).isSameYandM&&(l[1]=(0,_moment2.default)(l[0],o).add(1,"month").format(o));return l}