"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_menu=require("../menu"),_menu2=_interopRequireDefault(_menu),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_trigger=require("../trigger"),_trigger2=_interopRequireDefault(_trigger),_theme=require("../theme"),_theme2=_interopRequireDefault(_theme),_inputtag=require("../inputtag"),_inputtag2=_interopRequireDefault(_inputtag),_utils=require("../menu/utils"),_objectUtils=require("@lugia/object-utils"),_props3=require("../consts/props"),_utils2=require("./utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var DefaultMenuWidth=150,Cascader=function(){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return _initialiseProps.call(t),t.state={popupVisible:!1,value:(0,_utils2.getValue)(e,null),expandedPath:(0,_utils2.getInitExpandedPath)(e),selectedKeys:(0,_utils2.getInitExpandedPath)(e),inputValue:(0,_utils2.getInitInputValue)(e),treeData:(0,_utils.getTreeData)(e),divided:!1},t.menu=React.createRef(),t}return _inherits(n,React.Component),_createClass(n,[{key:"render",value:function(){var t=this,e=this.props,n=this.state,i=n.popupVisible,r=n.inputValue,a=e.placeholder,o=e.offsetY,u=e.disabled,s=e.createPortal;return React.createElement(_theme2.default,{config:this.getInputtagTheme()},React.createElement(_trigger2.default,{ref:function(e){t.trigger=e},themePass:!0,align:"bottomLeft",action:u?[]:this.props.action||["click"],hideAction:["click"],offsetY:o,popupVisible:i,popup:this.getMenu(),createPortal:s,onMouseEnter:this.onMouseEnterContainer,onMouseLeave:this.onMouseLeaveContainer,lazy:!1,onPopupVisibleChange:this.onPopupVisibleChange},React.createElement(_inputtag2.default,Object.assign({},this.props.getPartOfThemeHocProps("InputTag"),{onClick:this.handleClickInputTag,value:r,displayValue:r,mutliple:!1,placeholder:a,disabled:u,onClear:this.onClear}))))}},{key:"setPopupVisible",value:function(e,t){this.forcePopup=!!t,this.trigger&&this.trigger.setPopupVisible(e,t)}},{key:"setPopupVisibleInner",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{};!e&&this.forcePopup||(this.checked=e,this.setState(Object.assign({popupVisible:e},n)))}},{key:"changeCheckedAndSetVisible",value:function(e){this.setPopupVisibleInner(!e)}},{key:"enterTarget",value:function(){this.mouseInTarget=!0}},{key:"leaveTarget",value:function(){this.mouseInTarget=!1}},{key:"componentDidUpdate",value:function(){this.menu&&this.menu.current&&this.menu.current.innerMenu.current.getThemeTarget().scrollerTarget.current.forceAlign()}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t?{value:(0,_utils2.getValue)(e,t),selectedKeys:t.value,expandedPath:t.expandedPath,inputValue:(0,_utils2.getInputValue)(e,t)}:{}}}]),n}();Cascader.defaultProps={offsetY:5,offsetX:2,disabled:!1,getTheme:function(){},showAllLevels:!0,displayField:_props3.DisplayField,valueField:_props3.ValueField,allowClear:!0,createPortal:!1};var _initialiseProps=function(){var h=this;this.onPopupVisibleChange=function(e){var t=h.props.data;!h.forcePopup&&t&&0!==t.length||h.setPopupVisibleInner(e)},this.handleClickInputTag=function(){if(!h.props.disabled){var e=h.checked;h.changeCheckedAndSetVisible(e)}},this.getMenu=function(){var e=h.props,t=e.data,n=e.action,i=e.separator,r=e.offsetX,a=e.valueField,o=e.displayField,u=e.divided,s=h.state,l=s.popupVisible,p=s.expandedPath,c=s.selectedKeys;return React.createElement(_menu2.default,Object.assign({},h.getMenuTheme(),{mutliple:!1,ref:h.menu,action:n,divided:u,popupVisible:l,onChange:h.onChange,handleIsInMenu:h.handleIsInMenu,data:t,displayField:o,valueField:a,onClick:h.onClick,separator:i,selectedKeys:c,expandedPath:p,offsetX:r,offsetY:0,onMouseEnter:h.onMouseEnter,onMouseLeave:h.onMouseLeave,onExpandPathChange:h.onExpandPathChange}))},this.mergeTheme=function(e,t){var n=h.props.getPartOfThemeHocProps(e),i=n.viewClass,r=n.theme;return{viewClass:i,theme:(0,_objectUtils.deepMerge)(_defineProperty({},i,Object.assign({},t)),r)}},this.getMenuTheme=function(){var e=(0,h.props.getPartOfThemeConfig)("InputTag").InputTagWrap,t=(void 0===e?{}:e).normal,n=(void 0===t?{}:t).width,i=void 0===n?DefaultMenuWidth:n,r={Container:{normal:{width:i}},SubMenu:{Container:{normal:{width:i}}}};return h.mergeTheme("Menu",r)},this.getInputtagTheme=function(){var e=h.props.getPartOfThemeConfig;return _defineProperty({},_index2.default.InputTag,{InputTagWrap:e("Container"),SwitchIcon:e("SwitchIcon"),ClearIcon:e("ClearIcon"),Placeholder:e("Placeholder")})},this.handleIsInMenu=function(e){var t=h.checked;h.mouseInTarget||!e&&t&&h.setPopupVisibleInner(!1,{expandedPath:h.state.value})},this.onClick=function(e,t,n){var i=t.selectedKeys,r={};n&&n.children&&0!==n.children.length||(h.setPopupVisibleInner(!1),!1===h.props.showAllLevels&&(r={inputValue:i}));h.setState(Object.assign({value:i,expandedPath:i},r));var a=h.props.onClick,o=h.getExposeTarget(e,i,n);a&&a(o)},this.getExposeTarget=function(e,t,n){var i={};return i.event=e,i.selectedKeys=t,i.item=n,i},this.onMouseEnter=function(e,t){h.enterTarget()},this.onExpandPathChange=function(e){"hover"===h.props.action&&h.setState({expandedPath:e})},this.onMouseLeave=function(){h.leaveTarget()},this.onClear=function(e){var t=h.props,n=t.onClear,i=t.allowClear;n&&n(e),i&&!(0,_utils2.isHasValue)(h.props)&&h.setPopupVisibleInner(!1,{expandedPath:[],value:[],inputValue:[]})},this.onChange=function(e){var t=e.selectedKeys,n=h.props.onChange;n&&n(t)},this.onMouseEnterContainer=function(){h.enterTarget()},this.onMouseLeaveContainer=function(){h.leaveTarget()}};exports.default=Cascader;