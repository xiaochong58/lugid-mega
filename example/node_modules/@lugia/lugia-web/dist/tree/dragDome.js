"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_index=require("./index.js"),_index2=_interopRequireDefault(_index),_index3=require("../consts/index"),_index4=_interopRequireDefault(_index3),_themeUtils=require("@lugia/theme-utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var config=_defineProperty({},_index4.default.Tree,{TreeWrap:{normal:{width:500}},TreeItem:{TreeItemWrap:{normal:{height:50}},SelectedTreeItemWrap:{},Text:{normal:{font:{size:16},border:{bottom:{color:"#DBDBDB",style:"solid",width:1}},borderRadius:(0,_themeUtils.getBorderRadius)(0),background:{}},hover:{background:{color:"none"},color:"#4d63ff"}},SelectedText:{normal:{font:{size:16},background:{color:"transparent"},color:"#4d63ff",border:{bottom:{color:"#DBDBDB",style:"solid",width:1}},borderRadius:(0,_themeUtils.getBorderRadius)(0)},hover:{background:{color:"transparent"},color:"#4d63ff"}},SubTreeWrap:{normal:{background:{color:"#F8F8FF"}}},Checkbox:{normal:{color:"#4d63ff"}}}}),info=[{value:"0",text:"北京分行",children:[{value:"0-0",text:"朝阳支行办事处",children:[{value:"0-0-0",text:"朝阳支行办事处-1"},{value:"0-0-1",text:"朝阳支行办事处-2"}]},{value:"0-1",text:"海淀支行办事处"},{value:"0-2",text:"石景山支行办事处"}]},{value:"1",text:"天津分行",children:[{value:"和平支行办事处",text:"和平支行办事处"},{value:"河东支行办事处",text:"河东支行办事处"},{value:"南开支行办事处",text:"南开支行办事处"}]}],info1=[{value:"0",text:"北京分行"},{value:"0.0",text:"朝阳支行办事处",pid:"0",path:"0"},{value:"0.0.0",text:"朝阳支行办事处-1",pid:"0.0",path:"0/0.0",isLeaf:!0,notCanSelect1:!0},{value:"0.0.1",text:"朝阳支行办事处-2",pid:"0.0",path:"0/0.0",isLeaf:!0},{value:"0.1",text:"海淀支行办事处",pid:"0",path:"0",isLeaf:!0},{value:"0.2",text:"石景山支行办事处",pid:"0",path:"0",isLeaf:!0},{value:"1",text:"天津分行"},{value:"1.0",text:"和平支行办事处",pid:"1",path:"1",isLeaf:!0},{value:"1.1",text:"河东支行办事处",pid:"1",path:"1",isLeaf:!0},{value:"1.2",text:"南开支行办事处",pid:"1",path:"1",isLeaf:!0}],exchange1=[{value:"0",text:"动物",children:[{value:"0-0",text:"运动分类",notCanSelect1:!0,children:[{value:"0-0-0",text:"水中游",notCanSelect1:!0},{value:"0-0-1",text:"地上走",notCanSelect1:!0},{value:"0-0-2",text:"空中飞",notCanSelect1:!0}]},{value:"0-1",text:"生存方式",children:[{value:"0-1-0",text:"野生动物"},{value:"0-1-1",text:"饲养动物"}]},{value:"0-2",text:"食性",children:[{value:"0-2-0",text:"植物动物"},{value:"0-2-1",text:"肉食动物"},{value:"0-2-2",text:"杂食动物"}]},{value:"0-3",text:"身体特征",children:[{value:"0-3-0",text:"鱼类"},{value:"0-3-1",text:"鸟类"},{value:"0-3-2",text:"昆虫"},{value:"0-3-3",text:"哺乳类"},{value:"0-3-4",text:"软体类"}]}]}],exchange2=[{value:"0",text:"动物",children:[{value:"0-0",text:"运动分类",children:[{value:"0-0-0",text:"水中游"}]},{value:"0-2",text:"食性",children:[{value:"0-2-0",text:"植物动物"},{value:"0-2-1",text:"肉食动物"}]},{value:"0-3",text:"身体特征",children:[{value:"0-3-1",text:"哺乳类"}]}]}],switchIconNames={open:"lugia-icon-direction_down",close:"lugia-icon-direction_right"},TreeDome=function(){function t(e){_classCallCheck(this,t);var v=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return v.recursion=function(e,t,i){var o=!1;!function e(t,a){if(Array.isArray(t)&&0<t.length)for(var n=0;n<t.length;n++){if(o)return;var r=t[n];if(r.value===a)return o=!0,i(r,n,t);Array.isArray(r.children)&&0<r.children.length&&e(r.children,a,i)}}(e,t)},v.onDrop=function(e){var t=e.dragInfo,a=(t=void 0===t?{}:t).key,n=e.targetInfo,r=n.pid,i=n.key,o=n.pos,l=n.dropPosition,c=e.dropToGap,u=v.state.info,d=o.split("-"),s=d[d.length-1],p={};v.recursion(u,a,function(e,t,a){a.splice(t,1),p=e}),c?r?v.recursion(u,r,function(e,t,a){e.children=e.children||[],"top"===l?e.children.splice(s,0,p):e.children.splice(s+1,0,p)}):"top"===l?u.splice(s,0,p):u.splice(s+1,0,p):v.recursion(u,i,function(e,t,a){e.children=e.children||[],e.children.push(p)}),v.setState({info:[].concat(_toConsumableArray(u))})},v.onDrop1=function(e){var t=v.state.info1,a=e.dragInfo,n=(a=void 0===a?{}:a).dargCurrentIndex,r=a.dargNextIndex,i=a.dargPreIndex,o=e.targetInfo,l=o.dropPosition,c=o.targetParentIndex,u=o.targetCurrentIndex,d=e.dropToGap;if(!e.translateTreeData){var s,p=t[n],h=t[i],f=t[r];f&&p.pid!==f.pid&&h&&p.pid!==h.pid&&(h.isLeaf=!0),f||p.pid===h.pid||(h.isLeaf=!0);var g=v.calculationDragCount(n);s=t.splice(n,g),u=n<=u?u-g:u,c=n<=c?c-g:c,d?"top"===l?v.dragTargetToTopHandler(u,s,c):v.dragTargetToBottomHandler(u,s,c):v.dragTargetToInHandler(u,s),v.setState({info1:[].concat(_toConsumableArray(t))})}},v.mouseLeave=function(e){var t=e.nodeData,a=(t=void 0===t?{}:t).value,n=v.state.exchange1,r={};v.recursion(n,a,function(e,t,a){r=e}),v.dragObj=JSON.parse(JSON.stringify(r))},v.mouseEnter=function(e){console.log("todo",e)},v.onDragEnd=function(){v.dragObj=null},v.exchangeOnDrop=function(e){var t=e.dragInfo,a=(t=void 0===t?{}:t).key,n=e.targetInfo,r=n.pid,i=n.key,o=n.pos,l=n.dropPosition,c=e.dropToGap,u=e.isSelf,d=v.state.exchange2,s=o.split("-"),p=s[s.length-1],h={};u?v.recursion(d,a,function(e,t,a){a.splice(t,1),h=e}):h=v.dragObj,h&&(c?r?v.recursion(d,r,function(e,t,a){e.children=e.children||[],"top"===l?e.children.splice(p,0,h):e.children.splice(p+1,0,h)}):"top"===l?d.splice(p,0,h):d.splice(p+1,0,h):v.recursion(d,i,function(e,t,a){e.children=e.children||[],e.children.push(h)}),v.setState({exchange2:[].concat(_toConsumableArray(d))}))},v.state={info:info,info1:info1,exchange1:exchange1,exchange2:exchange2,showFlag:!0},v}return _inherits(t,React.Component),_createClass(t,[{key:"dragTargetToTopHandler",value:function(e,t,a){var n=1<arguments.length&&void 0!==t?t:[],r=a,i=this.state.info1,o=i[e].pid,l=void 0===o?"":o;i.splice.apply(i,[e,0].concat(_toConsumableArray(n)));var c=[];if(l){var u=i[r];u.isLeaf=!1,c=u.path?[u.path,u.value]:[u.value]}this.updataDataPath({pid:l,deleteCount:n.length,fixTargetCurrentIndex:e,nextPathArray:c})}},{key:"dragTargetToBottomHandler",value:function(e,t,a){var n=1<arguments.length&&void 0!==t?t:[],r=a,i=this.state.info1,o=this.calculationDragCount(e),l=i[e].pid,c=void 0===l?"":l;i.splice.apply(i,[e+o,0].concat(_toConsumableArray(n)));var u=[];if(c){var d=i[r];d.isLeaf=!1,u=d.path?[d.path,d.value]:[d.value]}this.updataDataPath({pid:c,deleteCount:n.length,fixTargetCurrentIndex:e+o,nextPathArray:u})}},{key:"dragTargetToInHandler",value:function(e,t){var a=1<arguments.length&&void 0!==t?t:[],n=this.state.info1;n.splice.apply(n,[e+1,0].concat(_toConsumableArray(a)));var r,i=n[e].value,o=void 0===i?"":i,l=n[e];l.isLeaf=!1,r=l.path?[l.path,l.value]:[l.value],this.updataDataPath({pid:o,deleteCount:a.length,fixTargetCurrentIndex:e+1,nextPathArray:r})}},{key:"calculationDragCount",value:function(e){for(var t=this.state.info1,a=1,n=e+1,r=t.length;n<r;n++){var i=t[n].path;if(-1===(void 0===i?"":i).split("/").indexOf(t[e].value))break;a+=1}return a}},{key:"updataDataPath",value:function(e){for(var t=this.state.info1,a=e.pid,n=e.deleteCount,r=e.fixTargetCurrentIndex,i=e.nextPathArray,o=r,l=r+n,c=[],u=o;u<l;u++){var d=t[u];if(u===o)d.pid=a,c=d.path?d.path.split("/"):[],d.path=i.join("/");else{var s=d.path?d.path.split("/"):[];s.splice(0,c.length),d.path=i.concat(s).join("/")}}}},{key:"render",value:function(){var e=this.state,t=e.info,a=void 0===t?[]:t,n=e.info1,r=void 0===n?[]:n,i=e.exchange1,o=e.exchange2;return React.createElement("div",{style:{display:"flex",flexDirection:"column"}},React.createElement("h1",{style:{padding:"20px 0"}},"树和树之间拖拽"),React.createElement("div",{style:{display:"flex",flex:1}},React.createElement("div",{style:{flex:1}},React.createElement(_index2.default,{data:i,igronSelectField:"notCanSelect1",groupKey:"111",expandAll:!0,theme:config,translateTreeData:!0,autoHeight:!0,onDragLeave:this.mouseLeave,onDragEnd:this.onDragEnd,draggable:!0,parentIsHighlight:!0,switchIconNames:switchIconNames})),React.createElement("div",{style:{flex:1}},React.createElement(_index2.default,{data:o,draggable:!0,onDragEnter:this.mouseEnter,onDragEnd:this.onDragEnd,onDrop:this.exchangeOnDrop,groupKey:"111",translateTreeData:!0,expandAll:!0,theme:config,autoHeight:!0,parentIsHighlight:!0,switchIconNames:switchIconNames})),React.createElement("div",{style:{flex:1}},React.createElement(_index2.default,{data:o,translateTreeData:!0,expandAll:!0,theme:config,autoHeight:!0,draggable:!0,parentIsHighlight:!0,onDrop:this.exchangeOnDrop,switchIconNames:switchIconNames}))),React.createElement("h1",{style:{padding:"20px 0"}},"单棵树拖拽"),React.createElement("div",{style:{display:"flex",flex:1}},React.createElement("div",{style:{flex:1}},React.createElement(_index2.default,{data:a,expandAll:!0,theme:config,translateTreeData:!0,groupKey:"111",draggable:!0,parentIsHighlight:!0,onDrop:this.onDrop,switchIconNames:switchIconNames})),React.createElement("div",{style:{flex:1}},React.createElement(_index2.default,{data:r,expandAll:!0,theme:config,autoHeight:!0,draggable:!0,parentIsHighlight:!0,onDrop:this.onDrop1,switchIconNames:switchIconNames}))))}}]),t}();exports.default=TreeDome;