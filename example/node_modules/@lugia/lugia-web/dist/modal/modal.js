"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_themeProvider=require("../theme-provider"),_themeProvider2=_interopRequireDefault(_themeProvider),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_theme=require("../theme"),_theme2=_interopRequireDefault(_theme),_modal=require("../css/modal"),_button=require("../button"),_button2=_interopRequireDefault(_button),_icon=require("../icon"),_icon2=_interopRequireDefault(_icon),_units=require("../css/units"),_objectUtils=require("@lugia/object-utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var BtnType={confirm:"warning",info:"primary",success:"success",error:"danger",warning:"warning"};exports.default=(0,_themeProvider2.default)(function(){function i(){var e,t,l;_classCallCheck(this,i);for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];return(t=l=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(n)))).saveModalDom=function(e){l.modalEle=e},l.hideWindowPopUp=function(e){var t=l.props.onCancel;l.modalEle===document.activeElement&&27===e.keyCode&&("visible"in l.props?t&&t():l.setState({visible:!1,closing:!0}))},l.getCloseIconTheme=function(){var e=(0,l.props.getPartOfThemeHocProps)("ModalCloseIcon"),t=e.viewClass,o=e.theme;return{viewClass:t,theme:(0,_objectUtils.deepMerge)(_defineProperty({},t,{normal:{fontSize:16}}),o)}},l.getIconTheme=function(){var e=l.props,t=e.getPartOfThemeHocProps,o=e.iconType,n=void 0===o?"info":o,r=t("ModalIcon"),i=r.viewClass,a=r.theme;return{viewClass:i,theme:(0,_objectUtils.deepMerge)(_defineProperty({},i,{normal:{fontSize:20,color:(0,_modal.getIconColor)({iconType:n}),getCSS:function(){return"\n                  position: absolute;\n                  left: "+(0,_units.px2remcss)(22)+";\n                  top: "+(0,_units.px2remcss)(28)+";\n                "}}}),a)}},l.handleMaskClick=function(){var e=l.props.maskClosable;void 0!==e&&!e||l.handleCancel()},l.handleOk=function(){var e=l.props.onOk,t=l.isInprops("confirmLoading"),o=l.isInprops("visible");if(!t&&!o)return l.setState({closing:!0}),void setTimeout(function(){l.setState({closing:!1}),e&&e()},300);e&&e()},l.handleCancel=function(){var e=l.props.onCancel;e&&e()},_possibleConstructorReturn(l,t)}return _inherits(i,React.Component),_createClass(i,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.hideWindowPopUp,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.hideWindowPopUp,!1)}},{key:"componentDidUpdate",value:function(){var e=this;!0===this.state.closing&&setTimeout(function(){e.setState({closing:!1})},300)}},{key:"render",value:function(){var e=this.props,t=e.title,o=e.children,n=e.confirmLoading,r=void 0!==n&&n,i=e.cancelText,a=void 0===i?"取消":i,l=e.okText,c=void 0===l?"确定":l,s=e.footer,u=e.showIcon,d=void 0!==u&&u,p=e.iconType,f=void 0===p?"info":p,m=e.getTheme,_=e.mask,h=void 0===_||_,v=e.okButtonProps,g=void 0===v?{}:v,b=e.cancelButtonProps,y=void 0===b?{}:b,C=e.getPartOfThemeProps,P=e.getPartOfThemeHocProps,w=e.iconClass,k=this.state,R=k.visible,M=void 0!==R&&R,T=k.closing,O=k.opening,E=_defineProperty({},_index2.default.Button,{width:80}),j={type:"primary"};d&&(j.type=BtnType[f]);var q=C("ModalWrap");q.propsConfig={showIcon:d};var I=C("ModalTitle"),x=C("ModalContentText");return React.createElement(_modal.Wrap,{visible:!!T||M},h?React.createElement(_modal.ModalMask,{onClick:this.handleMaskClick,closing:T,opening:O}):null,React.createElement(_modal.ModalWrap,null,React.createElement(_modal.Modal,{tabIndex:"1",ref:this.saveModalDom,closing:T,opening:O,themeProps:q},React.createElement(_modal.ModalContent,{showIcon:d,theme:m(),themeProps:q},d?React.createElement(_icon2.default,Object.assign({iconClass:w||_modal.IconInfo[f].class,singleTheme:!0},this.getIconTheme())):React.createElement(_modal.ModalClose,{onClick:this.handleCancel},React.createElement(_icon2.default,Object.assign({},this.getCloseIconTheme(),{iconClass:"lugia-icon-reminder_close",singleTheme:!0}))),null!==t&&React.createElement(_modal.ModalTitle,{themeProps:I},t),React.createElement(_modal.ModalBody,{themeProps:x},o),this.isInprops("footer")?s:React.createElement(_modal.ModalFooter,null,React.createElement(_theme2.default,{config:E},React.createElement(_button2.default,Object.assign({onClick:this.handleOk,loading:r},j,P("ModalOkButton"),g),c)),React.createElement(_theme2.default,{config:E},React.createElement(_button2.default,Object.assign({onClick:this.handleCancel},P("ModalCancelButton"),y),a)))))))}},{key:"isInprops",value:function(e){return e in this.props}}],[{key:"getDerivedStateFromProps",value:function(e,t){var o=e.visible,n=void 0!==o&&o,r=(t||{}).visible;return{visible:n,closing:!!t&&(!0===r&&!1===n),opening:n}}}]),i}(),_index2.default.Modal);