"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_templateObject=_taggedTemplateLiteral(["\n    position: relative;\n    background: rgba(255, 255, 255, 0);\n    width: ",";\n    height: ",";\n    z-index: 996;\n  "],["\n    position: relative;\n    background: rgba(255, 255, 255, 0);\n    width: ",";\n    height: ",";\n    z-index: 996;\n  "]),_templateObject2=_taggedTemplateLiteral(["\n    height: ",";\n  "],["\n    height: ",";\n  "]),_templateObject3=_taggedTemplateLiteral(["\n    width: ",";\n  "],["\n    width: ",";\n  "]),_templateObject4=_taggedTemplateLiteral(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  cursor: pointer;\n  text-align: center;\n  border-radius: ",";\n  background: ",";\n  color: #fff;\n  font-size: ",";\n  line-height: ",";\n\n  &:hover {\n    background-color: ",";\n  }\n\n  transition: all 0.4s;\n"],["\n  position: absolute;\n  top: 0;\n  left: 0;\n  cursor: pointer;\n  text-align: center;\n  border-radius: ",";\n  background: ",";\n  color: #fff;\n  font-size: ",";\n  line-height: ",";\n\n  &:hover {\n    background-color: ",";\n  }\n\n  transition: all 0.4s;\n"]),_templateObject5=_taggedTemplateLiteral(["\n  height: ",";\n  margin-bottom: ",";\n  margin-top: ",";\n"],["\n  height: ",";\n  margin-bottom: ",";\n  margin-top: ",";\n"]),_templateObject6=_taggedTemplateLiteral(["\n  width: ",";\n  margin-left: ",";\n  margin-right: ",";\n"],["\n  width: ",";\n  margin-left: ",";\n  margin-right: ",";\n"]);require("../common/shirm");var _react=require("react"),React=_interopRequireWildcard(_react),_styledComponents=require("styled-components"),_styledComponents2=_interopRequireDefault(_styledComponents),_themeCssHoc=require("@lugia/theme-css-hoc"),_FormFieldWidgetSupport=require("../common/FormFieldWidgetSupport"),_FormFieldWidgetSupport2=_interopRequireDefault(_FormFieldWidgetSupport),_utils=require("../utils"),_addEventListener=require("rc-util/lib/Dom/addEventListener"),_addEventListener2=_interopRequireDefault(_addEventListener),_css=require("../css"),_scroller=require("../css/scroller"),_units=require("../css/units");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Container=(0,_themeCssHoc.StaticComponent)({tag:"div",className:"Container",css:(0,_themeCssHoc.css)(_templateObject,(0,_units.px2remcss)(20),(0,_units.px2remcss)(300))}),XContainer=(0,_themeCssHoc.StaticComponent)({extend:Container,className:"XContainer",css:(0,_themeCssHoc.css)(_templateObject2,(0,_units.px2remcss)(_scroller.BarDefaultSize))}),YContainer=(0,_themeCssHoc.StaticComponent)({extend:Container,className:"YContainer",css:(0,_themeCssHoc.css)(_templateObject3,(0,_units.px2remcss)(_scroller.BarDefaultSize))}),getBackground=function(e){return e.disabled?"#898989":_scroller.BarBackgroundColor},Bar=_styledComponents2.default.div(_templateObject4,(0,_units.px2remcss)(8),getBackground,_css.FontSize,(0,_units.px2remcss)(30),_scroller.BarHoverBackgroundColor),scrollerSize=_scroller.BarDefaultSize-_scroller.BarDefaultSizePadding,XBar=(0,_styledComponents2.default)(Bar)(_templateObject5,(0,_units.px2remcss)(scrollerSize),(0,_units.px2remcss)(2),(0,_units.px2remcss)(2)),YBar=(0,_styledComponents2.default)(Bar)(_templateObject6,(0,_units.px2remcss)(scrollerSize),(0,_units.px2remcss)(2),(0,_units.px2remcss)(2)),XScroller="x",YScroller="y",Down="down",Up="up",None="none",DefaultStep=60,Scroller=function(){function t(e){_classCallCheck(this,t);var u=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u.onSliderBarMouseDown=function(e){e.preventDefault(),e.stopPropagation(),u.sliderAbsoulateSize=u.getPos(e)-u.getCurrentPos(),u.changeDrag(!0)},u.onContainerMouseDown=function(e){if(u.clearMove(),!u.isDrag){var t=u.props.step,n=void 0===t?DefaultStep:t;u.step=n;var o=u.getPos(e),r=o>u.value2pos(u.state.value)?Down:Up,i=u.pos2value(o);u.move=setInterval(function(){var e=r===Down?i:u.maxValue;u.fastMove(r,2,e),u.state.value===i&&u.clearMove()},200)}},u.onContainerMouseUp=function(e){!0!==u.isDrag&&(u.processDomEvent(u.getPos(e)),u.clearMove(),u.changeDrag(!1))},u.onSliderBarMouseUp=function(e){e.preventDefault(),e.stopPropagation(),u.changeDrag(!1)},u.onContainerMouseOut=function(){u.isDrag||u.clearMove()},u.onContainerMouseMove=function(e){u.isDrag&&u.processDomEvent(u.getRealSliderPos(e))},u.onWheel=function(e){var t=e.deltaY;u.fastMove(u.getDirection(t),.03,u.maxValue)},u.fastMove=function(e,t,n){if(e!==None){var o=new Date,r=o-u.lastTime,i=u.props.step,s=void 0===i?DefaultStep:i;u.lastTime&&r<500?u.step=u.step*(1+t):u.step=s,u.step=Math.min(u.fastStep,u.step);var a=u.getMoveStep(e,u.step),l=u.state.value+a;if(l=Math.min(l,n),l=Math.max(l,0),void 0!==u.lastFx&&u.lastFx!==e)if(new Date-u.lastTime<200)return void(u.lastFx=e);u.setValue(l),u.lastFx=e,u.lastTime=Number(o)}},u.onChange=function(e){var t=u.props.onChange;t&&t(e)},u.state={value:_FormFieldWidgetSupport2.default.getInitNumberValue(e),sliderSize:u.getSliderBarSize(e)},u.updateStepInfo(e),u}return _inherits(t,React.Component),_createClass(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({value:_FormFieldWidgetSupport2.default.getNumberValue(e,this.state),sliderSize:this.getSliderBarSize(e)})}},{key:"getSliderBarSize",value:function(e){var t=e.viewSize,n=e.totalSize;if(n<=t)return 0;var o=t*t/n;return Math.round(Math.max(o,10))}},{key:"render",value:function(){var t=this,e={},n={},o=void 0,r=void 0,i=this.props.viewSize,s=this.state.sliderSize,a=this.getPX(s),l=this.getPX(this.getCurrentPos()),u=this.getPX(i);if(this.selectType(function(){e={width:a,left:l},(n={width:u}).width=u,o=XBar,r=XContainer},function(){e={height:a,top:l},n={height:u},o=YBar,r=YContainer}),!o||!r)return"";return React.createElement(r,{style:n,ref:function(e){return t.htmlScroller=e},onMouseMove:this.onContainerMouseMove,onMouseDown:this.onContainerMouseDown,onMouseUp:this.onContainerMouseUp,onWheel:this.onWheel,onMouseOut:this.onContainerMouseOut},React.createElement(o,{style:e,onMouseDown:this.onSliderBarMouseDown,onMouseUp:this.onSliderBarMouseUp}))}},{key:"getCurrentPos",value:function(){return this.value2pos(this.state.value)}},{key:"getPX",value:function(e){return""+(0,_units.px2remcss)(e)}},{key:"componentDidMount",value:function(){var t=this;document.body&&(void 0===this.bodyMouseMoveHandle&&(this.bodyMouseMoveHandle=this.bindDoc("mousemove",function(e){t.isDrag&&t.processDomEvent(t.getRealSliderPos(e))})),void 0===this.bodyMouseUpHandle&&(this.bodyMouseUpHandle=this.bindDoc("mouseup",function(){t.changeDrag(!1)})))}},{key:"bindDoc",value:function(e,t){return(0,_addEventListener2.default)(document,e,t)}},{key:"getDirection",value:function(e){return 0===e?None:0<e?Down:Up}},{key:"changeDrag",value:function(e){this.isDrag=e;var t=this.props.onDrag;t&&t(this.isDrag)}},{key:"getPos",value:function(n){var o=this.posGetter.func(this.htmlScroller),r=0;return this.selectType(function(){var e=n.clientX,t=o.x;r=e-t},function(){var e=n.clientY,t=o.y;r=e-t}),Math.min(this.props.viewSize,r)}},{key:"clearMove",value:function(){this.move&&clearInterval(this.move)}},{key:"getRealSliderPos",value:function(e){return this.getPos(e)-this.sliderAbsoulateSize}},{key:"processDomEvent",value:function(e){this.setValue(this.pos2value(e))}},{key:"componentWillUnmount",value:function(){this.bodyMouseMoveHandle&&this.bodyMouseMoveHandle.remove(),this.bodyMouseUpHandle&&this.bodyMouseUpHandle.remove()}},{key:"getMoveStep",value:function(e,t){return e===None?t:e===Down?t:-t}},{key:"setValue",value:function(e){var t=this;if(e!==this.state.value){var n=Math.max(0,e),o=this.maxValue,r=Math.min(n,o);this.setState({value:r},function(){t.scrolling(r)})}}},{key:"scrolling",value:function(e){var t=this;void 0!==this.throttleTimer&&clearTimeout(this.throttleTimer);var n=this.props.throttle;this.throttleTimer=setTimeout(function(){t.onChange(e)},n)}},{key:"selectType",value:function(e,t){switch(this.props.type){case XScroller:e();break;case YScroller:t()}}},{key:"shouldComponentUpdate",value:function(e,t){var n=this.props.viewSize!==e.viewSize||this.props.totalSize!==e.totalSize;return n&&this.updateStepInfo(e),n||this.state.value!==t.value}},{key:"updateStepInfo",value:function(e){var t=e.totalSize,n=e.step,o=void 0===n?DefaultStep:n;this.posGetter=(0,_utils.cacheOnlyFirstCall)(_utils.getElementPosition),this.step=o,this.maxValue=this.getMaxValue(e),this.fastStep=t/34,this.sliderAbsoulateSize=0}},{key:"value2pos",value:function(e){var t=this.props,n=t.viewSize,o=t.totalSize,r=this.getMaxPos();return Math.min(e*r/(o-n),r)}},{key:"pos2value",value:function(e){var t=this.props,n=t.viewSize,o=t.totalSize,r=this.getMaxPos();return Math.min(e*(o-n)/r,this.getMaxValue(this.props))}},{key:"getMaxValue",value:function(e){return e.totalSize-e.viewSize}},{key:"getMaxPos",value:function(){return this.props.viewSize-this.state.sliderSize}}]),t}();Scroller.defaultProps={type:YScroller,throttle:100,totalSize:0,viewSize:0,step:DefaultStep},exports.default=Scroller;