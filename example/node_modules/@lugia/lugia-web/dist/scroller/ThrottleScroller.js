"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_react=require("react"),React=_interopRequireWildcard(_react),_index=require("./index"),_index2=_interopRequireDefault(_index),_index3=require("../consts/index"),_index4=_interopRequireDefault(_index3),_themeUtils=require("@lugia/theme-utils"),_objectUtils=require("@lugia/object-utils"),_scroller=require("../css/scroller"),_support=require("./support");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var EVENTS_TO_MODIFY=["touchstart","touchmove","touchend","touchcancel","wheel"],originalAddEventListener=window.addEventListener.bind();document.addEventListener=function(e,t,r,i){var o=r;return EVENTS_TO_MODIFY.includes(e)&&("boolean"==typeof r?o={capture:r,passive:!1}:"object"===(void 0===r?"undefined":_typeof(r))&&(o=Object.assign({passive:!1},r))),originalAddEventListener(e,t,o,i)};var originalRemoveEventListener=window.removeEventListener.bind();document.removeEventListener=function(e,t,r){var i=r;return EVENTS_TO_MODIFY.includes(e)&&("boolean"==typeof r?i={capture:r,passive:!1}:"object"===(void 0===r?"undefined":_typeof(r))&&(i=Object.assign({passive:!1},r))),originalRemoveEventListener(e,t,i)},exports.default=function(d,i,m,o){var e,t;return _inherits(r,React.Component),_createClass(r,[{key:"componentWillUpdate",value:function(){this.viewSize=this.fetchViewSize()}},{key:"getItemMarginBottom",value:function(){var e=this.getItemWrapThemeConfig().normal,t=(e=void 0===e?{}:e).margin,r=(t=void 0===t?{}:t).bottom,i=void 0===r?0:r;return isNaN(i)?0:i}},{key:"getContainerThemeProps",value:function(e,t){var r=this.props.getPartOfThemeProps(e,t),i=r.themeConfig,o=void 0===i?{}:i,n={boxShadow:(0,_themeUtils.getBoxShadow)("0 1px 6px rgba(0, 0, 0, 0.2)")};return o.normal=(0,_objectUtils.deepMerge)(n,o.normal),r}},{key:"getDefaultHeight",value:function(){var e=this.props.defaultHeight;return isNaN(e)?_scroller.DefaultHeight:Number(e)}},{key:"getActiveAutoHeight",value:function(){var e=this.props,t=e.data,r=void 0===t?[]:t,i=e.autoHeight,o=void 0!==i&&i,n=(0,e.getPartOfThemeProps)(m).themeConfig,a=(n=void 0===n?{}:n).normal,l=(a=void 0===a?{}:a).height;return o||this.itemHeight*r.length<=this.getDefaultHeight()&&!l}},{key:"render",value:function(){function e(e){return React.createElement(_scroller.ScrollerContainer,{themeProps:c,onWheel:s?void 0:t.onWheel},e)}var t=this,r=this.props,i=this.getStart(r,this.state),o=r.level,n=r.autoHeight,a=void 0!==n&&n,l=this.fetchTotalSize(),s=this.getActiveAutoHeight(),u=this.getDefaultHeight(),c=this.getContainerThemeProps(m,{props:{isDrag:this.isDrag,autoHeight:s,totalSize:l,defaultHeight:u}});if(!this.isNeedScroller()||a){var h=this.getTarget().length;return e(React.createElement(d,Object.assign({},r,{start:0,end:h,canSeeCount:h,itemHeight:this.itemHeight,ref:this.scrollerTarget,defaultHeight:this.getDefaultHeight(),marginBottom:this.marginBottom})))}var g=r.type,f=r.step,p=this.fetchEnd(i),v=this.canSeeCount();return e([React.createElement(_scroller.Col,{themeProps:c,level:o},React.createElement(d,Object.assign({},r,{canSeeCount:v,start:i,end:p,itemHeight:this.itemHeight,ref:this.scrollerTarget,defaultHeight:this.getDefaultHeight(),marginBottom:this.marginBottom}))),React.createElement(_scroller.ScrollerCol,{level:o,themeProps:c,isDrag:this.isDrag},React.createElement(_index2.default,{ref:function(e){return t.scroller=e},type:g,onDrag:this.onDrag,value:this.itemHeight*i,viewSize:this.viewSize,totalSize:l,onChange:this.onScroller,step:f}))])}},{key:"getStart",value:function(e,t){function r(e){var t=Math.max(0,o-i.canSeeCount()+1);return Math.min(e,t)}var i=this,o=this.getTarget().length;if("start"in e){var n=e.start;return r(void 0===n?0:n)}var a=t.start;return r(void 0===a?0:a)}},{key:"isNeedScroller",value:function(){var e=this.getTarget().length;return this.canSeeCount()<e}},{key:"canSeeCount",value:function(){return(0,_support.getCanSeeCount)(this.viewSize,this.itemHeight)}},{key:"fetchTotalSize",value:function(){var e=this.getTarget().length,t=void 0;t=this.viewSize%this.itemHeight==0?0:this.viewSize%this.itemHeight;var r=this.props.getPartOfThemeConfig(m).normal,i=(r=void 0===r?{}:r).padding,o=(i=void 0===i?{}:i).top,n=void 0===o?0:o,a=i.bottom,l=void 0===a?0:a;return e*this.itemHeight+t+n+l+e*this.marginBottom}},{key:"getTarget",value:function(){var e=this.props,t=e.data,r=e.children;return t||r?t||r:[]}},{key:"fetchEnd",value:function(e){var t=this.getTarget().length;if(0===t)return 0;var r=this.canSeeCount();return Math.min(r+Math.max(e,0),t)}}]),t=e=r,e.displayName=_index4.default.ThrottleScroller,e.defaultProps={mutliple:!1},t;function r(e){_classCallCheck(this,r);var f=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return f.getItemWrapThemeConfig=function(){var e=f.props.getPartOfThemeConfig,t=o[0],r=o[1],i=e(t);return i[r]?i[r]:{}},f.getActiveItemHeight=function(e){var t=f.getItemWrapThemeConfig().normal,r=(t=void 0===t?{}:t).height;return void 0===r?i:r},f.onDrag=function(e){f.isDrag=e},f.fetchViewSize=function(){var e=f.props,t=e.autoHeight,r=void 0!==t&&t,i=(0,e.getPartOfThemeConfig)(m).normal,o=void 0===i?{}:i,n=o.height;n=n||0===n?n:f.getDefaultHeight();var a=f.props.data;a&&null!==a||(a=[]);var l=o.padding,s=(l=void 0===l?{}:l).top,u=void 0===s?0:s,c=l.bottom,h=void 0===c?0:c,g=f.itemHeight*a.length+u+h;return r?g:n},f.onWheel=function(e){f.isNeedScroller()&&(e.stopPropagation(),e.preventDefault()),f.scroller&&f.scroller.onWheel&&f.scroller.onWheel.call(f.scroller,e)},f.onScroller=function(e){var t=f.props.onScroller,r=e/f.itemHeight;t?t(r,f.fetchEnd(r)):f.setState({start:r})},f.state={start:0},f.itemHeight=f.getActiveItemHeight(e),f.scrollerTarget=React.createRef(),f.viewSize=f.fetchViewSize(),f.marginBottom=f.getItemMarginBottom(),f}};