"use strict";var _react=require("react"),React=_interopRequireWildcard(_react);require("jest-styled-components");var _enzyme=require("enzyme"),_enzyme2=_interopRequireDefault(_enzyme),_reactTestUtils=require("@lugia/react-test-utils"),_enzymeAdapterReact=require("enzyme-adapter-react-16"),_enzymeAdapterReact2=_interopRequireDefault(_enzymeAdapterReact),_chai=require("chai"),_chai2=_interopRequireDefault(_chai),_ThrottleScroller=require("../ThrottleScroller"),_ThrottleScroller2=_interopRequireDefault(_ThrottleScroller),_jverify=require("@lugia/jverify"),_reactTestRenderer=require("react-test-renderer"),_reactTestRenderer2=_interopRequireDefault(_reactTestRenderer),_=require("../"),_2=_interopRequireDefault(_),_units=require("../../css/units");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var em=(0,_units.px2emcss)(1.2),exp=_chai2.default.expect;_enzyme2.default.configure({adapter:new _enzymeAdapterReact2.default}),describe("ThrottleScroller",function(){function e(e){var r={},t=(0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),n=(0,_reactTestUtils.createTestComponent)(t,function(e){r=e;var t=_jverify.mockObject.create(e);t.mockFunction("fetchViewSize").forever(101),t.mockFunction("fetchTotalSize").returned(102),t.mockFunction("isNeedScroller").mock(function(){return!0})}),c=(0,_enzyme.mount)(React.createElement(n,{type:e}));exp(r.scroller).to.be.undefined,c=c.setState({start:1}),exp(c.find(_2.default).length).to.be.equal(1),exp(c.find(_2.default).props().onChange).to.be.equal(r.onScroller),exp(c.find(_2.default).props().onDrag).to.be.equal(r.onDrag),expect(c.find(_2.default).props()).toEqual({viewSize:101,totalSize:102,value:0,type:e||"y",onChange:r.onScroller,onDrag:r.onDrag,throttle:100,step:30}),exp(r.scroller).to.be.not.null;var a={},o=_jverify.mockObject.create(r),l=_jverify.mockObject.create(a);o.mockVar("scroller").forever(a);var u=l.mockFunction("onWheel");u.returned(!0);var i={target:"ligx",stopPropagation:function(){},preventDefault:function(){}};r.onWheel(i),exp(u.getCallContext(0)).to.be.equal(a),exp(u.getCallArgs(0)).to.be.eql([i])}it("getTarget: target is data",function(){var t=[1,2,3,4,5,6,7,8,9,10],e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){exp(e.getTarget()).to.be.equal(t)});(0,_enzyme.mount)(React.createElement(e,{data:t}))}),it("getTarget: target is children",function(){function e(e){return React.createElement("div",null,e.children)}var t=[React.createElement(e,{key:"a"},"hello"),React.createElement(e,{key:"b"},"world")],r=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){exp(e.getTarget()).to.be.equal(t)});(0,_enzyme.mount)(React.createElement(r,null,t))}),it("getTarget: target is null",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){exp(e.getTarget()).to.be.eql([])});(0,_enzyme.mount)(React.createElement(e,null))}),it("isNeedScroller is false  data的数量为0",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){var t=_jverify.mockObject.create(e),r=t.mockFunction("getTarget"),n=t.mockFunction("canSeeCount");r.returned([]),n.returned(0),r.returned([]),n.returned(10),exp(e.isNeedScroller()).to.be.false,exp(e.isNeedScroller()).to.be.false});(0,_enzyme.mount)(React.createElement(e,null))}),it("isNeedScroller is false 可见的数大于总数",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){var t=_jverify.mockObject.create(e),r=t.mockFunction("getTarget"),n=t.mockFunction("canSeeCount");r.returned([]),n.returned(5),exp(e.isNeedScroller()).to.be.false});(0,_enzyme.mount)(React.createElement(e,null))}),it("isNeedScroller is true 可见的数小于总数",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){var t=_jverify.mockObject.create(e),r=t.mockFunction("getTarget"),n=t.mockFunction("canSeeCount");r.returned([1,2,3,4,5,6]),n.returned(5),exp(e.isNeedScroller()).to.be.true});(0,_enzyme.mount)(React.createElement(e,null))}),it("fetchViewSize",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){exp(e.fetchViewSize()).to.be.equal(500)});(0,_enzyme.mount)(React.createElement(e,{getTheme:function(){return{height:500}}}))}),it("fetchViewSize default",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){exp(e.fetchViewSize()).to.be.equal(250)});(0,_enzyme.mount)(React.createElement(e,null))}),it("getStart",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){exp(e.getStart({},{start:100}),"is state.start").to.be.equal(100),exp(e.getStart({start:1e3},{start:100}),"is props.start").to.be.equal(976),exp(e.getStart({},{}),"is empty 0").to.be.equal(0)});(0,_enzyme.mount)(React.createElement(e,{getTheme:function(){return{height:500}},data:{length:1e3}}))}),it("fetchTotalSize",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){var t=[1,2,3,4,54,5];_jverify.mockObject.create(e).mockFunction("getTarget").returned(t),exp(e.fetchTotalSize()).to.be.equal(20*t.length)});(0,_enzyme.mount)(React.createElement(e,{getTheme:function(){return{height:500}}}))}),it("canSeeCount",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){var t=_jverify.mockObject.create(e).mockFunction("fetchViewSize");t.returned(100),exp(e.canSeeCount()).to.be.equal(5),t.returned(0),exp(e.canSeeCount()).to.be.equal(0),t.returned(-100),exp(e.canSeeCount()).to.be.equal(0),t.returned(81),exp(e.canSeeCount()).to.be.equal(5),t.returned(70),exp(e.canSeeCount()).to.be.equal(4),t.returned(69),exp(e.canSeeCount()).to.be.equal(4)});(0,_enzyme.mount)(React.createElement(e,null))}),it("canSeeCount itemHeight =0",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},0),function(e){var t=_jverify.mockObject.create(e).mockFunction("fetchViewSize");t.returned(100),exp(e.canSeeCount()).to.be.equal(0),t.returned(0),exp(e.canSeeCount()).to.be.equal(0),t.returned(-100),exp(e.canSeeCount()).to.be.equal(0),t.returned(81),exp(e.canSeeCount()).to.be.equal(0),t.returned(70),exp(e.canSeeCount()).to.be.equal(0),t.returned(69),exp(e.canSeeCount()).to.be.equal(0)});(0,_enzyme.mount)(React.createElement(e,null))}),it("canSeeCount itemHeight <0",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},-100),function(e){var t=_jverify.mockObject.create(e).mockFunction("fetchViewSize");t.returned(100),exp(e.canSeeCount()).to.be.equal(0),t.returned(0),exp(e.canSeeCount()).to.be.equal(0),t.returned(-100),exp(e.canSeeCount()).to.be.equal(0),t.returned(81),exp(e.canSeeCount()).to.be.equal(0),t.returned(70),exp(e.canSeeCount()).to.be.equal(0),t.returned(69),exp(e.canSeeCount()).to.be.equal(0)});(0,_enzyme.mount)(React.createElement(e,null))}),it("fetchStart&End",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){var t=_jverify.mockObject.create(e),r=t.mockFunction("canSeeCount"),n=t.mockFunction("getTarget");n.returned([]),exp(e.fetchEnd(3)).to.be.equal(0),n.forever([1,2,3,4,5,6,7,8,9,10,11]),r.returned(5),exp(e.fetchEnd(3)).to.be.equal(8),r.returned(5),exp(e.fetchEnd(4)).to.be.equal(9),r.returned(5),exp(e.fetchEnd(5)).to.be.equal(10),r.returned(5),exp(e.fetchEnd(100)).to.be.equal(11),r.returned(5),exp(e.fetchEnd(-1)).to.be.equal(5),r.returned(0),exp(e.fetchEnd(5)).to.be.equal(5)});(0,_enzyme.mount)(React.createElement(e,null))}),it("没有滚动条",function(){var e=(0,_reactTestUtils.createTestComponent)((0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),function(e){_jverify.mockObject.create(e).mockFunction("isNeedScroller").returned(!1)}),t=(0,_enzyme.mount)(React.createElement(e,null));t.render(),exp(t.html()).to.be.equal('<div class="sc-gzVnrw duvRXJ"><div>1</div></div>')}),it("有滚动条 滚动条的属性是否正确 scroler.type is default y",function(){e()}),it("有滚动条 滚动条的属性是否正确 scroler.type is x",function(){e("x")}),it("Target props & start & end",function(){function e(){return React.createElement("div",null,"1")}var r={},t=(0,_ThrottleScroller2.default)(e,20),n=(0,_reactTestUtils.createTestComponent)(t,function(e){r=e;var t=_jverify.mockObject.create(e);t.mockFunction("fetchViewSize").forever(101),t.mockFunction("fetchTotalSize").forever(102),t.mockFunction("fetchEnd").returned(100),t.mockFunction("isNeedScroller").mock(function(){return!0})}),c=Math.floor(5.05),a=(0,_enzyme.mount)(React.createElement(n,{data:{length:1e3}})),o=(a=a.setState({start:100})).find(e).props();exp(o.end).to.be.equal(100),exp(o.start).to.be.equal(0),r.onScroller(100),a.setState({start:100}),o=a.find(e).props(),exp(o.start).to.be.equal(5),exp(o.end).to.be.equal(5+c+1)}),it("需要滚动条 HTML结构",function(){var e=(0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20);expect(_reactTestRenderer2.default.create(React.createElement(e,{getTheme:function(){return{height:50,width:300}},data:[1,2,3,4,5,6,7,8,9]})).toJSON()).toMatchSnapshot()}),it("需要滚动条 HTML结构 theme is default data is 10 len",function(){var e=(0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20);expect(_reactTestRenderer2.default.create(React.createElement(e,{data:[1,2,3,4,5,6,7,8,9]})).toJSON()).toMatchSnapshot()}),it("需要滚动条 HTML结构 theme is default data is 100 len",function(){for(var e=(0,_ThrottleScroller2.default)(function(){return React.createElement("div",null,"1")},20),t=[],r=0;r<100;r++)t.push(r);expect(_reactTestRenderer2.default.create(React.createElement(e,{data:t})).toJSON()).toMatchSnapshot()}),it("需要滚动条 HTML结构 children",function(){for(var e=function(e){return React.createElement("div",null,e.title)},t=[],r=0;r<100;r++)t.push(React.createElement(e,{key:"key"+r,title:"title"+r}));var n=(0,_ThrottleScroller2.default)(function(e){return React.createElement("div",null,e.children)},20);expect(_reactTestRenderer2.default.create(React.createElement(n,null,t)).toJSON()).toMatchSnapshot()})});