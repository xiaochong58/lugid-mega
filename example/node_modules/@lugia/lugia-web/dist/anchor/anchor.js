"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnchorContext=void 0;var _class,_temp,_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_themeProvider=require("../theme-provider"),_themeProvider2=_interopRequireDefault(_themeProvider),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_index3=require("../affix/index"),_index4=_interopRequireDefault(_index3),_anchor=require("../css/anchor");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var AnchorContext=exports.AnchorContext=React.createContext({links:[],getLinks:void 0,activeLink:void 0,onClick:void 0});exports.default=(0,_themeProvider2.default)((_temp=_class=function(){function t(e){_classCallCheck(this,t);var c=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return c.initScroll=function(){var e=window&&window.location.href;if(e){var t=e.split("#")[1],n=document.getElementById(t);n&&(c.handleLinkClick(void 0,"#"+t),n.scrollIntoView({block:"start",behavior:"smooth"}))}},c.addWindowScrollListener=function(){if(!c.isClick){var e=c.props.offsetTop,t=void 0===e?0:e,n=c.getAcrossLinks(c.links,t);c.setScrollActiveLink(n)}},c.getAcrossLinks=function(e,i){var o=[];return e.forEach(function(e){var t=c.getId(e);if(t){var n=document.getElementById(t);if(n){var r=n.getBoundingClientRect().top;r<=i&&o.push({link:e,top:r})}}}),o},c.setScrollActiveLink=function(e){c.setState({activeLink:c.getMaxTopLink(e)})},c.handleLinkClick=function(e,t){var n=c.props.onClick;c.isClick=!0,c.setState({activeLink:t}),n&&n(e,t),setTimeout(function(){c.isClick=!1},500)},c.updateLinks=function(e){c.links=[].concat(_toConsumableArray(e))},c.state={activeLink:""},c.isClick=!1,c.links=[],c}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){var e=this;this.initScroll(),setTimeout(function(){window.addEventListener("scroll",e.addWindowScrollListener)},100)}},{key:"getMaxTopLink",value:function(e){return Array.isArray(e)&&0!==e.length?e.reduce(function(e,t){return t.top>e.top?t:e}).link:""}},{key:"render",value:function(){var e=this.props,t=e.affix,n=void 0===t||t,r=e.offsetTop,i=void 0===r?0:r,o=e.children,c=e.slideType,a=void 0===c?"circle":c,l=e.slideLine,s=void 0===l||l,u=e.useHref,f=void 0===u||u,d=this.state.activeLink,p=void 0;d&&(p=this.links?this.links.indexOf(d):0);var v=React.createElement(_anchor.Anchor,{slideType:a,slideLine:s},o,React.createElement(_anchor.Circle,{slideType:a,index:p}));return React.createElement(AnchorContext.Provider,{value:{links:[],getLinks:this.updateLinks,activeLink:d,onClick:this.handleLinkClick,useHref:f}},n?React.createElement(_index4.default,{offsetTop:i},v):v)}},{key:"getId",value:function(e){var t=/#([^#]+)$/.exec(e);if(t)return t[1]}}]),t}(),_class.displayName="Anchor",_temp),_index2.default.Anchor);