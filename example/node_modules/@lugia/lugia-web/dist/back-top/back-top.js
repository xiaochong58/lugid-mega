"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp,_createClass=function(){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}}(),_react=require("react"),React=_interopRequireWildcard(_react),_themeHoc=require("@lugia/theme-hoc"),_themeProvider=require("../theme-provider"),_themeProvider2=_interopRequireDefault(_themeProvider),_icon=require("../icon"),_icon2=_interopRequireDefault(_icon),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_affix=require("../affix/affix"),_backTop=require("../css/back-top");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.default=(0,_themeProvider2.default)((_temp=_class=function(){function t(e){_classCallCheck(this,t);var l=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return l.addWindowListener=function(){var e=(0,_affix.getScrollTop)(),t=l.props.visibilityHeight,o=void 0===t?400:t;l.setState({fixed:l.needFixed(e,o)})},l.addTargetListener=function(){var e=l.props,t=e.visibilityHeight,o=void 0===t?400:t,r=e.target;if(r){var n=r().getBoundingClientRect(),i=n.bottom,a=n.right-60,c=i-50,s=r().scrollTop;l.setState({fixed:l.needFixed(s,o),posRight:a,posBottom:c})}},l.needFixed=function(e,t){return t<=e},l.handleClick=function(){if(l.hasTarget()){var t=l.props.target;if(t&&"function"==typeof t)var o=setInterval(function(){var e=t().scrollTop;e<=0&&clearInterval(o),l.scrollerTargetTo(e-50)})}else if(document)var r=setInterval(function(){var e=(0,_affix.getScrollTop)();e<=0&&clearInterval(r),l.scrollerBodyTo(e-200)},20)},l.state={fixed:!1,posBottom:50,posRight:30},l}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.target;t&&"function"==typeof t?setTimeout(function(){t().addEventListener("scroll",e.addTargetListener)},100):(this.addWindowListener(),window.addEventListener("scroll",this.addWindowListener))}},{key:"scrollerBodyTo",value:function(e){document.body&&(document.body.scrollTop=e),document.documentElement&&(document.documentElement.scrollTop=e)}},{key:"scrollerTargetTo",value:function(e){var t=this.props.target;t&&(t().scrollTop=e)}},{key:"componentWillUnmount",value:function(){if(window.removeEventListener("scroll",this.addWindowListener),this.hasTarget()){var e=this.props.target;if(e&&"function"==typeof e){var t=e();t&&t.removeEventListener("scroll",this.addTargetListener)}}}},{key:"render",value:function(){var e=this.props,t=e.children,o=e.themeProps,r=e.getPartOfThemeProps,n=e.getPartOfThemeHocProps,i=e.icon,a=void 0===i?"lugia-icon-direction_up":i,c=this.state,s=c.fixed,l=c.posRight,u=c.posBottom;return React.createElement("div",(0,_themeHoc.addMouseEvent)(this),s?React.createElement(_backTop.BackTop,{themeProps:o,fixed:s,posRight:l,posBottom:u,onClick:this.handleClick,hasTarget:this.hasTarget()},t||React.createElement(_backTop.BackTopContent,{themeProps:r("Container")},React.createElement(_backTop.IconBox,Object.assign({themeProps:o},(0,_themeHoc.addMouseEvent)(this)),React.createElement(_icon2.default,Object.assign({iconClass:a},n("BackTopIcon"),{singleTheme:!0}))))):null)}},{key:"hasTarget",value:function(){return"target"in this.props}}]),t}(),_class.displayName="BackTop",_temp),_index2.default.BackTop);