"use strict";var _createClass=function(){function u(e,t){for(var n=0;n<t.length;n++){var u=t[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,u.key,u)}}return function(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_=require("../"),_2=_interopRequireDefault(_),_theme=require("../../theme"),_theme2=_interopRequireDefault(_theme),_reactTestRenderer=require("react-test-renderer"),_reactTestRenderer2=_interopRequireDefault(_reactTestRenderer),_chai=require("chai"),_chai2=_interopRequireDefault(_chai);require("jest-styled-components");var _InputTestUtils=require("../../input/__tests__/InputTestUtils"),_enzyme=require("enzyme"),_enzyme2=_interopRequireDefault(_enzyme),_enzymeAdapterReact=require("enzyme-adapter-react-16"),_enzymeAdapterReact2=_interopRequireDefault(_enzymeAdapterReact),_consts=require("../../consts"),_consts2=_interopRequireDefault(_consts);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_enzyme2.default.configure({adapter:new _enzymeAdapterReact2.default});var exp=_chai2.default.expect,_require=require("@lugia/jverify"),mockFunction=_require.mockFunction,VerifyOrder=_require.VerifyOrder,VerifyOrderConfig=_require.VerifyOrderConfig,LimitNumberInputBox=function(){function r(){var e,t,n;_classCallCheck(this,r);for(var u=arguments.length,a=Array(u),l=0;l<u;l++)a[l]=arguments[l];return(t=n=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(a)))).onChange=function(e){var t=e.newValue;n.setState({value:t})},_possibleConstructorReturn(n,t)}return _inherits(r,_react2.default.Component),_createClass(r,[{key:"render",value:function(){return _react2.default.createElement(_2.default,{value:this.state.value,onChange:this.onChange})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t?{}:{value:e.value}}}]),r}();describe("NumberInput",function(){var u=void 0,t=void 0,n=void 0;beforeEach(function(){u=VerifyOrder.create(),t=mockFunction.create(VerifyOrderConfig.create("onChange",u)),n=t.getFunction()});function e(e){it("props: size",function(){expect(_reactTestRenderer2.default.create(_react2.default.createElement(_2.default,{size:e})).toJSON()).toMatchSnapshot()})}function a(n){it("props: placeholder ",function(){var e=_react2.default.createElement(_2.default,{placeholder:n}),t=(0,_enzyme.mount)(e);expect(_reactTestRenderer2.default.create(e).toJSON()).toMatchSnapshot(),exp(t.props().placeholder).to.be.equal(n)})}function r(e){return e.children().children().instance()}function l(t){it(""+t.title,function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{defaultValue:t.defaultValue,step:t.step}));i(e,"Minus",t.clickMinusCount),i(e,"Plus",t.clickPlusCount),expect(r(e).state.value).toBe(t.expectValue)})}function i(e,t,n){for(var u=0;u<n;u++)a=t,e.find(a).simulate("click");var a}function c(t){it(" "+t.title+" max "+t.props.max+", min "+t.props.min+", defaultValue "+t.props.defaultValue+", clickPlus "+t.clickPlusCount+", clickMinus "+t.clickMinusCount+" ",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,t.props));i(e,"Plus",t.clickPlusCount),i(e,"Minus",t.clickMinusCount),expect(r(e).state.value).toBe(t.expectValue)})}function o(e,t,n,u,a){it("props :disabled  click "+e,function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{disabled:t,defaultValue:"10",step:5}));i(e,"Plus",n),i(e,"Minus",u),expect(r(e).state.value).toBe(a)})}function s(t,n,u,a){it(" prop :step "+t+"  ",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{step:t,defaultValue:10}));i(e,"Plus",n),i(e,"Minus",u),expect(r(e).state.value).toBe(a)})}function p(t,n,u,a,l){it("props :formatter&&parser",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,t));i(e,"Plus",n),i(e,"Minus",u),expect(r(e).state.value).toBe(a),(0,_InputTestUtils.assertInputValue)(e,l)})}it("props: null",function(){expect(_reactTestRenderer2.default.create(_react2.default.createElement(_2.default,null)).toJSON()).toMatchSnapshot()}),e("small"),e("large"),a("请填写内容"),a(""),it("props: getTheme: width:100,margin:10,",function(){var e=_defineProperty({},_consts2.default.NumberInput,{width:300}),t=_react2.default.createElement(_theme2.default,{config:e},_react2.default.createElement(_2.default,null));expect(_reactTestRenderer2.default.create(t)).toMatchSnapshot()}),it("props: keyboard event is null but fire keyup event",function(){(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyUp",{keyCode:49,Target:_2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyDown",{keyCode:49,Target:_2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyPress",{keyCode:49,Target:_2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onFocus",{keyCode:49,Target:_2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onBlur",{keyCode:49,Target:_2.default})}),it("props: onKeyUp",function(){(0,_InputTestUtils.testKeyBoardEvent)(u,"onKeyUp",{keyCode:49,Target:_2.default})}),it("props: onKeyPress",function(){(0,_InputTestUtils.testKeyBoardEvent)(u,"onKeyPress",{keyCode:49,Target:_2.default})}),it("props: onKeyDown",function(){(0,_InputTestUtils.testKeyBoardEvent)(u,"onKeyDown",{keyCode:49,Target:_2.default})}),it("props: onFocus",function(){(0,_InputTestUtils.testKeyBoardEvent)(u,"onFocus",{keyCode:49,Target:_2.default})}),it("props: onBlur",function(){(0,_InputTestUtils.testKeyBoardEvent)(u,"onBlur",{keyCode:49,Target:_2.default})}),it("props: onEnter Fired",function(){var e=mockFunction.create(VerifyOrderConfig.create("onEnter",u)),t={keyCode:13};e.mock(function(e){var t=e.keyCode;exp(t).to.be.equal(t)});var n={onEnter:e.getFunction()};(0,_enzyme.mount)(_react2.default.createElement(_2.default,n)).find("input").simulate("keyDown",t),u.verify(function(e){e.onEnter(VerifyOrder.Object)})}),it("props: onEnter Not Fired",function(){var e={keyCode:44},t={onEnter:mockFunction.create(VerifyOrderConfig.create("onEnter",u)).getFunction()};(0,_enzyme.mount)(_react2.default.createElement(_2.default,t)).find("input").simulate("keyDown",e),u.verify(function(e){})}),it("props: null  Fired Enter",function(){var e={keyCode:13};(0,_enzyme.mount)(_react2.default.createElement(_2.default,null)).find("input").simulate("keyDown",e)}),it("props: value changed Limited NumberInput no changed",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(LimitNumberInputBox,{value:20}));(0,_InputTestUtils.assertInputValue)(e,"20"),e.setProps({value:30}),(0,_InputTestUtils.assertInputValue)(e,"20")}),it("props: defaultValue",function(){var e=(_inherits(t,_react2.default.Component),_createClass(t,[{key:"render",value:function(){return _react2.default.createElement(_2.default,{defaultValue:this.props.defaultValue})}}]),t);function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}var n=(0,_enzyme.mount)(_react2.default.createElement(e,{defaultValue:10}));(0,_InputTestUtils.assertInputValue)(n,"10"),n.find("input").simulate("change",{target:{value:30}}),(0,_InputTestUtils.assertInputValue)(n,"30")}),it("props: defaultValue & value",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{defaultValue:10,value:20}));(0,_InputTestUtils.assertInputValue)(e,"20")}),l({title:"clickPlusCount 1 clickMinusCount 0",clickPlusCount:1,clickMinusCount:0,defaultValue:10,step:5,expectValue:15}),l({title:"clickPlusCount 0 clickMinusCount 1",clickPlusCount:0,clickMinusCount:1,defaultValue:10,step:5,expectValue:5}),l({title:"clickPlusCount 1 clickMinusCount 1",clickPlusCount:1,clickMinusCount:1,defaultValue:10,step:5,expectValue:10}),l({title:"clickPlusCount 3 clickMinusCount 2",clickPlusCount:3,clickMinusCount:2,defaultValue:10,step:5,expectValue:15}),l({title:"clickPlusCount 10 clickMinusCount 0",clickPlusCount:10,clickMinusCount:0,defaultValue:10,step:5,expectValue:60}),l({title:"clickPlusCount 0 clickMinusCount 10",clickPlusCount:0,clickMinusCount:10,defaultValue:10,step:5,expectValue:-40}),l({title:"clickPlusCount 5 clickMinusCount 5",clickPlusCount:5,clickMinusCount:5,defaultValue:10,step:5,expectValue:10}),c({props:{defaultValue:1,step:5,max:10,min:0},title:"test max only click plus",clickPlusCount:2,clickMinusCount:0,expectValue:10}),c({props:{defaultValue:10,step:1,max:10,min:0},title:"test max click  plus>minus",clickPlusCount:2,clickMinusCount:1,expectValue:9}),c({props:{defaultValue:10,step:5,max:10,min:0},title:"test max click click plus>minus",clickPlusCount:5,clickMinusCount:1,expectValue:5}),c({props:{defaultValue:10,step:2,min:1,max:100},title:"test min only click plus",clickPlusCount:0,clickMinusCount:5,expectValue:1}),c({props:{defaultValue:10,step:5,min:1,max:100},title:"test min  click minus>plus",clickPlusCount:2,clickMinusCount:5,expectValue:1}),c({props:{defaultValue:10,step:5,min:0,max:100},title:"test min  click plus<minus",clickPlusCount:2,clickMinusCount:6,expectValue:0}),o("plus",!0,10,0,10),o("minus",!0,0,10,10),o("plus",!1,10,0,60),o("minus",!1,0,10,-40),s(3,10,0,40),s(5,10,5,35),s(0,10,20,10),s(-1,10,20,20);function f(t,n,u,a){it("props :precision "+t.precision,function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,t));i(e,"Plus",n),i(e,"Minus",u),expect(r(e).state.value).toBe(a)})}function d(a,l){it("props: onchange "+a.title+" ",function(){u=VerifyOrder.create(),t=mockFunction.create(VerifyOrderConfig.create("onChange",u)),n=t.getFunction();var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,Object.assign({},l,{onChange:n})));e.find("input").simulate("change",{target:{value:a.keyPressValue}}),expect(r(e).state.value).toBe(a.stateValue),u.verify(function(e){var t=e.onChange,n=l.value,u=l.defaultValue;t({newValue:a.changeEventValue,oldValue:"value"in l?n:u,event:VerifyOrder.Any})})})}p({formatter:function(e){return("$"+e).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(e){return e.replace(/\$\s?|(,*)/g,"")},defaultValue:1e4,step:5e4,max:1e6,min:1e4},5,2,16e4,"$160,000"),p({formatter:function(e){return e+"%"},parser:function(e){return e.replace("%","")},defaultValue:10,step:5,max:100,min:10},5,2,25,"25%"),f({precision:0,defaultValue:10,step:5,max:100,min:10},5,2,25),f({precision:2,defaultValue:1.5,step:.5,max:10,min:1},4,2,2.5),f({precision:3,defaultValue:1.05,step:.05,max:10,min:1},4,2,1.15),f({precision:4,defaultValue:1.05,step:.005,max:10,min:1},5,2,1.065),d({title:"props: onchange change value  ",keyPressValue:20,stateValue:20,changeEventValue:20},{step:5,max:100,defaultValue:10,min:10}),d({title:"props: onchange change value 30  ",keyPressValue:30,stateValue:30,changeEventValue:30},{step:5,max:100,defaultValue:10,min:10}),d({title:"props: onchange change value 50  ",keyPressValue:50,stateValue:50,changeEventValue:50},{step:5,max:100,defaultValue:10,min:10})});