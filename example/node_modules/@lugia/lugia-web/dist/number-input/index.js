"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}(),_templateObject=_taggedTemplateLiteral(["\n    height: 100%;\n    border-left: "," solid ",";\n    -webkit-transition: all 0.3s linear 0.1s;\n    transition: all 0.3s linear 0.1s;\n    box-sizing: border-box;\n  "],["\n    height: 100%;\n    border-left: "," solid ",";\n    -webkit-transition: all 0.3s linear 0.1s;\n    transition: all 0.3s linear 0.1s;\n    box-sizing: border-box;\n  "]),_templateObject2=_taggedTemplateLiteral(["\n    text-align: center;\n    color: rgba(0, 0, 0, 0.45);\n    position: relative;\n    transition: all pointer 0.1s linear;\n    display: block;\n    width: 100%;\n    font-weight: bold;\n  "],["\n    text-align: center;\n    color: rgba(0, 0, 0, 0.45);\n    position: relative;\n    transition: all pointer 0.1s linear;\n    display: block;\n    width: 100%;\n    font-weight: bold;\n  "]),_templateObject3=_taggedTemplateLiteral(["\n    border-top: "," solid ",";\n    height: 50%;\n  "],["\n    border-top: "," solid ",";\n    height: 50%;\n  "]),_templateObject4=_taggedTemplateLiteral(["\n    height: 50%;\n  "],["\n    height: 50%;\n  "]);require("../common/shirm");var _react=require("react"),_react2=_interopRequireDefault(_react),_themeHoc=require("@lugia/theme-hoc"),_themeHoc2=_interopRequireDefault(_themeHoc),_index=require("../input/index"),_index2=_interopRequireDefault(_index),_consts=require("../consts"),_consts2=_interopRequireDefault(_consts),_KeyBoardEventAdaptor=require("../common/KeyBoardEventAdaptor"),_KeyBoardEventAdaptor2=_interopRequireDefault(_KeyBoardEventAdaptor),_index3=require("../icon/index"),_index4=_interopRequireDefault(_index3),_Math=require("../common/Math"),_css=require("@lugia/css"),_themeCssHoc=require("@lugia/theme-css-hoc"),_themeCssHoc2=_interopRequireDefault(_themeCssHoc),_objectUtils=require("@lugia/object-utils"),_themeCommonDict=require("../css/theme-common-dict"),_themeCommonDict2=_interopRequireDefault(_themeCommonDict),_validateHoc=require("../input/validateHoc"),_validateHoc2=_interopRequireDefault(_validateHoc),_validateHoc3=require("../css/validateHoc");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var px2remcss=_css.units.px2remcss,ArrowIconContainer=(0,_themeCssHoc2.default)({tag:"div",className:"ArrowIconContainer",normal:{selectNames:[["width"],["fontSize"],["font"],["color"],["background"],["cursor"],["margin"],["padding"],["opacity"]],getThemeMeta:function(e,t){var r=t.propsConfig,o=e.width;return{cursor:r.disabled?"not-allowed":"pointer",width:o||22}}},hover:{selectNames:[["font"],["fontSize"],["color"],["background"],["cursor"],["opacity"]]},active:{selectNames:[["font"],["fontSize"],["color"],["background"],["cursor"],["opacity"]]},disabled:{selectNames:[["font"],["fontSize"],["color"],["background"],["cursor"],["opacity"]],defaultTheme:{opacity:0}},css:(0,_themeCssHoc.css)(_templateObject,px2remcss(1),(0,_themeCommonDict2.default)("borderColor")),option:{hover:!0,active:!0}}),StepButton=(0,_themeCssHoc2.default)({tag:"span",className:"NumberInputStepButton",normal:{selectNames:[["cursor"]],defaultTheme:{cursor:"pointer"}},css:(0,_themeCssHoc.css)(_templateObject2)}),MinusButton=(0,_themeCssHoc2.default)({extend:StepButton,className:"NumberInputMinusButton",normal:{selectNames:[]},hover:{selectNames:[["height"],["cursor"]],getThemeMeta:function(e,t){var r=t.propsConfig,o=r.hover;return{height:"no"===o?"50%":"minus"===o?"60%":"40%",cursor:r.outRange?"not-allowed":"pointer"}}},disabled:{selectNames:[["cursor"],["opacity"]],defaultTheme:{cursor:"not-allowed",opacity:0}},css:(0,_themeCssHoc.css)(_templateObject3,px2remcss(1),(0,_themeCommonDict2.default)("borderColor")),option:{hover:!0,active:!0}}),PlusButton=(0,_themeCssHoc2.default)({extend:StepButton,className:"NumberInputPlusButton",normal:{selectNames:[]},hover:{selectNames:[["height"],["cursor"]],getThemeMeta:function(e,t){var r=t.propsConfig,o=r.hover;return{height:"no"===o?"50%":"plus"===o?"60%":"40%",cursor:r.outRange?"not-allowed":"pointer"}}},disabled:{selectNames:[["cursor"],["opacity"]],defaultTheme:{cursor:"not-allowed",opacity:0}},css:(0,_themeCssHoc.css)(_templateObject4),option:{hover:!0,active:!0}});PlusButton.displayName="Plus",MinusButton.displayName="Minus";var PlusClass="lugia-icon-direction_up",MinusClass="lugia-icon-direction_down";function hasValueProps(e){return"value"in e}function getOverMax(e,t){return Number(e)>=t}function getBelowMin(e,t){return Number(e)<=t}var NumberTextBox=function(){function t(e){_classCallCheck(this,t);var p=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return p.getButtonMousePos=function(e){return function(){p.setState({stepHover:e})}},p.getThemePropsByType=function(e){var t=p.state,r=t.stepHover,o=t.value,n=p.props,a=n.size,i=n.getPartOfThemeProps,s=n.max,l=n.min,u=n.disabled,c="container"===e?{disabled:u}:"plus"===e?{outRange:getOverMax(o,s)}:"minus"===e?{outRange:getBelowMin(o,l)}:{};return i("ArrowIconContainer",{props:Object.assign({size:a,hover:r},c)})},p.onBlur=function(e){var t=p.props,r=t.onBlur,o=t.min,n=t.max,a=p.state.value,i=(0,_Math.limit)(a,[o,n]);p.setValue(i,e),r&&r(e)},p.handleClick=function(t){return function(e){p.calculateValue(t,e)}},p.handleChange=function(e){var t=e.newValue;p.setValue(Number((0,_Math.checkNumber)(t+"")),e)},p.el=_react2.default.createRef(),p}return _inherits(t,_react.Component),_createClass(t,[{key:"getStepArrowIconContainer",value:function(e){var t=this.state.value,r=this.props,o=r.disabled,n=r.addIcon,a=r.subtractIcon,i=r.getPartOfThemeHocProps,s=r.createEventChannel,l=r.max,u=r.min,c=i("InputArrowIcon"),p=c.theme,d=c.viewClass,m=(0,_objectUtils.deepMerge)(_defineProperty({},d,{normal:{cursor:"pointer",fontSize:10,getCSS:function(){return" position: absolute;\n                       top: 50%;\n                       left: 50%;\n                       transform: translate(-50%, -50%);\n                       transition: all 0.3s;"},getThemeMeta:function(e,t){return{cursor:t.propsConfig.outRange?"not-allowed":"pointer"}}},hover:{getThemeMeta:function(e,t){return{cursor:t.propsConfig.outRange?"not-allowed":"pointer"}}},active:{getThemeMeta:function(e,t){var r=t.propsConfig,o=r.outRange,n=r.disabled;return{cursor:o||n?"not-allowed":"pointer"}}},disabled:{cursor:"not-allowed",fontSize:10,opacity:0}}),p),h=this.getThemePropsByType("container"),f=this.getThemePropsByType("plus"),_=this.getThemePropsByType("minus"),g=s(["hover"]),v=s(["hover"]);return _react2.default.createElement(ArrowIconContainer,Object.assign({disabled:o,themeProps:h},e.provider,{lugiaConsumers:g.consumer},this.props.dispatchEvent(["hover","disabled"],"f2c")),_react2.default.createElement(PlusButton,Object.assign({},g.provider,{disabled:o,themeProps:f,onClick:this.handleClick("plus")},(0,_themeHoc.addMouseEvent)(this,{enter:this.getButtonMousePos("plus"),leave:this.getButtonMousePos("no")})),_react2.default.createElement(_index4.default,{lugiaConsumers:g.consumer,onClick:this.handleClick("plus"),theme:m,viewClass:d,disabled:o,propsConfig:{outRange:getOverMax(t,l)},iconClass:n||PlusClass,singleTheme:!0})),_react2.default.createElement(MinusButton,Object.assign({},v.provider,{disabled:o,themeProps:_,onClick:this.handleClick("minus")},(0,_themeHoc.addMouseEvent)(this,{enter:this.getButtonMousePos("minus"),leave:this.getButtonMousePos("no")})),_react2.default.createElement(_index4.default,{lugiaConsumers:v.consumer,singleTheme:!0,onClick:this.handleClick("minus"),theme:m,viewClass:d,disabled:o,propsConfig:{outRange:getBelowMin(t,u)},iconClass:a||MinusClass})))}},{key:"render",value:function(){var e=this.state.value,t=this.props,r=t.createEventChannel,o=t.getPartOfThemeHocProps,n=t.getPartOfThemeProps,a=t.validateStatus,i=o("Input").theme,s=n("ValidateErrorText"),l=(0,_validateHoc3.isValidateError)(a)?(0,_objectUtils.deepMerge)(_validateHoc3.validateValueDefaultTheme,_validateHoc3.validateBorderDefaultTheme,s):{},u=n("Container"),c=(0,_objectUtils.deepMerge)(_defineProperty({},_consts2.default.Input,{InputSuffix:{normal:{getCSS:function(){return"height:100%;opacity: 0;transition: all 0.3s;right:0;"}},hover:{getCSS:function(){return"opacity: 1;"}}}}),i,u,l),p=r(["hover"]);return _react2.default.createElement(_index2.default,Object.assign({isValidate:!1,lugiaConsumers:p.consumer,theme:c,ref:this.el},this.props,{value:e,suffix:this.getStepArrowIconContainer(p),onBlur:this.onBlur,onChange:this.handleChange}))}},{key:"setValue",value:function(e,t){var r=this.state.value,o=this.props,n=o.disabled,a=o.onChange,i={newValue:e,oldValue:r,event:t};if(!1===hasValueProps(this.props)){if(n)return;this.setState({value:e},function(){a&&a(i)})}else a&&a(i)}},{key:"calculateValue",value:function(e,t){var r=this.props.precision,o=this.state.value,n=this.props,a=n.step,i=n.min,s=n.max;o=Number(o),a="plus"===e?Number(a):-1*a;var l=(0,_Math.accAdd)(o,a,r);this.setValue((0,_Math.limit)(l,[i,s]),t)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.value,o=e.defaultValue,n=e.disabled,a=hasValueProps(e),i="disabled"in e;if(!t){var s=e.min,l=e.max;return{value:a?r:o?(0,_Math.limit)(o,[s,l]):"",disabled:i&&n,stepHover:"no"}}if(a)return{value:r}}}]),t}();NumberTextBox.defaultProps={disabled:!1,max:1/0,min:-1/0,viewClass:_consts2.default.NumberInput,validateStatus:"default",validateType:"top",size:"default",precision:0,step:1,formatter:function(e){return e},parser:function(e){return e}},NumberTextBox.displayName=_consts2.default.NumberInput;var TargetNumberInput=(0,_themeHoc2.default)((0,_validateHoc2.default)((0,_KeyBoardEventAdaptor2.default)(NumberTextBox)),_consts2.default.NumberInput,{hover:!0,active:!0});exports.default=TargetNumberInput;