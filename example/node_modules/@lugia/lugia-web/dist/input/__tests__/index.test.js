"use strict";var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_=require("../"),_2=_interopRequireDefault(_),_theme=require("../../theme"),_theme2=_interopRequireDefault(_theme),_reactTestRenderer=require("react-test-renderer"),_reactTestRenderer2=_interopRequireDefault(_reactTestRenderer),_chai=require("chai"),_chai2=_interopRequireDefault(_chai);require("jest-styled-components");var _InputTestUtils=require("./InputTestUtils"),_enzyme=require("enzyme"),_enzyme2=_interopRequireDefault(_enzyme),_enzymeAdapterReact=require("enzyme-adapter-react-16"),_enzymeAdapterReact2=_interopRequireDefault(_enzymeAdapterReact),_consts=require("../../consts"),_consts2=_interopRequireDefault(_consts),_demo=require("../demo");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(u,o){return function t(e,r){try{var n=i[e](r),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});u(a)}("next")})}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_enzyme2.default.configure({adapter:new _enzymeAdapterReact2.default});var exp=_chai2.default.expect,_require=require("@lugia/jverify"),mockFunction=_require.mockFunction,VerifyOrder=_require.VerifyOrder,VerifyOrderConfig=_require.VerifyOrderConfig,LimitInputBox=function(){function o(){var e,t,r;_classCallCheck(this,o);for(var n=arguments.length,a=Array(n),u=0;u<n;u++)a[u]=arguments[u];return(t=r=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(a)))).onChange=function(e){var t=e.newValue;r.setState({value:t})},_possibleConstructorReturn(r,t)}return _inherits(o,_react2.default.Component),_createClass(o,[{key:"render",value:function(){return _react2.default.createElement(_2.default,{value:this.state.value,onChange:this.onChange})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t?{}:{value:e.value}}}]),o}();describe("Input",function(){var n=void 0,i=void 0;function e(e,a,n,u,o){it("props: onchange "+e+" ",function(){var e=VerifyOrder.create(),t=(i=mockFunction.create(VerifyOrderConfig.create("onChange",e))).getFunction(),r=(0,_enzyme.mount)(_react2.default.createElement(_2.default,Object.assign({},a,{onChange:t})));n&&n.forEach(function(e,t){r.find("input").simulate("change",{target:{value:e}}),(0,_InputTestUtils.assertInputValue)(r,u[t])}),e.verify(function(e){var n=e.onChange;o&&o.forEach(function(e,t){var r=a.value;n({newValue:e,oldValue:u[t-1]?u[t-1]:r||"",event:VerifyOrder.Any})})})})}function t(e){it("props: size",function(){expect(_reactTestRenderer2.default.create(_react2.default.createElement(_2.default,{size:e})).toJSON()).toMatchSnapshot()})}function r(r){it("props: placeholder ",function(){var e=_react2.default.createElement(_2.default,{placeholder:r}),t=(0,_enzyme.mount)(e);expect(_reactTestRenderer2.default.create(e).toJSON()).toMatchSnapshot(),exp(t.props().placeholder).to.be.equal(r)})}beforeEach(function(){n=VerifyOrder.create(),i=mockFunction.create(VerifyOrderConfig.create("onChange",n)),i.getFunction()}),it("props: null",function(){expect(_reactTestRenderer2.default.create(_react2.default.createElement(_2.default,null)).toJSON()).toMatchSnapshot()}),t("small"),t("large"),r("请填写内容"),r(""),it("props: getTheme: width:100,margin:10,",function(){var e=_defineProperty({},_consts2.default.Input,{width:100,margin:10}),t=_react2.default.createElement(_theme2.default,{config:e},_react2.default.createElement(_2.default,null));expect(_reactTestRenderer2.default.create(t).toJSON()).toMatchSnapshot()}),it("props:disabled  onchange",_asyncToGenerator(_regenerator2.default.mark(function e(){var t,r,n,a;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){t++},n=(t=0,_enzyme.mount)(_react2.default.createElement(_2.default,{disabled:!0,onChange:r},"hello")),(a=n.find("input").at(0)).simulate("change"),expect(t).toBe(0),a.simulate("change"),expect(t).toBe(0);case 8:case"end":return e.stop()}},e,void 0)}))),it("props: prefix",function(){var e="hello ligx",t=_react2.default.createElement("div",{className:"prefix"},e),r=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{prefix:t}));exp(r.find(".prefix").text()).to.be.equal(e)}),it("props: suffix",function(){var e="hello suffix",t=_react2.default.createElement("div",{className:"suffix"},e),r=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{suffix:t}));exp(r.find(".suffix").text()).to.be.equal(e)}),it("props: prefix&suffix",function(){var e="hello ligx",t="hello kxy",r=_react2.default.createElement("div",{className:"prefix"},e),n=_react2.default.createElement("div",{className:"suffix"},t),a=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{prefix:r,suffix:n}));exp(a.find(".prefix").text()).to.be.equal(e),exp(a.find(".suffix").text()).to.be.equal(t)}),it("props: value",function(){(0,_InputTestUtils.testPropsValue)("诸法为空","诸法为空")}),it("props: keyboard event is null but fire keyup event",function(){(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyUp",{keyCode:49,Target:_2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyDown",{keyCode:49,Target:_2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onKeyPress",{keyCode:49,Target:_2.default}),(0,_InputTestUtils.testFireNullKeyBoardEvent)("onFocus",{keyCode:49,Target:_2.default})}),it("props: onKeyUp",function(){(0,_InputTestUtils.testKeyBoardEvent)(n,"onKeyUp",{keyCode:49,Target:_2.default})}),it("props: onKeyPress",function(){(0,_InputTestUtils.testKeyBoardEvent)(n,"onKeyPress",{keyCode:49,Target:_2.default})}),it("props: onKeyDown",function(){(0,_InputTestUtils.testKeyBoardEvent)(n,"onKeyDown",{keyCode:49,Target:_2.default})}),it("props: onFocus",function(){(0,_InputTestUtils.testKeyBoardEvent)(n,"onFocus",{keyCode:49,Target:_2.default})}),it("props: onBlur",function(){(0,_InputTestUtils.testKeyBoardEvent)(n,"onBlur",{keyCode:49,Target:_2.default})}),it("props: onEnter Fired",function(){var e=mockFunction.create(VerifyOrderConfig.create("onEnter",n)),t={keyCode:13};e.mock(function(e){var t=e.keyCode;exp(t).to.be.equal(t)});var r={onEnter:e.getFunction()};(0,_enzyme.mount)(_react2.default.createElement(_2.default,r)).find("input").simulate("onKeyDown".substr(2).toLowerCase(),t),n.verify(function(e){e.onEnter(VerifyOrder.Object)})}),it("props: onEnter Not Fired",function(){var e={keyCode:44},t={onEnter:mockFunction.create(VerifyOrderConfig.create("onEnter",n)).getFunction()};(0,_enzyme.mount)(_react2.default.createElement(_2.default,t)).find("input").simulate("onKeyDown".substr(2).toLowerCase(),e),n.verify(function(e){})}),it("props: null  Fired Enter",function(){var e={keyCode:13};(0,_enzyme.mount)(_react2.default.createElement(_2.default,null)).find("input").simulate("onKeyDown".substr(2).toLowerCase(),e)}),it("props: value changed Limited Input changed",function(){var e="hello ligx",t=(0,_enzyme.mount)(_react2.default.createElement(LimitInputBox,{value:"诸行无常"}));(0,_InputTestUtils.assertInputValue)(t,"诸行无常"),t.find("input").simulate("change",{target:{value:e}}),(0,_InputTestUtils.assertInputValue)(t,e)}),it("props: value changed Limited Input no changed",function(){var e="诸行无常",t=(0,_enzyme.mount)(_react2.default.createElement(LimitInputBox,{value:e}));(0,_InputTestUtils.assertInputValue)(t,e),t.setProps({value:"hello ligx"}),(0,_InputTestUtils.assertInputValue)(t,e)}),it("props: defaultValue",function(){var e="hello ligx",t=(_inherits(r,_react2.default.Component),_createClass(r,[{key:"render",value:function(){return _react2.default.createElement(_2.default,{defaultValue:this.props.defaultValue})}}]),r);function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}var n=(0,_enzyme.mount)(_react2.default.createElement(t,{defaultValue:"诸行无常"}));(0,_InputTestUtils.assertInputValue)(n,"诸行无常"),n.find("input").simulate("change",{target:{value:e}}),(0,_InputTestUtils.assertInputValue)(n,e)}),it("props: defaultValue & value",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{defaultValue:"诸行无常",value:"诸法无我"}));(0,_InputTestUtils.assertInputValue)(e,"诸法无我")}),it("props: value changed Limited Input changed for prefix: Icon",function(){var e="hello ligx",t=(0,_enzyme.mount)(_react2.default.createElement(LimitInputBox,{value:"诸行无常",prefix:_react2.default.createElement("div",null,"hello")})),r=t.find("input").at(0);(0,_InputTestUtils.assertInputValue)(t,"诸行无常"),r.find("input").simulate("change",{target:{value:e}}),(0,_InputTestUtils.assertInputValue)(t,e)}),it("props: value changed Limited Input no changed  for prefix: Icon",function(){var e="诸行无常",t=(0,_enzyme.mount)(_react2.default.createElement(LimitInputBox,{value:e,prefix:_react2.default.createElement("div",null,"hello")}));(0,_InputTestUtils.assertInputValue)(t,e),t.setProps({value:"hello ligx"}),(0,_InputTestUtils.assertInputValue)(t,e)});function a(e){return e.replace(/\$\s?|(,*)/g,"")}function u(e){return("$"+e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function o(e){return e}function l(e,t,r){it(" props :validateStatus  "+e+"  &&  valiedateType top ;",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_demo.TopInput,{validateType:"top",onChange:function(){}}));e.find("input").at(0).simulate("change",{target:{value:t}}),e.find("input").at(0).simulate("blur"),expect(e.state().validateStatus).toBe(r)})}function s(e,t,r,n){it(" props :validateStatus  "+e+"  &&  valiedateType "+t+" ;",function(){var e=(0,_enzyme.mount)(_react2.default.createElement(_demo.ValidateInput,{validateType:t,onChange:function(){}}));e.find("input").at(0).simulate("change",{target:{value:r}}),expect(e.find(_consts2.default.Input).props().validateStatus).toBe(n)})}e('twice ["a", "b"] ',{},["a","b"],["a","b"],["a","b"]),e("props: onchange formatter&&parser both is null ",{formatter:o,parser:o},["1234567"],["1234567"],["1234567"]),e("props: onchange parser:null ",{formatter:u,parser:o},["1234567"],["$1,234,567"],["1234567"]),e("props: onchange formatter:null ",{formatter:o,parser:a},["1234567"],["1234567"],["1234567"]),e("props: onchange formatter&&parser ",{formatter:u,parser:a},["1234567"],["$1,234,567"],["1234567"]),l('value :""',"","success"),l('value :"111a1111"',"111a1111","error"),l('value :"a"',"a","error"),l('value :"aaa"',"aaa","error"),s('value :""',"bottom","","success"),s('value :"111"',"bottom","111","success"),s('value :"111a1"',"bottom","111a1","error"),s('value :"a"',"bottom","a","error"),s('value :"a"',"bottom","aaa","error"),s('value :""',"inner","","success"),s('value :"1111"',"inner","111","success"),s('value :"111a11"',"inner","111a1","error"),s('value :"a"',"inner","a","error"),s('value :"aaaa"',"inner","aaa","error"),it("props: readOnly true",function(){var e="诸行无常",t=(0,_enzyme.mount)(_react2.default.createElement(_2.default,{value:e,readOnly:!0}));(0,_InputTestUtils.assertInputValue)(t,e),t.find("input").simulate("change",{target:{value:"hello ligx"}}),(0,_InputTestUtils.assertInputValue)(t,e)})});