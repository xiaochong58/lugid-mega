"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_DragLine=require("./DragLine"),_DragLine2=_interopRequireDefault(_DragLine),_DragPiece=require("./DragPiece"),_DragPiece2=_interopRequireDefault(_DragPiece),_initialState=require("../initialState"),_event=require("../function/event"),_utils=require("../function/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Four=function(){function e(){_classCallCheck(this,e);var M=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return M.getScaleDirections=function(){var e=M.props,t=e.isLock,i=e.lockDirection;if(t&&i){if("left"===i)return{borders:["right"],pieces:[]};if("right"===i)return{borders:["left"],pieces:[]}}return{borders:[].concat(_toConsumableArray(_initialState.directions)),pieces:[].concat(_toConsumableArray(_initialState.directions))}},M.getChildren=function(t,e){return Array.isArray(e)&&0!==e.length?e.map(function(e){return _react2.default.createElement(t,Object.assign({},M.props,M.state,{direction:e,onMouseDown:M.onMouseDown,onMouseEnter:M.onMouseEnterArea,onMouseLeave:M.onMouseLeaveArea,onMouseMove:M.onMouseMove,onMouseUp:M.onMouseUp}))}):[]},M.onMouseDown=function(e,t,n){var i=M.props,o=i.width,r=i.height,a=i.x,s=i.y,u=i.maxX,c=i.maxY,l=i.maxWidth,h=i.maxHeight,p=i.minWidth,f=i.minHeight;M.propsSize={width:o,height:r},M.propsXY={x:a,y:s},M.maxXY={maxX:u,maxY:c},M.downDirection=t;var g=M.isDownKey(t);M.setState(_defineProperty({},g,!0),function(){var e=(0,_utils.getLimitPosition)(Object.assign({},M.state,{width:o,height:r,x:a,y:s}),n,p,f,l,h),t=e.limitX,i=e.limitY;M.limitXY={limitX:t,limitY:i}});var m=e.clientX,d=e.clientY;M.onChangeSizeStart({x:a,y:s,width:o,height:r});var w=(0,_utils.getDownXY)({x:a,y:s,downX:m,downY:d,width:o,height:r,direction:n}),_=w.newX,v=w.newY;M.onMouseDownClient={downX:m,downY:d},M.sourceXY={sourceX:_,sourceY:v},M.isUp=!1,M.newDirection=n,M.sizes={width:o,height:r,x:a,y:s,direction:n}},M.onChangeSizeStart=function(e){var t=M.props.onChangeSizeStart;t&&t(Object.assign({},e))},M.onMouseMove=function(e,t){if(!M.isUp){var i=e.clientX,n=e.clientY,o=M.onMouseDownClient,r=o.downX,a=o.downY;if(i!==r||n!==a){var s=M.isDownKey(t);M.state[s]&&(M.throttle||(M.move=!0,M.throttle=!0,setTimeout(function(){M.getMove(i,n),M.throttle=!1},20)))}}},M.getMove=function(e,t){var i=M.props,n=i.mouseEvent,o=i.minWidth,r=i.minHeight,a=i.maxWidth,s=i.maxHeight,u=M.propsXY,c=u.x,l=u.y,h=M.propsSize,p=h.width,f=h.height,g=M.maxXY,m=g.maxX,d=g.maxY,w=M.limitXY,_=w.limitX,v=w.limitY,y=(0,_utils.getXY)(Object.assign({},M.state,{maxX:m,maxY:d}),M.newDirection,_,v,e,t),D=y.x,b=y.y,x=(0,_event.onMouseMoveEvent)({clientX:D,clientY:b},Object.assign({},M.state),M.sourceXY,M.newDirection,c,l,p,f,{minWidth:o,minHeight:r,maxWidth:a,maxHeight:s});M.sizes=Object.assign({},x,{isTransition:!1}),n.emit("border_move",M.sizes);var X=M.props.onChangeSize,Y=x.width,C=x.height;X&&X({x:c,y:l,width:Y,height:C})},M.onMouseUp=function(){M.isUp=!0;var e=M.props.mouseEvent,t=M.downDirection,i=M.isDownKey(t),n=M.state[i];M.resetDownState(),!n||M.move?(n||M.move)&&(e.emit("border_up",M.sizes),M.exportOnChangeSizeEnd(),M.move=!1):M.exportOnChangeSizeEnd()},M.exportOnChangeSizeEnd=function(){var e=M.props.onChangeSizeEnd;if(e){var t=M.sizes,i=t.width,n=t.height;e({x:t.x,y:t.y,width:i,height:n})}},M.resetDownState=function(){M.setState({topIsDown:!1,rightIsDown:!1,bottomIsDown:!1,leftIsDown:!1})},M.isDownKey=function(e){return e+"IsDown"},M.state={topIsDown:!1,rightIsDown:!1,bottomIsDown:!1,leftIsDown:!1},M.onMouseDownClient={downX:0,downY:0},M.sizes={},M.throttle=!1,M.isUp=!0,M.move=!1,M.limitXY={limitX:0,limitY:0},M.propsSize={},M.propsXY={},M.maxXY={},M}return _inherits(e,_react2.default.Component),_createClass(e,[{key:"render",value:function(){var e=this.getScaleDirections(),t=e.borders,i=e.pieces;return[].concat(_toConsumableArray(this.getChildren(_DragLine2.default,t)),_toConsumableArray(this.getChildren(_DragPiece2.default,i)))}}]),e}();exports.default=Four;