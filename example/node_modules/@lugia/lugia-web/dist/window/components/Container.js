"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_listener=require("@lugia/listener"),_listener2=_interopRequireDefault(_listener),_Window=require("./Window"),_Window2=_interopRequireDefault(_Window),_initialState=require("../initialState"),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_styled=require("../styled"),_utils=require("../function/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Container=function(){function s(e){_classCallCheck(this,s);var t=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));_initialiseProps.call(t);var o=e.defaultIsLock,n=void 0!==o&&o,i=e.isLock,r=e.lockDirection,a=void 0===r?"":r;t.dom=document.createElement("div");var c=i||n;return t.state={isLock:c,lockDirection:c?a:"",isShowSide:!1},t.mouseEvents=new _listener2.default,t}return _inherits(s,_react2.default.Component),_createClass(s,[{key:"componentDidMount",value:function(){document.body&&document.body.appendChild(this.dom);var e=this.props.z;e=e||this.getMaxZindex(),this.mouseEvents.emit("upDate_zIndex",{z:e})}},{key:"render",value:function(){return this.getComponent()}}]),s}();Container.displayName="WindowContainer",Container.defaultProps={middle:!0};var _initialiseProps=function(){var b=this;this.onOpen=function(e){var t=e.lockDirection,o=b.props,n=o.lockingWay,i=o.onOpen,r=(0,_utils.getLockingWay)(n).isDrag;b.setState({isLock:r,lockDirection:t}),i&&i({lockDirection:t,isLock:r})},this.onDragStart=function(e){var t=e.lockDirection;b.lockDirection=t;var o=b.props.onDragStart;o&&o(Object.assign({},e))},this.onDrag=function(e){var t=e.lockDirection;b.lockDirection=t;var o=e.x,n=e.y,i=e.clientX,r=e.clientY,a=e.sideZIndex,c=b.props,s=c.onDrag,l=c.lockingWay,u=(0,_utils.getLockingWay)(l).isDrag;s&&s({left:o,top:n,clientX:i,clientY:r});var d=!!t&&u;b.setState({lockDirection:t,isShowSide:d,sideZIndex:a})},this.onDragEnd=function(e){var t=b.getEndState().isLock,o=e.width,n=e.height,i=e.lockDirection,r=e.sizeZIndex,a=e.isUpdata,c=e.x,s=e.y;a&&b.setState({isLock:t,isShowSide:!1,width:o,height:n,sizeZIndex:r});var l=b.props.onDragEnd;l&&l({x:c,y:s,lockDirection:i,isLock:t})},this.getEndState=function(){var e=b.props.lockingWay,t=!1;return(0,_utils.getLockingWay)(e).isDrag&&b.lockDirection&&(t=!0),{isLock:t}},this.getMaxZindex=function(){var e=document.body&&document.body.getElementsByTagName&&document.body.getElementsByTagName("*");if(!e)return 0;for(var t=e.length,o=[],n=0;n<t;n+=1){var i=e[n],r=window.getComputedStyle(i,null).zIndex;"auto"!==r&&o.push(r)}return 0===o.length?0:Math.max.apply(Math,o)},this.onChangeLock=function(e){var t=e.isLock,o=b.props,n=o.onChangeLock,i=o.lockingWay,r=(0,_utils.getLockingWay)(i).isClick;n&&r&&n({isLock:t}),b.setState({isLock:t})},this.onClose=function(){var e=b.props.onClose;e&&e()},this.hasOnClose=function(){var e=b.props.onClose;return e&&"function"==typeof e},this.getComponent=function(){var e=b.state,t=e.isLock,o=e.lockDirection,n=e.isShowSide,i=e.sideZIndex,r=_initialState.minSize.minWidth,a=_initialState.minSize.minHeight,c=b.props,s=c.lockingWay,l=c.lockTop,u=void 0===l?0:l,d=c.lockBottom,p=void 0===d?0:d,f=c.minWidth,g=void 0===f?r:f,_=c.minHeight,h=void 0===_?a:_,k=c.isLock,m=c.visible,v=void 0===m||m,y=c.autoLevel,D=b.hasOnClose(),C=Object.assign({},b.props,{lockTop:u,lockBottom:p,minWidth:g,minHeight:h,onChangeLock:b.onChangeLock,mouseEvents:b.mouseEvents,isLock:t,propsIsLock:k,hasClose:D,lockDirection:o,onDragStart:b.onDragStart,onDrag:b.onDrag,onDragEnd:b.onDragEnd,onClose:b.onClose,onOpen:b.onOpen,autoLevel:y});if(!v)return null;var S=(0,_utils.getLockingWay)(s).isClick;return t&&S?(b.mouseEvents.emit("render_intoState",{isInto:!0}),_react2.default.createElement(_Window2.default,C)):_reactDom2.default.createPortal(_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_Window2.default,Object.assign({},C,{dom:b.dom})),_react2.default.createElement(_styled.Edge,{lockDirection:o,isShowSide:n&&o,sideZIndex:i,lockTop:u,lockBottom:p})),b.dom)}};(exports.default=Container).defaultProps={middle:!0};