"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp,_initialiseProps,_createClass=function(){function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}}(),_templateObject=_taggedTemplateLiteral(["\n        .rc-table th,\n        .rc-table td {\n          padding: 0 ","px;\n        }\n\n        ","\n      "],["\n        .rc-table th,\n        .rc-table td {\n          padding: 0 ","px;\n        }\n\n        ","\n      "]),_react=require("react"),React=_interopRequireWildcard(_react),_themeCssHoc=require("@lugia/theme-css-hoc"),_themeCssHoc2=_interopRequireDefault(_themeCssHoc),_themeProvider=require("../theme-provider"),_themeProvider2=_interopRequireDefault(_themeProvider),_index=require("../consts/index"),_index2=_interopRequireDefault(_index),_rcTable=require("rc-table"),_rcTable2=_interopRequireDefault(_rcTable),_checkbox=require("../checkbox"),_checkbox2=_interopRequireDefault(_checkbox);require("rc-table/assets/index.css"),require("./style/lugia-table.css");var _styledComponents=require("styled-components");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var sizePadding={default:8,small:4,large:16},sizeHeight={default:32,small:24,large:40},TableWrap=(0,_themeCssHoc2.default)({tag:"div",className:"TableWrap",normal:{selectNames:[["width"],["height"]],getCSS:function(e,t){var r=e.background,a=(r=void 0===r?{}:r).color,n=t.propsConfig,o=(n=void 0===n?{}:n).size,i=sizePadding[void 0===o?"default":o]||sizePadding.default,s=void 0;return a&&(s="tbody .rc-table-cell {\n          background: "+a+";\n        }"),(0,_styledComponents.css)(_templateObject,i,a?s:"")}}});exports.default=(0,_themeProvider2.default)((_temp=_class=function(){function u(e){_classCallCheck(this,u);var t=_possibleConstructorReturn(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));_initialiseProps.call(t);var r=e.data,a=void 0===r?[]:r,n=e.selectOptions,o=(n=void 0===n?{}:n).selectRowKeys,i=void 0===o?[]:o,s=e.scroll,l=void 0===s?{}:s,c=a.length,d=i.length;return t.state={headChecked:c===d&&0<c,headIndeterminate:!!d,selectRowKeys:i||[],scroll:l},t.tableWrap=React.createRef(),t}return _inherits(u,React.Component),_createClass(u,[{key:"componentDidMount",value:function(){var a=this;setTimeout(function(){var e=((0,a.props.getPartOfThemeConfig)("Container")||{}).normal,t=(e=void 0===e?{}:e).height,r=a.tableWrap.querySelector(".rc-table");r&&t<r.offsetHeight-5?a.setState({scroll:a.getTableBodyHeight(t)}):a.setState({scroll:{}})},0)}},{key:"filterKey",value:function(e,t){return e.filter(function(e){return t(e)})}},{key:"render",value:function(){var o=this,e=this.props,t=e.children,r=e.columns,a=void 0===r?[]:r,n=e.data,i=e.showHeader,s=void 0===i||i,l=e.tableStyle,c=void 0===l?"bordered":l,d=e.getPartOfThemeProps,u=e.selectOptions,h=void 0===u?{}:u,f=e.size,p=void 0===f?"default":f;this.selectedRecords=[],this.validKeys=[],this.disabledSelectedKeys=[],this.validRecords=[],this.disabledSelectedRecords=[];var b=this.state,_=b.headChecked,m=b.headIndeterminate,v=b.selectRowKeys,y=b.scroll,g=void 0===y?{}:y,C=d("Container",{props:{size:p}});if(t)return React.createElement(TableWrap,{themeProps:C,className:this.getClass(c,p),ref:function(e){o.tableWrap=e}},React.createElement(_rcTable2.default,Object.assign({},this.props,{data:n,showHeader:s,rowClassName:function(e,t){return"row-"+t},className:"table"}),t));var R=[].concat(_toConsumableArray(a));if("selectOptions"in this.props){var w=h.setCheckboxProps,k=void 0===w?function(e){return{}}:w,O=h.width,P=void 0===O?60:O,x=_defineProperty({title:React.createElement("div",{style:{fontSize:0}},React.createElement(_checkbox2.default,{checked:_,indeterminate:m,onChange:this.tableHeadChange})),className:"lugia-select-column",key:"selection-column",width:P,render:function(e,t){var r=t.key,a=v.includes(r),n=k(t)||{};return a&&(o.selectedRecords.push(t),n.disabled&&(o.disabledSelectedKeys.push(r),o.disabledSelectedRecords.push(t))),n.disabled||(o.validKeys.push(r),o.validRecords.push(t)),React.createElement("div",{style:{fontSize:0}},React.createElement(_checkbox2.default,Object.assign({checked:a,onChange:o.tableItemChange(r,t)},n)))}},_rcTable.INTERNAL_COL_DEFINE,{className:"lugia-selection-col"});R.unshift(x)}var K=R&&R[0]&&"selection-column"===R[0].key?1:0;if("expandIconColumnIndex"in this.props){var T=this.props.expandIconColumnIndex;K=Number(T)}return React.createElement(TableWrap,{ref:function(e){o.tableWrap=e},themeProps:C,className:this.getClass(c,p)},React.createElement(_rcTable2.default,Object.assign({},this.props,{columns:R,data:n,showHeader:s,expandIconColumnIndex:K,scroll:g})))}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.data,r=e.selectOptions,a=void 0===r?{}:r;if("selectRowKeys"in a){for(var n=a.selectRowKeys,o=void 0===n?[]:n,i=a.setCheckboxProps,s=void 0===i?function(e){return{}}:i,l=t&&0<t.length,c=[],d=0;d<t.length;d++){var u=t[d],h=u.key;if(!(s(u)||{}).disabled)o.includes(h)?c.push(h):l=!1}return{headChecked:l,headIndeterminate:!!c.length,selectRowKeys:o}}return null}}]),u}(),_initialiseProps=function(){var d=this;this.tableItemChange=function(l,c){return function(){var e=d.props.selectOptions,t=void 0===e?{}:e,r=d.state.selectRowKeys,a=r.includes(l),n=a?d.filterKey(r,function(e){return e!==l}):[].concat(_toConsumableArray(r),[l]),o=a?d.filterKey(d.selectedRecords,function(e){return e.key!==l}):[].concat(_toConsumableArray(d.selectedRecords),[c]),i=t.onChange;if(i&&i(n,o),!("selectRowKeys"in t)){var s=d.filterKey(d.validKeys,function(e){return!n.includes(e)});d.setState({selectRowKeys:n,headIndeterminate:!!n.length,headChecked:!s.length})}}},this.getTableBodyHeight=function(e){var t=d.props,r=t.showHeader,a=void 0===r||r,n=t.size;if(!e)return{};var o=sizeHeight[void 0===n?"default":n],i=parseInt(e);return{y:a?i-o:i}},this.tableHeadChange=function(){var e=d.props.selectOptions,t=void 0===e?{}:e,r=d.state.headChecked,a=t.onChange,n=r?d.disabledSelectedKeys||[]:[].concat(_toConsumableArray(d.validKeys),_toConsumableArray(d.disabledSelectedKeys)),o=r?d.disabledSelectedRecords||[]:[].concat(_toConsumableArray(d.validRecords),_toConsumableArray(d.disabledSelectedRecords));a&&a(n,o),"selectRowKeys"in t||d.setState({selectRowKeys:n,headIndeterminate:!r,headChecked:!r})},this.getClass=function(e,t){return"lugia-table lugia-table-"+e+" "+("lugia-"+t+"-table")}},_temp),_index2.default.Table);