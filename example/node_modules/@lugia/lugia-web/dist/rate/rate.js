"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getIconClass=exports.getClassNames=exports.getClass=exports.multipleValue=exports.getMultiple=exports.calcValue=exports.createIconTypeArray=void 0;var _createClass=function(){function r(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}}(),_templateObject=_taggedTemplateLiteral(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"],["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"]),_templateObject2=_taggedTemplateLiteral(["\n    position: relative;\n    min-height: 20px;\n    white-space: nowrap;\n    display: inline-block;\n  "],["\n    position: relative;\n    min-height: 20px;\n    white-space: nowrap;\n    display: inline-block;\n  "]),_templateObject3=_taggedTemplateLiteral(["\n    position: relative;\n    display: inline-block;\n    vertical-align: middle;\n  "],["\n    position: relative;\n    display: inline-block;\n    vertical-align: middle;\n  "]),_templateObject4=_taggedTemplateLiteral(["\n    margin-right: 6px;\n    position: relative;\n    & > i.bottom {\n      position: absolute;\n      left: 0;\n      bottom: 0;\n      z-index: -1;\n    }\n    & > i {\n      vertical-align: text-bottom !important;\n    }\n  "],["\n    margin-right: 6px;\n    position: relative;\n    & > i.bottom {\n      position: absolute;\n      left: 0;\n      bottom: 0;\n      z-index: -1;\n    }\n    & > i {\n      vertical-align: text-bottom !important;\n    }\n  "]),_templateObject5=_taggedTemplateLiteral(["\n    position: relative;\n  "],["\n    position: relative;\n  "]),_templateObject6=_taggedTemplateLiteral(["\n    vertical-align: text-bottom !important;\n    cursor: pointer;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    &.half {\n      width: 50%;\n      overflow: hidden;\n    }\n  "],["\n    vertical-align: text-bottom !important;\n    cursor: pointer;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    &.half {\n      width: 50%;\n      overflow: hidden;\n    }\n  "]),_templateObject7=_taggedTemplateLiteral(["\n    vertical-align: text-bottom !important;\n    cursor: pointer;\n  "],["\n    vertical-align: text-bottom !important;\n    cursor: pointer;\n  "]),_templateObject8=_taggedTemplateLiteral(["\n                animation: "," 0.3s linear forwards;\n                transform: scale(1.2);\n              "],["\n                animation: "," 0.3s linear forwards;\n                transform: scale(1.2);\n              "]);exports.getDefaultClassNames=getDefaultClassNames,exports.getFontSize=getFontSize;var _react=require("react"),_react2=_interopRequireDefault(_react),_icon=require("../icon"),_icon2=_interopRequireDefault(_icon),_utils=require("../utils"),_typeUtils=require("@lugia/type-utils"),_NumberUtils=require("../common/NumberUtils"),_themeCssHoc=require("@lugia/theme-css-hoc"),_themeCssHoc2=_interopRequireDefault(_themeCssHoc),_objectUtils=require("@lugia/object-utils"),_stateColor=require("../css/stateColor"),_stateColor2=_interopRequireDefault(_stateColor);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var _colorsFunc=(0,_stateColor2.default)(),warningColor=_colorsFunc.warningColor,mediumGreyColor=_colorsFunc.mediumGreyColor,superLightColor=_colorsFunc.superLightColor,showUp=(0,_themeCssHoc.keyframes)(_templateObject),Container=(0,_themeCssHoc.StaticComponent)({tag:"div",className:"characterContainer",normal:{selectNames:[],defaultTheme:{fontSize:"18px"}},css:(0,_themeCssHoc.css)(_templateObject2)}),RateBox=(0,_themeCssHoc.StaticComponent)({tag:"div",className:"RateBox",normal:{selectNames:[["width"],["margin"],["height"],["padding"],["fontSize"]],getThemeMeta:function(e,t){return{fontSize:e.normal.fontSize||20}}},css:(0,_themeCssHoc.css)(_templateObject3)}),StarIconClass="lugia-icon-financial_star",StarIconClassOpen="lugia-icon-finacial_half_star",Ratespan=(0,_themeCssHoc2.default)({tag:"span",className:"starBox",normal:{selectNames:[["color"],["font"],["fontSize"],["margin"]],defaultTheme:{margin:{right:6}},getCSS:function(e,t){return"&:last-child { margin: 0 !important;}"}},css:(0,_themeCssHoc.css)(_templateObject4),option:{hover:!0}});Ratespan.displayName="sv_rate_Ratespan";var RateTextContainer=(0,_themeCssHoc2.default)({tag:"span",className:"RateTextContainer",normal:{selectNames:[]},css:(0,_themeCssHoc.css)(_templateObject5)}),RateText=(0,_themeCssHoc2.default)({tag:"span",className:"ActiveTextIcon",normal:{selectNames:[["color"]],defaultTheme:{color:superLightColor,fontSize:20}},disabled:{selectNames:[["color"]],defaultTheme:{color:"#ccc"}},css:(0,_themeCssHoc.css)(_templateObject6)}),RateTextBottom=(0,_themeCssHoc2.default)({tag:"span",className:"DefaultTextIcon",normal:{selectNames:[["color"],["fontSize"]],defaultTheme:{color:superLightColor,fontSize:20}},disabled:{selectNames:[["color"]],defaultTheme:{color:"#f2f2f2"}},css:(0,_themeCssHoc.css)(_templateObject7)});RateText.displayName="sv_rate_RateText";var defautClass={default:"default",primary:"primary",danger:"danger",amazed:"amazed",half:"half"};function getDefaultClassNames(e){return[].concat(_toConsumableArray(Array(e))).map(function(){return"default"})}function getFontSize(e,t,a){if(!t||!e)return 18;var r=a/2||18,n=(t-6*e)/e-10;return r<n?r:n}var createIconTypeArray=exports.createIconTypeArray=function(e,t){var a=getDefaultClassNames((0,_NumberUtils.toNumber)(e,0));if(!t)return a;var r=t.starNum,n=t.allowHalf,o=t.classify;if(n)return getClassNames(a,r,o);var l=Math.ceil(a.length/2),s=getClass(r,l,o);return a.map(function(e,t){return r-1<t||!r?"default":s})},calcValue=exports.calcValue=function(e,t){var a=0<arguments.length&&void 0!==e?e:0;return t?Math.floor(2*a)/2:Math.floor(a)},getMultiple=exports.getMultiple=function(e){if(!e)return 0;var t=e.max,a=e.count;return t?t/(void 0===a?5:a):1},multipleValue=exports.multipleValue=function(e,t){if(!e||0===t)return 0;var a=getMultiple(e);if(t)return t*a;var r=e.value,n=e.defaultValue;return(r||n||0)/a},getClass=exports.getClass=function(e,t,a){return a&&e!==t?e<t?"danger":"amazed":"primary"},getClassNames=exports.getClassNames=function(e,a,t){if(!e)return[];var r=Math.ceil(a-1),n=Math.ceil(e.length/2),o=getClass(a,n,t);return e.map(function(e,t){return r<t?"default":t===r&&a%1!=0?"half":o})},getIconClass=exports.getIconClass=function(e){var t=0<arguments.length&&void 0!==e?e:{},a=t.primary,r=t.danger,n=t.amazed,o=t.half,l=t.default;return{default:l||StarIconClass,primary:a||l||StarIconClass,danger:r||l||StarIconClass,amazed:n||l||StarIconClass,half:o||l||StarIconClassOpen}},getOffsetInfo=function(e){return e?{offsetLeft:(0,_utils.getElementPosition)(e).x,offsetWidth:e.offsetWidth}:{offsetLeft:0,offsetWidth:18}},isLeft=function(e,t,a){return a<e+t/2},getReturnObj=function(e,t){return{oldValue:e.value,newValue:0<=t?t:0}},loop=function(){return!0},getDefaultTheme=function(e,t,a){return e?_defineProperty({},e,t&&a?t[a]:{}):{}},Rate=function(){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return _initialiseProps.call(t),t}return _inherits(a,_react2.default.Component),_createClass(a,[{key:"componentDidMount",value:function(){this.saveState()}},{key:"saveState",value:function(){this.updateTemporary(this.state)}},{key:"updateTemporary",value:function(e){this.temporary=JSON.stringify(e)}},{key:"render",value:function(){var a=this,e=this.state,t=e.iconTypeArray,r=e.count,n=this.props.character;this.ratespan=[].concat(_toConsumableArray(Array(r))).map(function(){return _react2.default.createRef()});var o=_typeUtils.ObjectUtils.isString(n)?this.props.getPartOfThemeProps("DefaultTextIcon"):this.props.getPartOfThemeProps("DefaultRateIcon");return _react2.default.createElement(Container,{onMouseLeave:this.mouseLeave},_react2.default.createElement(RateBox,null,t.map(function(e,t){return _react2.default.createElement(Ratespan,{themeProps:o,ref:function(e){return a.ratespan[t]=e},onMouseMove:function(e){a.onMouseMove(e,t)},onClick:function(e){a.onClick(e,t)}},a.getElement(e,t))})))}},{key:"getOffset",value:function(e){var t=null;return this.ratespan[e]&&(t=this.ratespan[e]),getOffsetInfo(t)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=multipleValue(e),r=e.allowHalf,n={starNum:a,allowHalf:r,classify:e.classify},o=e.value,l=e.count,s=void 0===l?5:l,i=e.disabled,c=e.defaultValue,u=createIconTypeArray(s,n);if(!t)return{count:s,iconTypeArray:u,value:calcValue(o||c,r),starNum:a,current:0===o?null:a,hasClick:!1};if(!i){var p=t.hasClick,f=t.iconTypeArray;return p&&(f=u),{count:"value"in e?s:t.count,iconTypeArray:f,value:"value"in e?o:t.value,starNum:"value"in e?a:t.starNum,current:"current"in t?t.current:-1,hasClick:"hasClick"in t&&t.hasClick}}}}]),a}();Rate.defaultProps={disabled:!1,allowHalf:!1,classify:!1,onClick:loop,onChange:loop,iconClass:{default:StarIconClass,primary:StarIconClass,danger:StarIconClass,amazed:StarIconClass,half:StarIconClassOpen}};var _initialiseProps=function(){var _=this;this.getElement=function(e,t){var a=_.props,r=a.iconClass,n=a.disabled,o=a.character,l=getIconClass(r),s=defautClass[e]+"  iconCharacter "+(n?"":"hoverd");if(_typeUtils.ObjectUtils.isString(o)){var i=_.props.getPartOfThemeProps("DefaultTextIcon"),c=(0,_objectUtils.deepMerge)({themeConfig:{normal:{color:warningColor}}},i,_.props.getPartOfThemeProps("ActiveTextIcon")),u="default"!==e?c:(0,_objectUtils.deepMerge)(i,{themeConfig:{disabled:{color:"#e8e8e8"}}});return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(RateTextContainer,{themeProps:u},_react2.default.createElement(RateText,{themeProps:u,type:e,disabled:n,character:o,className:s},o),_react2.default.createElement(RateTextBottom,{themeProps:i,type:e,disabled:n,character:o,className:s},o)))}return _react2.default.createElement(_react2.default.Fragment,null,_.getRateIcon(e,l),_.getRateIcon("bottom",l))},this.onClick=function(e,t){if(!_.props.disabled){var a=_.getOffset(t),r=a.offsetLeft,n=a.offsetWidth,o=_.getStarCount(t,r,n,e.pageX),l=_.state,s=l.iconTypeArray,i=l.current,c=_.props.classify,u=getClassNames(s,o,!!c);_.handleClick(e,o,u,i)}},this.handleClick=function(e,t,a,r){var n=!0,o=a,l=t,s=_.props;if(l===r){var i=s.allowHalf;t=calcValue(0,i),n=!(l=-1),o=getDefaultClassNames(a.length),_.updateTemporary(null)}var c={value:t*getMultiple(s),starNum:t,iconTypeArray:o,current:l,hasClick:!1};"value"in s&&(c.hasClick=n),_.setValue(c,!0);var u=s.onClick;u&&u(getReturnObj(_.state,multipleValue(s,t)))},this.onMouseMove=function(e,t){if(!_.props.disabled){var a=_.getOffset(t),r=a.offsetLeft,n=a.offsetWidth,o=_.getStarCount(t,r,n,e.pageX),l=_.props.classify,s=_.state,i=s.iconTypeArray,c=s.current,u=getClassNames(i,o,!!l),p=_.state.hasClick,f={value:o*getMultiple(_.props),starNum:o,iconTypeArray:u,current:c,hasClick:p};_.setValue(f),_.doExportChange(getReturnObj(_.state,multipleValue(_.props,o)))}},this.getStarCount=function(e,t,a,r){var n=_.props.allowHalf;return n&&isLeft(t,a,r)?calcValue(e+.5,n):calcValue(e+1,n)},this.mouseLeave=function(e){var t=_.props;if(!t.disabled){var a=_.state.current,r=_.getTemporary();if(r){var n=r.value,o=r.iconTypeArray,l=r.starNum,s=r.current,i={value:n,starNum:l,iconTypeArray:o,current:s};return _.setValue(i),void _.doExportChange(getReturnObj(_.state,multipleValue(t,s)))}var c=t.count,u={value:0,starNum:0,iconTypeArray:createIconTypeArray(void 0===c?5:c),current:a};_.setValue(u),_.doExportChange(getReturnObj(_.state,multipleValue(t,0)))}},this.getTemporary=function(){return _.temporary?JSON.parse(_.temporary):null},this.doExportChange=function(e){var t=_.props,a=t.onChange;t.disabled||a&&a(e)},this.setValue=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];_.setState(Object.assign({},e),function(){t&&(_.saveState(),_.setState({hasClick:!1}))})},this.getRateIcon=function(e,t){var a=_.props.disabled,r=defautClass[e]+"  "+(a?"":"hoverd"),n=_.getIconThemeProps(e),o=n.theme,l=n.viewClass,s=n.markClassName;return"bottom"===e?_react2.default.createElement(_icon2.default,{singleTheme:!0,theme:o,viewClass:l,type:"default",disabled:a,iconClass:t.default+" "+s+"  default iconCharacter "}):_react2.default.createElement(_icon2.default,{singleTheme:!0,theme:o,viewClass:l,type:e,disabled:a,iconClass:t[e]+" "+r+" "+s+" iconCharacter "})},this.getIconThemeProps=function(e){var t=void 0,a=void 0,r=void 0,n=_.props.getPartOfThemeHocProps("DefaultRateIcon"),o=n.viewClass,l=n.theme;switch(e){case"amazed":var s=_.props.getPartOfThemeHocProps("AmazedIcon"),i=s.viewClass,c=s.theme;t=(0,_objectUtils.deepMerge)(getDefaultTheme(i,l,o),_defineProperty({},i,{normal:{color:"#f88e30"}}),c),a=i,r="AmazedIcon";break;case"danger":var u=_.props.getPartOfThemeHocProps("DangerIcon"),p=u.viewClass,f=u.theme;t=(0,_objectUtils.deepMerge)(getDefaultTheme(p,l,o),_defineProperty({},p,{normal:{color:mediumGreyColor}}),f),a=p,r="DangerIcon";break;case"half":case"primary":var m=_.props.getPartOfThemeHocProps("ActiveIcon"),d=m.viewClass,h=m.theme;t=(0,_objectUtils.deepMerge)(getDefaultTheme(d,l,o),_defineProperty({},d,{normal:{color:warningColor}}),h),a=d,r="ActiveIcon";break;case"bottom":default:var g=_defineProperty({},a=o,{normal:{color:superLightColor}});t=(0,_objectUtils.deepMerge)(g,l),r="DefaultRateIcon"}if("bottom"===e){var C=_defineProperty({},a,{normal:{getCSS:function(){return"              \n              vertical-align: text-bottom !important;\n              color:"+superLightColor+";\n              position: absolute;\n              left: 0;\n              bottom: 0;\n              z-index: -1;"}}});t=(0,_objectUtils.deepMerge)(C,t)}else{var v=_defineProperty({},a,{hover:{getCSS:function(e,t){return(0,_themeCssHoc.css)(_templateObject8,showUp)}}});t=(0,_objectUtils.deepMerge)(v,t)}return{theme:t=_.IconThemePropsFilter(t,a),viewClass:a,markClassName:r}},this.IconThemePropsFilter=function(e,t){return(0,_objectUtils.deepMerge)(e,_defineProperty({},t,{normal:{margin:0}}))}};exports.default=Rate;