"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getValueAndDisplayValue=exports.getDisplayValue=void 0,exports.default=translateData,exports.didUpdate=didUpdate,exports.getItems=getItems,exports.handleCreate=handleCreate,exports.updateMapData=updateMapData;var _react=require("react"),React=_interopRequireWildcard(_react),_props=require("../consts/props"),_FormFieldWidgetSupport=require("../common/FormFieldWidgetSupport"),_FormFieldWidgetSupport2=_interopRequireDefault(_FormFieldWidgetSupport);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}function _defineProperty(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function translateData(e,n,a){var t=e.data,r=void 0===t?[]:t,l=e.valueField,i=void 0===l?_props.ValueField:l,u=e.displayField,o=void 0===u?_props.DisplayField:u,d=toArray(e.value||e.defaultValue||a||[]);n=toArray(n);var p=[],s={},c=[],f={};return 0<r.length&&r.forEach(function(e){var a=e[i];p.push(a),s[a]=e}),n&&n.length&&d.length?(d.forEach(function(e,a){if(!s[e]){var t,r=n[a],l=(_defineProperty(t={},o,r||e),_defineProperty(t,i,e),t);c.push(l),f[e]=l}}),{cancelItem:c,cancelItemData:f,dataItem:s}):{dataItem:s}}function didUpdate(e,a,t,r,l){var n,i,u=toArray(t.props.displayValue),o=toArray(e.displayValue),d=toArray(t.props.value),p=toArray(e.value);return n=getEqualResult(u,o),i=getEqualResult(d,p),a.dataLength===t.state.dataLength&&e.data===t.props.data&&n&&i||updateMapData(e,r(e,a),l),!0}function getEqualResult(e,a){return Array.isArray(e)&&Array.isArray(a)?a.join(",")===e.join(","):a==e}function getItems(e){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],l=arguments[2],a=arguments[3];e=toArray(e);var n=[],i=[],t=l.props,u=t.displayField,o=void 0===u?_props.DisplayField:u;if(t.children)return{};if(0<e.length){var d=a.updateHanlder,p=a.needUpdate,s=void 0===p?function(e){return!1}:p,c=a.getMapData;e.forEach(function(e){s(e)&&updateMapData(l.props,l.state.displayValue,d);var a=c().dataItem[e];!a&&c().cancelItemData&&(a=c().cancelItemData[e]),n.push(a);var t=e;r&&(a&&a[o]&&(t=a[o]),i.push(t))})}return{items:n,displayValue:i}}function handleCreate(r,e,a){var t=r.props,l=t.children,n=t.data,i=void 0===n?[]:n,u=[];if(l)return renderChildren(r,e,a);function o(t){return function(e,a){u.push(r.getChildDom(e,t,{last:i.length+d.length===a+1}))}}var d=r.cancelItem;return d&&d.forEach(o(!0)),i&&i.forEach(o(!1)),u}function updateMapData(e){var a=arguments[2],t=translateData(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],arguments[3]),r=t.cancelItem,l=void 0===r?[]:r,n=t.cancelItemData,i=void 0===n?{}:n,u=t.dataItem;a({cancelItem:l,cancelItemData:i,dataItem:void 0===u?{}:u})}function renderChildren(l,n,i){var u=l.state.value;u=u||("radio"===n?"":[]);var e=l.props,a=e.children,o=e.disabled,d=e.styles,p=React.Children.count(a);return React.Children.map(a,function(e,a){if(React.isValidElement(e)){var t,r="onChangeForGroup";return"button"===i&&(r="onChange"),React.cloneElement(e,(_defineProperty(t={type:n},r,"radio"===n?l.handleChange()():l.handleChange()),_defineProperty(t,"checked","radio"===n?u===e.props.value:-1!==u.indexOf(e.props.value)),_defineProperty(t,"disabled",o||e.props.disabled),_defineProperty(t,"styles",d||e.props.styles),_defineProperty(t,"hasValue",l.hasValueProps()),_defineProperty(t,"last",p===a+1),t))}})}var getDisplayValue=exports.getDisplayValue=function(e,a){if(!e)return[];e=toArray(e);var t=a.cancelItemData,l=void 0===t?{}:t,r=a.dataItem,n=void 0===r?{}:r,i=a.displayField;return e.map(function(e){var a=getItem(n,e,i);if(a)return a;var t=getItem(l,e,i);if(t)return t;var r=l[e];return r?r[i]:e})};function getItem(e,a,t){var r=e[a];if(r)return r[t]}function toArray(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return e?_FormFieldWidgetSupport2.default.toArray(e):a}var getValueAndDisplayValue=exports.getValueAndDisplayValue=function(e,a){var t=null==a;a=a||{};var r="value"in e,l="displayValue"in e,n=e.value,i=e.defaultValue,u=e.displayValue,o=e.defaultDisplayValue,d=a.value,p=r?n:t?i:d,s=a.displayValue;p=toArray(p,null),u=toArray(u,null),s=toArray(s,null),o=toArray(o,null);var c={value:p,displayValue:l?u:t?o:s||void 0};return c.displayValue&&0===c.displayValue.length&&(c.displayValue=void 0),c};