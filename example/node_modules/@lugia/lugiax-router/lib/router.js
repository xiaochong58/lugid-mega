"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createRoute=createRoute,exports.createApp=createApp,exports.render=render,Object.defineProperty(exports,"go",{enumerable:!0,get:function(){return _go.default}}),Object.defineProperty(exports,"Link",{enumerable:!0,get:function(){return _Link.default}}),Object.defineProperty(exports,"Redirect",{enumerable:!0,get:function(){return _reactRouter.Redirect}}),Object.defineProperty(exports,"Route",{enumerable:!0,get:function(){return _reactRouter.Route}}),Object.defineProperty(exports,"StaticRouter",{enumerable:!0,get:function(){return _reactRouter.StaticRouter}}),Object.defineProperty(exports,"Switch",{enumerable:!0,get:function(){return _reactRouter.Switch}}),exports.LugiaxContext=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_reactDom=_interopRequireDefault(require("react-dom")),_react=_interopRequireWildcard(require("react")),_lugiax=_interopRequireDefault(require("@lugia/lugiax")),_go=_interopRequireWildcard(require("./go")),_Link=_interopRequireDefault(require("./Link")),_reactRouter=require("react-router"),_reactLoadable=_interopRequireDefault(require("react-loadable")),_Loading=_interopRequireDefault(require("./Loading"));function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_defineProperty2.default)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var WrapPageLoad=function(e,r){return function(t){function n(){return(0,_classCallCheck2.default)(this,n),(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(n).apply(this,arguments))}return(0,_inherits2.default)(n,t),(0,_createClass2.default)(n,[{key:"componentDidMount",value:function(){var e=r.onPageLoad;e&&e(this.props)}},{key:"componentWillUnmount",value:function(){var e=r.onPageUnLoad;e&&e(this.props)}},{key:"render",value:function(){return _react.default.createElement(e,this.props)}}]),n}(_react.default.Component)},WrapRedirect=function(e,r){var t=r.redirect;return function(r){var n=e;if(t){var o=t.to,a=t.verify;o&&a&&(n=function(){for(var r=a(),t=arguments.length,n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];return r?_react.default.createElement(e,n):_react.default.createElement(_reactRouter.Redirect,{to:o})})}return _react.default.createElement(n,r)}},LugiaxContext=_react.default.createContext({});exports.LugiaxContext=LugiaxContext;var createPowerComponent=function(e){var r=e.onPageLoad,t=e.onPageUnLoad,n=e.render,o=e.component,a=e.loading,u=e.redirect,i=function(e){return e=r||t?WrapPageLoad(e,{onPageLoad:r,onPageUnLoad:t,redirect:u}):e,u?WrapRedirect(e,{redirect:u}):e};return n?(0,_reactLoadable.default)({loader:function(){var e;return _regenerator.default.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,e=o){r.next=6;break}return r.next=5,_regenerator.default.awrap(n());case 5:e=r.sent;case 6:return r.abrupt("return",i(e.default));case 9:r.prev=9,r.t0=r.catch(0),console.error(r.t0);case 12:case"end":return r.stop()}},null,null,[[0,9]])},loading:a}):i(o)},PowerRouter=function(e){var r=e.PowerComponent,t=e.notVerify,n=e.Loading,o=e.verify,a=(0,_react.useContext)(LugiaxContext);return _react.default.createElement(_reactRouter.Route,(0,_extends2.default)({},e,{render:function(u){var i=u.location.pathname;if(o){if(!o({url:i}))return null}else if(!t){var c=a.onBeforeGo,l=a.verifyUrl;if(l){if(!l({url:i}))return null}else if(c){var f=(0,_react.lazy)(function(){return _regenerator.default.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_regenerator.default.awrap(c({url:i}));case 2:return e.abrupt("return",{default:r});case 3:case"end":return e.stop()}})});return _react.default.createElement(_react.Suspense,{fallback:_react.default.createElement(n,null)},_react.default.createElement(f,(0,_extends2.default)({},e,u)))}}return _react.default.createElement(r,(0,_extends2.default)({},e,u))},component:null})," ")};function createRoute(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_Loading.default;if(!e)return null;var t=Object.keys(e).map(function(t){var n=e[t],o=n.exact,a=n.strict,u=n.component,i=n.onPageLoad,c=n.onPageUnLoad,l=n.render,f=n.verify,d=n.redirect,p=createPowerComponent({redirect:d,onPageLoad:i,loading:r,onPageUnLoad:c,component:u,render:l,exact:o,strict:a}),s="NotFound"===t;return u?s?_react.default.createElement(_reactRouter.Route,{component:u,notFound:!0}):_react.default.createElement(PowerRouter,{verify:f,notVerify:s,Loading:r,PowerComponent:p,path:t,exact:o,strict:a,component:u}):l?s?_react.default.createElement(PowerRouter,{PowerComponent:p,notVerify:!0}):_react.default.createElement(PowerRouter,{verify:f,notVerify:s,exact:o,strict:a,path:t,PowerComponent:p,Loading:r}):"render or component is not found!"});return _react.default.createElement(_reactRouter.Switch,null,t)}var _GoModel$mutations=_go.GoModel.mutations,beforeGo=_GoModel$mutations.beforeGo,beforeReplace=_GoModel$mutations.beforeReplace,goUrl=_GoModel$mutations.go,replace=_GoModel$mutations.replace;function createApp(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.loading,o=void 0===n?_Loading.default:n,a=t.onBeforeGo,u=t.verifyUrl;function i(e){return function(t){e(_objectSpread({},t,{history:r}))}}var c=i(goUrl),l=i(replace),f=_lugiax.default.on(function(e,r){e===beforeGo&&c(r),e===beforeReplace&&l(r)}).unSubscribe;return function(t){function n(){return(0,_classCallCheck2.default)(this,n),(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(n).apply(this,arguments))}return(0,_inherits2.default)(n,t),(0,_createClass2.default)(n,[{key:"componentWillUnmount",value:function(){f()}},{key:"render",value:function(){return _react.default.createElement(LugiaxContext.Provider,{value:{onBeforeGo:a,verifyUrl:u}},_react.default.createElement(_reactRouter.Router,{history:r},createRoute(e,o)))}}]),n}(_react.Component)}function render(e,r){var t=document.getElementById(r);t&&_reactDom.default.render(_react.default.createElement(e,null),t)}