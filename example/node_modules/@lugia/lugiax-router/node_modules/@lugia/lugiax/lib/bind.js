"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=_default;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_lugiaxCore=_interopRequireDefault(require("@lugia/lugiax-core")),React=_interopRequireWildcard(require("react")),_utils=require("./utils"),_hoistNonReactStatics=_interopRequireDefault(require("hoist-non-react-statics")),_connect=require("./connect");function _default(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=i.eventHandle,a=i.props,n=void 0===a?{}:a,l=i.withRef,o=void 0!==l&&l,s=i.areStateEqual,c=i.areStatePropsEqual,d=i.areOwnPropsEqual,p=e.model;return r=r||{},function(i){var a=(0,_utils.getDisplayName)(i),l=function(a){function l(i){var u;(0,_classCallCheck2.default)(this,l),(u=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(l).call(this,i))).unSubscribe=void 0,u.eventHandler=void 0,u.oldModel=void 0,u.oldModel=e.getState(),u.state=t(u.oldModel);var a=_lugiaxCore.default.onRender(_connect.BatchModels,function(r){if(r[p]){var i=e.getState(),a=(0,_assertThisInitialized2.default)(u).oldModel;u.oldModel=i,s&&!s(a,i)||u.setState(t(i))}}).unSubscribe;return u.unSubscribe=a,u.eventHandler={},Object.keys(r).forEach(function(t){var i=r[t];u.eventHandler[t]=function(){for(var t=arguments.length,r=new Array(t),u=0;u<t;u++)r[u]=arguments[u];i.call.apply(i,[null,e.mutations].concat(r))}}),u}return(0,_inherits2.default)(l,a),(0,_createClass2.default)(l,[{key:"shouldComponentUpdate",value:function(e,t){return(0,_utils.isShouldRender)(c,d,{preState:this.state,nextState:t,preProps:this.props,nextProps:e})}},{key:"render",value:function(){var e=(0,_utils.combineFunction)({targets:[this.props,this.eventHandler,u],option:{returned:this.props}});return React.createElement(i,(0,_extends2.default)({},this.state,this.props,e,n,(0,_utils.withRef)(o,this)))}},{key:"componentWillUnmount",value:function(){this.unSubscribe(),delete this.unSubscribe}}]),l}(React.Component);return l.displayName="lugiax-bind-".concat(a),(0,_hoistNonReactStatics.default)(l,i)}}module.exports=exports.default;