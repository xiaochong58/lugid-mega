"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=_default,exports.BatchModels=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_lugiaxCore=_interopRequireDefault(require("@lugia/lugiax-core")),_hoistNonReactStatics=_interopRequireDefault(require("hoist-non-react-statics")),React=_interopRequireWildcard(require("react")),_utils=require("./utils"),BatchModels="batchModels";exports.BatchModels=BatchModels;var Noop=function(){return{}};function _default(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Noop,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Noop,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r||(r=Noop),Array.isArray(e)||(e=[e]);var i=[],o=[],u={};function n(e,t){return!!t.getState||(console.error("mode(modelName = ".concat(e,") is error, mode value is (").concat(t,").")),!1)}e.forEach(function(e){var t=e.model,r=e.mutations;i.push(t),u[t]=e,o.push(r)});var s=a.areStateEqual,l=a.areStatePropsEqual,p=a.areOwnPropsEqual;return function(e){var c=(0,_utils.getDisplayName)(e),d=function(c){function d(e){var t;(0,_classCallCheck2.default)(this,d),(t=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(d).call(this,e))).unSubscribe=void 0,t.target=void 0;var a=[],l={};i.forEach(function(e,t){l[e]=t;var r=u[e];n(e,r)&&a.push(r.getState())}),t.state={modelData:a,mutations:r(1===o.length?o[0]:o)},t.unSubscribe=[];var p=_lugiaxCore.default.onRender(BatchModels,function(e){var r=t.state.modelData;if(e&&!(Object.keys(e).length<=0)){for(var a=!0,o=[],p=0;p<i.length;p++){var c=i[p],d=e[c],h=u[c];if(d&&n(c,h)){a=!1,0===o.length&&(o=(0,_toConsumableArray2.default)(r));var f=l[c],v=h.getState();r[f]=v}}!0===a||s&&!s(1===o.length?o[0]:o,1===r.length?r[0]:r)||t.setState({modelData:r})}}).unSubscribe;return t.unSubscribe.push(p),t}return(0,_inherits2.default)(d,c),(0,_createClass2.default)(d,[{key:"shouldComponentUpdate",value:function(e,t){var r=this.state.props,a=t.props;return(0,_utils.isShouldRender)(l,p,{preState:r,nextState:a,preProps:this.props,nextProps:e})}},{key:"render",value:function(){var t=this.state,r=t.props,i=t.mutations,o=a.withRef,u=void 0!==o&&o,n=a.props,s=void 0===n?{}:n,l=a.eventHandle,p=void 0===l?{}:l,c=(0,_utils.combineFunction)({targets:[this.props,p],option:{returned:this.props}});return React.createElement(e,(0,_extends2.default)({},r,i,this.props,c,s,(0,_utils.withRef)(u,this)))}},{key:"getWrappedInstance",value:function(){if(this.target)return this.target}},{key:"componentDidUpdate",value:function(){var e=this.props.lugiaxDidUpdate;e&&e()}},{key:"componentDidMount",value:function(){var e=this.props.lugiaxDidMount;e&&e()}},{key:"componentWillUnmount",value:function(){this.unSubscribe.forEach(function(e){return e()}),delete this.unSubscribe}}],[{key:"getDerivedStateFromProps",value:function(e,r){var a=r.modelData;return{props:t(1===a.length?a[0]:a)}}}]),d}(React.Component);return d.displayName="lugiax-".concat(c),(0,_hoistNonReactStatics.default)(d,e)}}